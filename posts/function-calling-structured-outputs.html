<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dylan Castillo">
<meta name="dcterms.date" content="2025-07-01">
<meta name="description" content="Understand how to use function calling and structured outputs in LLMs with LangChain and OpenAI">

<title>Function calling and structured outputs in LLMs with LangChain and OpenAI – Dylan Castillo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/logo.webp" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7087bcf82a3c6fa223fe00ad8f3b6ef0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&amp;display=swap" rel="stylesheet">
<script src="https://cdn.usefathom.com/script.js" data-site="ZJFQREIA" defer=""></script>


<meta property="og:title" content="Function calling and structured outputs in LLMs with LangChain and OpenAI – Dylan Castillo">
<meta property="og:description" content="">
<meta property="og:image" content="https://dylancastillo.co/posts/images/function-calling-structured-outputs/diagram.png">
<meta property="og:site_name" content="Dylan Castillo">
<meta property="og:image:alt" content="Function calling flow">
<meta property="og:image:height" content="748">
<meta property="og:image:width" content="2073">
<meta name="twitter:title" content="Function calling and structured outputs in LLMs with LangChain and OpenAI – Dylan Castillo">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://dylancastillo.co/posts/images/function-calling-structured-outputs/diagram.png">
<meta name="twitter:creator" content="@dylanjcastillo">
<meta name="twitter:site" content="@dylanjcastillo">
<meta name="twitter:image:alt" content="Function calling flow">
<meta name="twitter:image-height" content="748">
<meta name="twitter:image-width" content="2073">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/dylanjcastillo"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:github" aria-label="Icon github from fa6-brands Iconify.design set." title="Icon github from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/dylanjcastillo/"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:linkedin" aria-label="Icon linkedin from fa6-brands Iconify.design set." title="Icon linkedin from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#function-calling" id="toc-function-calling" class="nav-link active" data-scroll-target="#function-calling">Function calling</a></li>
  <li><a href="#structured-outputs" id="toc-structured-outputs" class="nav-link" data-scroll-target="#structured-outputs">Structured outputs</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#function-calling-with-a-single-tool" id="toc-function-calling-with-a-single-tool" class="nav-link" data-scroll-target="#function-calling-with-a-single-tool">Function calling with a single tool</a></li>
  <li><a href="#function-calling-with-multiple-tools" id="toc-function-calling-with-multiple-tools" class="nav-link" data-scroll-target="#function-calling-with-multiple-tools">Function calling with multiple tools</a></li>
  <li><a href="#structured-outputs-1" id="toc-structured-outputs-1" class="nav-link" data-scroll-target="#structured-outputs-1">Structured outputs</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<button onclick="window.location.href='https://subscribe.dylancastillo.co'" style="background-color: #eb841b; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; transition: background-color 0.3s ease;">
Subscribe to my newsletter
</button>
</div></div></div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Function calling and structured outputs in LLMs with LangChain and OpenAI</h1>
  <div class="quarto-categories">
    <div class="quarto-category">llm</div>
    <div class="quarto-category">function-calling</div>
    <div class="quarto-category">structured-outputs</div>
    <div class="quarto-category">openai</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://dylancastillo.co">Dylan Castillo</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://iwanalabs.com">
            Iwana Labs
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 1, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 7, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>Function calling and structured outputs let you go from chatbots that just talk to agents that interact with the world. They’re two of the most important techniques for building LLM applications.</p>
<p>Function calling let LLMs access external tools and services. Structured outputs ensure that the data coming back from your models is ready to integrate</p>
<p>These are two of the most important techniques for building LLM applications. I can tell you that mastering them will make your applications better and easier to maintain.</p>
<p>In this tutorial, you’ll learn:</p>
<ul>
<li>How function calling and structured outputs work and when to use them</li>
<li>How to implement both techniques using LangChain and OpenAI</li>
<li>Practical examples you can run and adapt for your own projects.</li>
</ul>
<p>Let’s get started.</p>
<section id="function-calling" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="function-calling">Function calling</h2>
<p>Function calling refers to the ability to get LLMs to use external tools or functions. It matters because it gives LLMs more capabilities, allows them to talk to external systems, and enables complex task automation. This is one of the key features that unlocked agents.</p>
<p>The usual flow is:</p>
<ol type="1">
<li>The developer sets up an LLM with a set of predefined tools</li>
<li>The user asks a question</li>
<li>The LLM decides if it needs to use a tool</li>
<li>If it does, it invokes the tool and gets the output from the tool.</li>
<li>The LLM then uses the output to answer the user’s question</li>
</ol>
<p>Here’s a diagram that illustrates how function calling works:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="./images/function-calling-structured-outputs/diagram.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Function calling flow"><img src="./images/function-calling-structured-outputs/diagram.png" class="img-fluid figure-img" alt="Function calling flow"></a></p>
<figcaption class="margin-caption">Function calling flow</figcaption>
</figure>
</div>
<p>AI developers are increasingly using function calling to build more complex systems. You can use it to:</p>
<ul>
<li>Get information from a CRM, DB, etc</li>
<li>Perform calculations (e.g., generate an estimate for a variable, financial calculations)</li>
<li>Manipulate data (e.g., data cleaning, data transformation)</li>
<li>Interact with external systems (e.g., booking a flight, sending an email)</li>
</ul>
</section>
<section id="structured-outputs" class="level2">
<h2 class="anchored" data-anchor-id="structured-outputs">Structured outputs</h2>
<p>Structured outputs are a group of methods that “ensure that model outputs adhere to a specific structure”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. With proprietary models, this usually means a JSON schema. With open-weight models, a structure can mean anything from a JSON schema to a specific regex pattern. You can use <a href="https://dottxt-ai.github.io/outlines/latest/">outlines</a> for this.</p>
<p>Structured outputs are very useful to create agentic systems, as they simplify the communication between components. As you can imagine, it’s a lot easier to parse the output of a JSON object than a free-form text. Note, however, that as with other things in life, there’s no free lunch. Using this technique might <a href="https://dylancastillo.co/posts/say-what-you-mean-sometimes.html">impact the performance</a> of your task, so you should have evals in place.</p>
<p>In the next sections, I’ll show you how to use function calling and structured outputs with OpenAI.</p>
</section>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<p>To follow this tutorial you’ll need to:</p>
<ol type="1">
<li>Sign up and generate an API key in <a href="https://platform.openai.com/docs/overview">OpenAI</a>.</li>
<li>Sign up and generate an API key in <a href="https://smith.langchain.com/signup">LangSmith</a>.</li>
<li>Create an <code>.env</code> file with the following variables:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="va">OPENAI_API_KEY</span><span class="op">=</span>sk-...</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="va">LANGCHAIN_TRACING_V2</span><span class="op">=</span>true</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="va">LANGSMITH_API_KEY</span><span class="op">=</span>lsv2_...</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="va">LANGCHAIN_PROJECT</span><span class="op">=</span><span class="st">"my-project"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Create a virtual environment in Python and install the requirements:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="bu">source</span> venv/bin/activate</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="ex">pip</span> install langchain langsmith pydantic langchain-openai python-dotenv jupyter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you’ve completed the steps above, you can run copy and paste the code from the next sections. You can also download the notebook from <a href="../posts/function-calling-structured-outputs.html">here</a>.</p>
</section>
<section id="examples" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>As usual, you’ll start by importing the necessary libraries.</p>
<p>You’ll use LangChain to interact with the OpenAI API and Pydantic for data validation.</p>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> textwrap <span class="im">import</span> dedent</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> requests</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">from</span> langchain_core.messages <span class="im">import</span> HumanMessage, SystemMessage</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">from</span> langchain_core.tools <span class="im">import</span> tool</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">from</span> langchain_openai <span class="im">import</span> ChatOpenAI</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="im">from</span> langsmith <span class="im">import</span> traceable</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that you’ve imported the libraries, we’ll work on three examples:</p>
<ol type="1">
<li>Providing a model with a single tool</li>
<li>Providing a model with multiple tools</li>
<li>Generating a structured output from a model</li>
</ol>
<section id="function-calling-with-a-single-tool" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="function-calling-with-a-single-tool">Function calling with a single tool</h3>
<p>First you start by defining the model and the tool:</p>
<div id="cell-7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>model <span class="op">=</span> ChatOpenAI(model_name<span class="op">=</span><span class="st">"gpt-4.1-mini"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="at">@tool</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">def</span> find_weather(latitude: <span class="bu">float</span>, longitude: <span class="bu">float</span>):</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="co">"""Get the weather of a given latitude and longitude"""</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>    response <span class="op">=</span> requests.get(</span>
<span id="cb4-7"><a href="#cb4-7"></a>        <span class="ss">f"https://api.open-meteo.com/v1/forecast?latitude=</span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">&amp;longitude=</span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m"</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="cf">return</span> data[<span class="st">"current"</span>][<span class="st">"temperature_2m"</span>]</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>tools_mapping <span class="op">=</span> {</span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="st">"find_weather"</span>: find_weather,</span>
<span id="cb4-15"><a href="#cb4-15"></a>}</span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a>model_with_tools <span class="op">=</span> model.bind_tools([find_weather])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code sets up a <code>gpt-4.1-mini</code> model with a single tool. To define a tool, you must define a function and use the <code>@tool</code> decorator. This function must necessarily have a docstring because this will be used to describe the tool to the model. In this case, the tool is a function that takes latitude and longitude values and returns the weather for that location by making a call to the Open Meteo API.</p>
<p>Next, you need to tell your code how to find and use your tools. This is the purpose of <code>tools_mapping</code>. It is a common point of confusion. The LLM doesn’t run the tools on its own. It only decides if a tool should be used. After the model makes its decision, your own code must make the actual tool call.</p>
<p>In this situation, since you only have one tool, a mapping isn’t really necessary. But if you were using multiple tools, which is often the case, you would need to create a “map” that links each tool’s name to its corresponding function. This lets you call the right tool when the model decides to use it.</p>
<p>Finally, you need to <em>bind</em> the tool to the model. The binding makes the model aware of the tool, so that it can use it.</p>
<p>Then, let’s define a function that lets you call the model with the tool.</p>
<div id="cell-9" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="at">@traceable</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">def</span> get_response(question: <span class="bu">str</span>):</span>
<span id="cb5-3"><a href="#cb5-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb5-4"><a href="#cb5-4"></a>        SystemMessage(</span>
<span id="cb5-5"><a href="#cb5-5"></a>            <span class="st">"You're a helpful assistant. Use the tools provided when relevant."</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>        ),</span>
<span id="cb5-7"><a href="#cb5-7"></a>        HumanMessage(question),</span>
<span id="cb5-8"><a href="#cb5-8"></a>    ]</span>
<span id="cb5-9"><a href="#cb5-9"></a>    ai_message <span class="op">=</span> model_with_tools.invoke(messages)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    messages.append(ai_message)</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="cf">for</span> tool_call <span class="kw">in</span> ai_message.tool_calls:</span>
<span id="cb5-13"><a href="#cb5-13"></a>        selected_tool <span class="op">=</span> tools_mapping[tool_call[<span class="st">"name"</span>]]</span>
<span id="cb5-14"><a href="#cb5-14"></a>        tool_msg <span class="op">=</span> selected_tool.invoke(tool_call)</span>
<span id="cb5-15"><a href="#cb5-15"></a>        messages.append(tool_msg)</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>    ai_message <span class="op">=</span> model_with_tools.invoke(messages)</span>
<span id="cb5-18"><a href="#cb5-18"></a>    messages.append(ai_message)</span>
<span id="cb5-19"><a href="#cb5-19"></a></span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="cf">return</span> ai_message.content</span>
<span id="cb5-21"><a href="#cb5-21"></a></span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a>response <span class="op">=</span> get_response(<span class="st">"What's the weather in Tokyo?"</span>)</span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The current temperature in Tokyo is approximately 25.5°C. If you want more detailed weather information, please let me know!</code></pre>
</div>
</div>
<p>This function takes a city name and returns the weather for that city. It uses the <code>find_weather</code> tool to get the weather data.</p>
<p>It works as follows:</p>
<ol type="1">
<li><strong>Line 1</strong> adds a LangSmith’s <code>traceable</code> decorator to the function, so that you can see the trace of the function in the LangSmith UI. If you prefer to not use LangSmith, you can remove this line.</li>
<li><strong>Lines 2 to 10</strong> set up the <a href="https://dylancastillo.co/posts/prompt-engineering-101.html">prompts</a> and call the model.</li>
<li><strong>Lines 12 to 16</strong> is where the magic happens. This is a loop that will check if there’s been a tool call in the response from the model. If there is, it will call (invoke) the tool and add the result to the messages.</li>
<li><strong>Lines 17 to 18</strong> the model is called again to get the final response.</li>
</ol>
<p>When you run this code, you’ll get a text response with the weather for the city you asked for. If you check the trace, you can see how the whole process works:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="./images/function-calling-structured-outputs/trace-spans.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Function calling trace"><img src="./images/function-calling-structured-outputs/trace-spans.png" class="img-fluid figure-img" alt="Function calling trace"></a></p>
<figcaption class="margin-caption">Function calling trace</figcaption>
</figure>
</div>
<p>There are three steps in the process:</p>
<ol type="1">
<li><strong>Initial model call</strong> with the question from the user.</li>
<li><strong>Tool call</strong> to get the weather data.</li>
<li><strong>Final model call</strong> to get the response.</li>
</ol>
<p>If you dig deeper into the first model call, you’ll see how the tool is provided to the model and how the model decides to use it:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="./images/function-calling-structured-outputs/model-calls-tool.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Model calls tool"><img src="./images/function-calling-structured-outputs/model-calls-tool.png" class="img-fluid figure-img" alt="Model calls tool"></a></p>
<figcaption class="margin-caption">Model calls tool</figcaption>
</figure>
</div>
<p>The tools is provided by describing it to the model using the docstring of the function. The parameter and their types are also provided. Then the model responds specifying the name of the tool it wants to use and the parameters it wants to pass to it. This tool is then called:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="./images/function-calling-structured-outputs/tool-call.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Tool call"><img src="./images/function-calling-structured-outputs/tool-call.png" class="img-fluid figure-img" alt="Tool call"></a></p>
<figcaption class="margin-caption">Tool call</figcaption>
</figure>
</div>
<p>The results of the tool call are then passed to the model again. The model then uses the result to generate the final response:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="./images/function-calling-structured-outputs/tool-call-result.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Tool call result"><img src="./images/function-calling-structured-outputs/tool-call-result.png" class="img-fluid figure-img" alt="Tool call result"></a></p>
<figcaption class="margin-caption">Tool call result</figcaption>
</figure>
</div>
<p>That’s it. This how you provide a model with tools. In the next section, you’ll see how to use multiple tools.</p>
</section>
<section id="function-calling-with-multiple-tools" class="level3">
<h3 class="anchored" data-anchor-id="function-calling-with-multiple-tools">Function calling with multiple tools</h3>
<p>Similar to the previous example, you start by defining the tools (using the <code>@tool</code> decorator) and binding them to the model.</p>
<p>In addition to <code>get_weather</code>, you’ll also define a tool to check if a response follows the company guidelines. In this case, the company guidelines are that responses should be written in the style of a haiku.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div id="cell-13" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>model <span class="op">=</span> ChatOpenAI(model_name<span class="op">=</span><span class="st">"gpt-4.1-mini"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="at">@tool</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">def</span> get_weather(latitude: <span class="bu">float</span>, longitude: <span class="bu">float</span>):</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="co">"""Get the weather of a given latitude and longitude"""</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    response <span class="op">=</span> requests.get(</span>
<span id="cb7-7"><a href="#cb7-7"></a>        <span class="ss">f"https://api.open-meteo.com/v1/forecast?latitude=</span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">&amp;longitude=</span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m"</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    )</span>
<span id="cb7-9"><a href="#cb7-9"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="cf">return</span> data[<span class="st">"current"</span>][<span class="st">"temperature_2m"</span>]</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="at">@tool</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="kw">def</span> check_guidelines(drafted_response: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="co">"""Check if a given response follows the company guidelines"""</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>    model <span class="op">=</span> ChatOpenAI(model_name<span class="op">=</span><span class="st">"gpt-4.1-mini"</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a>    response <span class="op">=</span> model.invoke(</span>
<span id="cb7-18"><a href="#cb7-18"></a>        [</span>
<span id="cb7-19"><a href="#cb7-19"></a>            SystemMessage(</span>
<span id="cb7-20"><a href="#cb7-20"></a>                <span class="st">"You're a helpful assistant. Your task is to check if a given response follows the company guidelines. The company guidelines are that responses should be written in the style of a haiku. You should reply with 'OK' or 'REQUIRES FIXING' and a short explanation."</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>            ),</span>
<span id="cb7-22"><a href="#cb7-22"></a>            HumanMessage(<span class="ss">f"Current response: </span><span class="sc">{</span>drafted_response<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb7-23"><a href="#cb7-23"></a>        ]</span>
<span id="cb7-24"><a href="#cb7-24"></a>    )</span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="cf">return</span> response.content</span>
<span id="cb7-26"><a href="#cb7-26"></a></span>
<span id="cb7-27"><a href="#cb7-27"></a></span>
<span id="cb7-28"><a href="#cb7-28"></a>tools_mapping <span class="op">=</span> {</span>
<span id="cb7-29"><a href="#cb7-29"></a>    <span class="st">"get_weather"</span>: get_weather,</span>
<span id="cb7-30"><a href="#cb7-30"></a>    <span class="st">"check_guidelines"</span>: check_guidelines,</span>
<span id="cb7-31"><a href="#cb7-31"></a>}</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a>model_with_tools <span class="op">=</span> model.bind_tools([get_weather, check_guidelines])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code defines the tools and binds them to the model. Just like we did before, you also need to define a mapping of the tools, so that you can call the right tool when the model decides to use it.</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="at">@traceable</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">def</span> get_response(question: <span class="bu">str</span>):</span>
<span id="cb8-3"><a href="#cb8-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb8-4"><a href="#cb8-4"></a>        SystemMessage(</span>
<span id="cb8-5"><a href="#cb8-5"></a>            <span class="st">"You're a helpful assistant. Use the tools provided when relevant. Then draft a response and check if it follows the company guidelines. Only respond to the user after you've validated and modified the response if needed."</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>        ),</span>
<span id="cb8-7"><a href="#cb8-7"></a>        HumanMessage(question),</span>
<span id="cb8-8"><a href="#cb8-8"></a>    ]</span>
<span id="cb8-9"><a href="#cb8-9"></a>    ai_message <span class="op">=</span> model_with_tools.invoke(messages)</span>
<span id="cb8-10"><a href="#cb8-10"></a>    messages.append(ai_message)</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="cf">while</span> ai_message.tool_calls:</span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="cf">for</span> tool_call <span class="kw">in</span> ai_message.tool_calls:</span>
<span id="cb8-14"><a href="#cb8-14"></a>            selected_tool <span class="op">=</span> tools_mapping[tool_call[<span class="st">"name"</span>]]</span>
<span id="cb8-15"><a href="#cb8-15"></a>            tool_msg <span class="op">=</span> selected_tool.invoke(tool_call)</span>
<span id="cb8-16"><a href="#cb8-16"></a>            messages.append(tool_msg)</span>
<span id="cb8-17"><a href="#cb8-17"></a>        ai_message <span class="op">=</span> model_with_tools.invoke(messages)</span>
<span id="cb8-18"><a href="#cb8-18"></a>        messages.append(ai_message)</span>
<span id="cb8-19"><a href="#cb8-19"></a></span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="cf">return</span> ai_message.content</span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a></span>
<span id="cb8-23"><a href="#cb8-23"></a>response <span class="op">=</span> get_response(<span class="st">"What is the temperature in Madrid?"</span>)</span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="bu">print</span>(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sunny Madrid basks,  
Thirty-six degrees embrace,  
Summer's warm caress.</code></pre>
</div>
</div>
<p>This code is pretty much the same as the previous example, but with two tools. There’s also a one small difference.</p>
<p>Previously, we checked for tool calls once. Now, we’ll use a while loop that keeps checking. So, instead of the model having to provide the final answer after one turn, it can now ask for tools multiple times in a row until it has all the information it needs.</p>
<p>This is the core idea behind how agents work. So, congratulations, you’ve just built a simple agent! If you check the process in LangSmith, you’ll see how these turns play out.</p>
<p>Next, let’s see how to use structured outputs.</p>
</section>
<section id="structured-outputs-1" class="level3">
<h3 class="anchored" data-anchor-id="structured-outputs-1">Structured outputs</h3>
<p>Structured outputs are a set of methods used to get model outputs that follow a specific structure. This is useful when you want to get a specific type of output, such as a JSON object.</p>
<p>It’s easy to set up with proprietary models. With LangChain, you can define a <code>dict</code> or a <a href="https://docs.pydantic.dev/latest/concepts/models/">Pydantic model</a> to describe the output. I recommend using Pydantic models.</p>
<p>For example, let’s define a Pydantic model that will help us classify document into categories:</p>
<div id="cell-19" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">class</span> DocumentInfo(BaseModel):</span>
<span id="cb10-2"><a href="#cb10-2"></a>    category: Literal[<span class="st">"financial"</span>, <span class="st">"legal"</span>, <span class="st">"marketing"</span>, <span class="st">"pets"</span>, <span class="st">"other"</span>] <span class="op">=</span> Field(</span>
<span id="cb10-3"><a href="#cb10-3"></a>        description<span class="op">=</span><span class="st">"The category of the document"</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    )</span>
<span id="cb10-5"><a href="#cb10-5"></a>    summary: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"A short summary of the document"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model defines the structured output we’ll get from the model. It has two fields: <code>category</code> and <code>summary</code>.</p>
<p>Then, you can use the <code>with_structured_output</code> method to create a model that will return the structured output:</p>
<div id="cell-21" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>model <span class="op">=</span> ChatOpenAI(model<span class="op">=</span><span class="st">"gpt-4.1-mini"</span>, temperature<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">def</span> get_document_info(document: <span class="bu">str</span>) <span class="op">-&gt;</span> DocumentInfo:</span>
<span id="cb11-4"><a href="#cb11-4"></a>    model_with_structure <span class="op">=</span> model.with_structured_output(DocumentInfo)</span>
<span id="cb11-5"><a href="#cb11-5"></a>    response <span class="op">=</span> model_with_structure.invoke(document)</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="cf">return</span> response</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a>document_text <span class="op">=</span> dedent(<span class="st">"""</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="st">This is a document about cats. Very important document. It explain how cats will take over the world in 20230.</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="st">"""</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>)</span>
<span id="cb11-13"><a href="#cb11-13"></a>document_info <span class="op">=</span> get_document_info(<span class="st">"I'm a document about a cat"</span>)</span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="bu">print</span>(document_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>category='pets' summary='A document about a cat.'</code></pre>
</div>
</div>
<p>After running this code, you’ll get a structured output with the category and summary of the document that you can then use in further steps of your workflow.</p>
<p>Depending on the provider, you’ll have different options to get structured outputs. OpenAI offers three different methods:</p>
<ul>
<li><code>function_calling</code>: This uses the tool calling mechanism to get the structured output.</li>
<li><code>json_mode</code>: This method ensures you get a valid JSON object, but it’s not clear how it works under the hood.</li>
<li><code>json_schema</code>: This is default method in LangChain. It ensures that the output is a valid JSON object and that it matches the schema you provide using <a href="https://openai.com/index/introducing-structured-outputs-in-the-api/">constrained decoding</a>.</li>
</ul>
<p><a href="https://ai.google.dev/gemini-api/docs/structured-output">Gemini</a> and <a href="https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/increase-consistency">Anthropic</a> provide their own methods to get structured outputs.</p>
<p>One thing to keep in mind is that structured outputs can impact performance. I’ve <a href="https://dylancastillo.co/posts/llm-pydantic-order-matters.html">written</a> <a href="https://dylancastillo.co/posts/say-what-you-mean-sometimes.html">multiple</a> <a href="https://dylancastillo.co/posts/gemini-structured-outputs.html">posts</a> about this topic, so I won’t go into detail here.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Function calling and structured outputs are powerful tools that help build more capable AI systems. They’re also the foundation of agents.</p>
<p>Function calling is a way to provide LLMs with tools to use. It lets you go from building a chatbot that can only talk to building an AI assistant that can actually interact with the world. It opens up a world of possibilities, from connecting to databases, calling APIs, or automating workflows.</p>
<p>Structured outputs are just as important. They’re critical to integrating LLMs into existing systems. Instead of struggling with parsing free-form text, you get clean, predictable data structures that you can use in your code.</p>
<p>The examples in this tutorial should give you a sense of how to use these methods. But as usual, the real learning happens when you start applying these concepts to your own problems. Pick a task you’re working on, see if any of these methods can help you, and give it a try.</p>
<p>If you have any questions or comments, let me know in the comments below.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://arxiv.org/abs/2404.07362">“We Need Structured Output”: Towards User-centered Constraints on LLM Output. MX Liu et al.&nbsp;2024</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Please don’t judge me. Companies do all sorts of weird things these days.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{castillo2025,
  author = {Castillo, Dylan},
  title = {Function Calling and Structured Outputs in {LLMs} with
    {LangChain} and {OpenAI}},
  date = {2025-07-01},
  url = {https://dylancastillo.co/posts/function-calling-structured-outputs.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-castillo2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Castillo, Dylan. 2025. <span>“Function Calling and Structured Outputs in
LLMs with LangChain and OpenAI.”</span> July 1, 2025. <a href="https://dylancastillo.co/posts/function-calling-structured-outputs.html">https://dylancastillo.co/posts/function-calling-structured-outputs.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dylancastillo\.co");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="dylanjcastillo/blog_comments" issue-term="pathname" theme="dark-blue" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Dylan Castillo</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>