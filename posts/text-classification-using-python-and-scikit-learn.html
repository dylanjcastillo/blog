<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dylan Castillo">
<meta name="dcterms.date" content="2022-08-23">
<meta name="description" content="This tutorial will show you how to quickly build a text classification model using Python and Scikit-learn.">

<title>Text Classification Using Python and Scikit-learn – Dylan Castillo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&amp;display=swap" rel="stylesheet">
<script src="https://cdn.usefathom.com/script.js" data-site="ZJFQREIA" defer=""></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Dylan Castillo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dylanjcastillo"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/dylanjcastillo/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/dylanjcastillo"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link active" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#import-the-required-libraries" id="toc-import-the-required-libraries" class="nav-link" data-scroll-target="#import-the-required-libraries">Import the Required Libraries</a></li>
  <li><a href="#read-the-data" id="toc-read-the-data" class="nav-link" data-scroll-target="#read-the-data">Read the Data</a></li>
  <li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link" data-scroll-target="#prepare-the-data">Prepare the Data</a>
  <ul class="collapse">
  <li><a href="#clean-the-text-column" id="toc-clean-the-text-column" class="nav-link" data-scroll-target="#clean-the-text-column">Clean the Text Column</a></li>
  <li><a href="#split-the-data-into-train-and-test-sets" id="toc-split-the-data-into-train-and-test-sets" class="nav-link" data-scroll-target="#split-the-data-into-train-and-test-sets">Split the Data Into Train and Test Sets</a></li>
  <li><a href="#create-bag-of-words-features" id="toc-create-bag-of-words-features" class="nav-link" data-scroll-target="#create-bag-of-words-features">Create Bag of Words Features</a></li>
  </ul></li>
  <li><a href="#train-and-evaluate-the-model" id="toc-train-and-evaluate-the-model" class="nav-link" data-scroll-target="#train-and-evaluate-the-model">Train and Evaluate the Model</a></li>
  <li><a href="#saving-and-loading-the-model" id="toc-saving-and-loading-the-model" class="nav-link" data-scroll-target="#saving-and-loading-the-model">Saving and Loading the Model</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Text Classification Using Python and Scikit-learn</h1>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">ml</div>
    <div class="quarto-category">nlp</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://dylancastillo.co">Dylan Castillo</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://iwanalabs.com">
            Iwana Labs
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 23, 2022</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 9, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>Text classification is the task of automatically assigning labels to pieces of text, such as articles, blog posts, or reviews. Many businesses use text classification algorithms to save time and money by reducing the amount of manual labor needed to organize and analyze their text data.</p>
<p>These algorithms are extremely powerful tools when used correctly. Text classification models keep your email free of spam, assist authors in detecting plagiarism, and help your grammar checker understand the various parts of speech.</p>
<p>If you want to build a text classifier, you have many options to choose from. You can use traditional methods such as bag of words, advanced methods like <a href="https://dylancastillo.co/nlp-snippets-cluster-documents-using-word2vec/">Word2Vec</a>, or cutting-edge approaches like BERT or GPT-3.</p>
<p>But if your goal is to get something up and running quickly and at no cost, you should build your text classification model with Python and Scikit-learn. I’ll show you how in this tutorial.</p>
<p>So let’s get started!</p>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<p>Before we start, you need to install some libraries. The best way to do that is to create a new virtual environment and install the packages there.</p>
<p>If you’re using <code>venv</code>, run these commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a>python3 -m venv .textcl</span>
<span id="cb1-2"><a href="#cb1-2"></a>source .textcl/bin/activate</span>
<span id="cb1-3"><a href="#cb1-3"></a>python3 -m pip install pandas==1.4.3 notebook==6.3.0 numpy==1.23.2 scikit-learn==1.1.2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you’re using <code>conda</code>, this is how you do it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>conda create --name textcl</span>
<span id="cb2-2"><a href="#cb2-2"></a>conda activate textcl</span>
<span id="cb2-3"><a href="#cb2-3"></a>conda install pandas==1.4.3 notebook==6.3.0 numpy==1.23.2 scikit-learn==1.1.2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s it! These commands will create a virtual environment, activate it, and install the required packages.</p>
<p>Finally, start a Jupyter Notebook session by executing <code>jupyter notebook</code> on the same terminal where you ran the previous commands and create a new notebook.</p>
</section>
<section id="import-the-required-libraries" class="level2">
<h2 class="anchored" data-anchor-id="import-the-required-libraries">Import the Required Libraries</h2>
<p>The first step, as always, is to import the necessary libraries. Create a new cell in your notebook, paste the following code in it, and run the cell:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> joblib</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> re</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> string</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_20newsgroups</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, cohen_kappa_score, f1_score, classification_report</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, train_test_split</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code will import the required libraries. Here’s why you need them:</p>
<ul>
<li>You import <code>joblib</code> to save your model <a href="https://h2o.ai/wiki/artifacts/">artifacts</a>.</li>
<li>You import <code>re</code> and <code>string</code> to process the text.</li>
<li>You import <code>numpy</code> and <code>pandas</code> to read and transform the data.</li>
<li>You import multiple components of <code>scikit-learn</code> to extract features from the text, calculate the evaluation metrics, split the data into a training and a test set, and use the Multinomial Naive Bayes algorithm.</li>
</ul>
<p>Next, you’ll read and process the data.</p>
</section>
<section id="read-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-the-data">Read the Data</h2>
<p>Start by reading the data. You’ll use a dataset included in <code>scikit-learn</code> called <strong>20 newsgroups</strong>. This dataset consists of roughly 20,000 newsgroup documents, split into 20 categories. For the sake of simplicity, you’ll only use five of those categories in this example.</p>
<p>Create a new cell and paste this code to read the data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>categories <span class="op">=</span> [</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="st">"alt.atheism"</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="st">"misc.forsale"</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="st">"sci.space"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="st">"soc.religion.christian"</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="st">"talk.politics.guns"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>]</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>news_group_data <span class="op">=</span> fetch_20newsgroups(</span>
<span id="cb4-10"><a href="#cb4-10"></a>    subset<span class="op">=</span><span class="st">"all"</span>, remove<span class="op">=</span>(<span class="st">"headers"</span>, <span class="st">"footers"</span>, <span class="st">"quotes"</span>), categories<span class="op">=</span>categories</span>
<span id="cb4-11"><a href="#cb4-11"></a>)</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="bu">dict</span>(</span>
<span id="cb4-15"><a href="#cb4-15"></a>        text<span class="op">=</span>news_group_data[<span class="st">"data"</span>],</span>
<span id="cb4-16"><a href="#cb4-16"></a>        target<span class="op">=</span>news_group_data[<span class="st">"target"</span>]</span>
<span id="cb4-17"><a href="#cb4-17"></a>    )</span>
<span id="cb4-18"><a href="#cb4-18"></a>)</span>
<span id="cb4-19"><a href="#cb4-19"></a>df[<span class="st">"target"</span>] <span class="op">=</span> df.target.<span class="bu">map</span>(<span class="kw">lambda</span> x: categories[x])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code reads the 20 newsgroups dataset. Here’s how it works:</p>
<ul>
<li><strong>Lines 1 to 7:</strong> Define a list of categories, which are the different newsgroup categories used in the analysis: <code>alt.atheism</code>, <code>misc.forsale</code>, <code>sci.space</code>, <code>soc.religion.christian</code>, and <code>talk.politics.guns</code>.</li>
<li><strong>Lines 9 to 11:</strong> Use <code>fetch_20newsgroups</code>to get the data from the 20 newsgroups dataset. This function removes the headers, footers, and quotes from the data and only gets data from the categories specified in the <code>categories</code> list.</li>
<li><strong>Lines 13 and 19:</strong> Create a data frame from the data fetched. The data frame has two columns, one for the text of the newsgroup post and one for the category (target) of the newsgroup. You change the target column to display the actual category name instead of a number.</li>
</ul>
<p>That’s it. Now, you’ll do a bit of cleaning of the data.</p>
</section>
<section id="prepare-the-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-data">Prepare the Data</h2>
<p>Before you build your text classification model, you need to prepare the data. You’ll do it in three steps: clean the text column, create the training and testing splits, and generating bag of words features from the documents.</p>
<section id="clean-the-text-column" class="level3">
<h3 class="anchored" data-anchor-id="clean-the-text-column">Clean the Text Column</h3>
<p>Use this code to clean the text. It’ll remove the punctuation marks and multiple adjacent spaces:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">def</span> process_text(text):</span>
<span id="cb5-2"><a href="#cb5-2"></a>    text <span class="op">=</span> <span class="bu">str</span>(text).lower()</span>
<span id="cb5-3"><a href="#cb5-3"></a>    text <span class="op">=</span> re.sub(</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="ss">f"[</span><span class="sc">{</span>re<span class="sc">.</span>escape(string.punctuation)<span class="sc">}</span><span class="ss">]"</span>, <span class="st">" "</span>, text</span>
<span id="cb5-5"><a href="#cb5-5"></a>    )</span>
<span id="cb5-6"><a href="#cb5-6"></a>    text <span class="op">=</span> <span class="st">" "</span>.join(text.split())</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="cf">return</span> text</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a>df[<span class="st">"clean_text"</span>] <span class="op">=</span> df.text.<span class="bu">map</span>(process_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code lowercases the text and removes any punctuation marks or duplicated spaces, and stores the results in a new column called <code>clean_text</code>. For that, you use <code>process_text</code>, which takes a string as input, lowercases it, replaces all punctuation marks with spaces, and removes the duplicated spaces.</p>
</section>
<section id="split-the-data-into-train-and-test-sets" class="level3">
<h3 class="anchored" data-anchor-id="split-the-data-into-train-and-test-sets">Split the Data Into Train and Test Sets</h3>
<p>Next, you’ll split the dataset into a training and a testing set:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>df_train, df_test <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.20</span>, stratify<span class="op">=</span>df.target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>train_test_split</code> is used to split a dataset into training and testing sets. You provide the data frame you wish to split to the function and specify the following parameters:</p>
<ul>
<li><code>test_size=0.20</code>: this defines the size of the test set to 20% of the total.</li>
<li><code>stratify=df.target</code>: ensures that the training and testing sets are split in a stratified manner using <code>target</code>. This is important because it prevents bias.</li>
</ul>
<p>Next, you’ll use these datasets to train and evaluate your model.</p>
</section>
<section id="create-bag-of-words-features" class="level3">
<h3 class="anchored" data-anchor-id="create-bag-of-words-features">Create Bag of Words Features</h3>
<p>Machine Learning models cannot handle text features directly. To train a model, you first need to turn your text into numerical features. One popular approach to do that is called <a href="https://scikit-learn.org/stable/modules/feature_extraction.html#the-bag-of-words-representation">bag of words</a>, and that’s what you’ll use in this example.</p>
<p>In the <strong>bag of words</strong> approach, each document is represented as a row in a matrix, with each word or token appearing in the document represented by a column.</p>
<p>For example, consider these two sentences:</p>
<ol type="1">
<li>I like reading books</li>
<li>I do not like cooking</li>
</ol>
<p>The simplest bag of words representation for these two sentences will look like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id_doc</th>
<th>I</th>
<th>like</th>
<th>reading</th>
<th>books</th>
<th>do</th>
<th>not</th>
<th>cooking</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Once you have this numerical representation, you can pass this dataset to your machine learning model. This is what you’ll do with the documents in the 20 newsgroup dataset. Keep in mind that because the dataset has so many documents, you’ll end up with a matrix with many more columns than the example above.</p>
<p>To create a bag of words representation in <code>scikit-learn</code> , you must use <code>CountVectorizer</code>. You can use this code:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>vec <span class="op">=</span> CountVectorizer(</span>
<span id="cb7-2"><a href="#cb7-2"></a>    ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb7-3"><a href="#cb7-3"></a>    stop_words<span class="op">=</span><span class="st">"english"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>)</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>X_train <span class="op">=</span> vec.fit_transform(df_train.clean_text)</span>
<span id="cb7-7"><a href="#cb7-7"></a>X_test <span class="op">=</span> vec.transform(df_test.clean_text)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a>y_train <span class="op">=</span> df_train.target</span>
<span id="cb7-10"><a href="#cb7-10"></a>y_test <span class="op">=</span> df_test.target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>CountVectorizer</code> turns text into numerical features. Here’s what’s happening in the code above:</p>
<ul>
<li><strong>Lines 1 to 4:</strong> You use <code>CountVectorizer</code> to build a bag of words representation of <code>clean_text</code>. You specify two parameters: <code>ngram_range</code> and <code>stop_words</code>. <code>ngram_range</code> is the range of n-grams that the function will use. An n-gram is a sequence of <em>n</em> words. <code>(1, 3)</code> means that the function will use sequences of 1, 2, and 3 words to generate the counts. <code>stop_words</code> is a list of words that the function will ignore. In this case, the list “english” means that the function will ignore the most common words in English.</li>
<li><strong>Lines 6 and 7:</strong> You generate the matrices of token counts for your training and testing set and save them into <code>X_train</code> and <code>X_test</code>.</li>
<li><strong>Lines 9 and 10:</strong> You save the response variable from the training and testing set into <code>y_train</code> and <code>y_test</code>.</li>
</ul>
<p>Next, you’ll train your text classification model.</p>
</section>
</section>
<section id="train-and-evaluate-the-model" class="level2">
<h2 class="anchored" data-anchor-id="train-and-evaluate-the-model">Train and Evaluate the Model</h2>
<p>Finally, you can train the model by running this code:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>nb <span class="op">=</span> MultinomialNB()</span>
<span id="cb8-2"><a href="#cb8-2"></a>nb.fit(X_train, y_train)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>preds <span class="op">=</span> nb.predict(X_test)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="bu">print</span>(classification_report(y_test, preds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In <strong>lines 1 and 2</strong>, you train a <a href="https://scikit-learn.org/stable/modules/generated/sklearn.naive_bayes.MultinomialNB.html">Multinomial Naive Bayes</a> model. This simple probabilistic model is commonly used in cases with discrete features such as word counts.</p>
<p>Then, in <strong>lines 4 and 5</strong>, you evaluate the model’s results by computing the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_recall_fscore_support.html">precision, recall, and f1 scores</a>.</p>
<p>After you run the code, you’ll get an output that will look something like this:</p>
<p><img src="images/text-classification-using-python-and-scikit-learn/image-3.png" class="img-fluid">You’ve trained the model and obtained the relevant evaluation metrics. You achieved an 0.83 f1 score, which is not bad!</p>
<p>Next, you’ll learn how to save and load your model so that you can use it for inference.</p>
</section>
<section id="saving-and-loading-the-model" class="level2">
<h2 class="anchored" data-anchor-id="saving-and-loading-the-model">Saving and Loading the Model</h2>
<p>If you’d like to save the model for later, then you can use <code>joblib</code>. You’ll need to save all the artifacts required to run the model, which in this case would be the vectorizer <code>vec</code> and the model <code>nb</code>.</p>
<p>You can use the following code to save your model artifacts:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>joblib.dump(nb, <span class="st">"nb.joblib"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>joblib.dump(vec, <span class="st">"vec.joblib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to reuse your model later, simply read it and use it to classify new data samples as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>nb_saved <span class="op">=</span> joblib.load(<span class="st">"nb.joblib"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>vec_saved <span class="op">=</span> joblib.load(<span class="st">"vec.joblib"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>sample_text <span class="op">=</span> [<span class="st">"Space, Stars, Planets and Astronomy!"</span>]</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># Process the text in the same way you did when you trained it!</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>clean_sample_text <span class="op">=</span> process_text(sample_text)</span>
<span id="cb10-8"><a href="#cb10-8"></a>sample_vec <span class="op">=</span> vec_saved.transform(sample_text)</span>
<span id="cb10-9"><a href="#cb10-9"></a>nb_saved.predict(sample_vec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The code above will read the previously saved artifacts into <code>nb_saved</code> and <code>vec_saved</code>. Then you can apply them to new samples of text you’d like to classify.</p>
<p>That’s all! You’ve learned how to use Python and Scikit-learn to train a text classification model. Let me offer some suggestions for what you could do next.</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>If you want to take your modeling skills to the next level, here are some ideas to explore:</p>
<ul>
<li>Using <a href="https://scikit-learn.org/stable/modules/cross_validation.html">Cross-validation</a> to ensure that your results generalize well.</li>
<li>Get the best out of your model by tuning your <a href="https://scikit-learn.org/stable/modules/grid_search.html">model’s hyperparameters</a>.</li>
<li>Using <code>scikit-learn</code>’s <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html">pipelines</a> to generate fewer artifacts and simplify deployment.</li>
</ul>
<p>Also, given the latest advances in Natural Language Processing (NLP), transformer-based approaches are becoming the go-to options for many problems that use text features. A good starting point is <a href="https://huggingface.co/course/chapter1/1">huggingface’s NLP course</a>.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In Machine Learning, text classification is the task of labeling pieces of text through automated methods. This tutorial showed you how to build your first text classification model using Python and Scikit-learn.</p>
<p>You’ve learned:</p>
<ul>
<li>How to <strong>clean text data</strong> <strong>and create features</strong> for your model.</li>
<li>How to <strong>train a text classification model</strong> and generate evaluation metrics.</li>
<li>How to <strong>save and load your model</strong> for future use.</li>
</ul>
<p>If you have any questions or feedback, let me know in the comments!</p>
<p>All the code for this tutorial is <a href="https://github.com/dylanjcastillo/random/blob/main/text_classification.ipynb">available on GitHub.</a></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{castillo2022,
  author = {Castillo, Dylan},
  title = {Text {Classification} {Using} {Python} and {Scikit-learn}},
  date = {2022-08-23},
  url = {https://dylanjcastillo.github.io/blog/posts/text-classification-using-python-and-scikit-learn.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-castillo2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Castillo, Dylan. 2022. <span>“Text Classification Using Python and
Scikit-Learn.”</span> August 23, 2022. <a href="https://dylanjcastillo.github.io/blog/posts/text-classification-using-python-and-scikit-learn.html">https://dylanjcastillo.github.io/blog/posts/text-classification-using-python-and-scikit-learn.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/dylanjcastillo\.github\.io\/blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="dylanjcastillo/blog_comments" issue-term="pathname" theme="dark-blue" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Dylan Castillo</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>