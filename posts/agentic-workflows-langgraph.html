<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dylan Castillo">
<meta name="dcterms.date" content="2025-07-03">
<meta name="description" content="How to build frequently used agentic workflows with LangGraph">

<title>Agentic workflows with LangGraph – Dylan Castillo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/logo.webp" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-02fbb510e4cffa154b4bcf141135e604.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&amp;display=swap" rel="stylesheet">
<script src="https://cdn.usefathom.com/script.js" data-site="ZJFQREIA" defer=""></script>


<meta property="og:title" content="Agentic workflows with LangGraph – Dylan Castillo">
<meta property="og:description" content="">
<meta property="og:image" content="https://dylancastillo.co/posts/agentic-workflows-langgraph_files/figure-html/cell-10-output-1.png">
<meta property="og:site_name" content="Dylan Castillo">
<meta property="og:image:height" content="456">
<meta property="og:image:width" content="298">
<meta name="twitter:title" content="Agentic workflows with LangGraph – Dylan Castillo">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://dylancastillo.co/posts/agentic-workflows-langgraph_files/figure-html/cell-10-output-1.png">
<meta name="twitter:creator" content="@dylanjcastillo">
<meta name="twitter:site" content="@dylanjcastillo">
<meta name="twitter:image-height" content="456">
<meta name="twitter:image-width" content="298">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/dylanjcastillo"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:github" aria-label="Icon github from fa6-brands Iconify.design set." title="Icon github from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/dylanjcastillo/"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:linkedin" aria-label="Icon linkedin from fa6-brands Iconify.design set." title="Icon linkedin from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-an-agent" id="toc-what-is-an-agent" class="nav-link active" data-scroll-target="#what-is-an-agent">What is an agent?</a></li>
  <li><a href="#what-is-an-agentic-workflow" id="toc-what-is-an-agentic-workflow" class="nav-link" data-scroll-target="#what-is-an-agentic-workflow">What is an agentic workflow?</a></li>
  <li><a href="#how-to-choose-between-agentic-workflows-and-agents" id="toc-how-to-choose-between-agentic-workflows-and-agents" class="nav-link" data-scroll-target="#how-to-choose-between-agentic-workflows-and-agents">How to choose between agentic workflows and agents?</a></li>
  <li><a href="#what-is-langgraph" id="toc-what-is-langgraph" class="nav-link" data-scroll-target="#what-is-langgraph">What is LangGraph?</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#workflows" id="toc-workflows" class="nav-link" data-scroll-target="#workflows">Workflows</a>
  <ul class="collapse">
  <li><a href="#prompt-chaining" id="toc-prompt-chaining" class="nav-link" data-scroll-target="#prompt-chaining">Prompt chaining</a></li>
  <li><a href="#router" id="toc-router" class="nav-link" data-scroll-target="#router">Router</a></li>
  <li><a href="#parallelization" id="toc-parallelization" class="nav-link" data-scroll-target="#parallelization">Parallelization</a></li>
  <li><a href="#orchestrator-workers" id="toc-orchestrator-workers" class="nav-link" data-scroll-target="#orchestrator-workers">Orchestrator-workers</a></li>
  <li><a href="#evaluator-optimizer" id="toc-evaluator-optimizer" class="nav-link" data-scroll-target="#evaluator-optimizer">Evaluator-optimizer</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<button onclick="window.location.href='https://subscribe.dylancastillo.co'" style="background-color: #eb841b; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; transition: background-color 0.3s ease;">
Subscribe to my newsletter
</button>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Agentic workflows with LangGraph</h1>
  <div class="quarto-categories">
    <div class="quarto-category">llm</div>
    <div class="quarto-category">python</div>
    <div class="quarto-category">anthropic</div>
    <div class="quarto-category">openai</div>
    <div class="quarto-category">agents</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://dylancastillo.co">Dylan Castillo</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://iwanalabs.com">
            Iwana Labs
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 3, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 3, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>These days, everyone is “building” agents. But, in my experience, they’re either not really building agents, or they shouldn’t be!</p>
<p>Agents are powerful tools, but they’re not the right tool for many business problems. They give a lot of responsibility to LLMs, and that’s not always a good idea.</p>
<p>Their counterpart, agentic workflows, are a more controlled way to use LLMs. They’re a good fit for many business problems, and they’re a lot easier to build than agents.</p>
<p>In this post, I’ll explain what an agent is, what an agentic workflow is, and how to choose between them. I’ll also show you how to build the most common agentic workflows.</p>
<p>This post is based on <a href="https://www.anthropic.com/engineering/building-effective-agents">Anthropic’s Building Effective Agents</a>. I encourage you to read it.</p>
<section id="what-is-an-agent" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-agent">What is an agent?</h2>
<p>Over time, the ecosystem has converged on similar definitions:</p>
<p>Anthropic’s definition:</p>
<blockquote class="blockquote">
<p>“Systems where LLMs dynamically direct their own processes and tool usage, maintaining control over how they accomplish tasks.”</p>
<p><a href="https://www.anthropic.com/engineering/building-effective-agents">Building Effective Agents</a>, Anthropic</p>
</blockquote>
<p>OpenAI’s definition:</p>
<blockquote class="blockquote">
<p>“Systems that independently accomplish tasks on behalf of users”</p>
<p><a href="https://openai.com/index/new-tools-for-building-agents/">New tools for building agents</a>, OpenAI</p>
</blockquote>
<p>LangChain’s definition:</p>
<blockquote class="blockquote">
<p>“system that uses an LLM to decide the control flow of an application.”</p>
<p><a href="https://blog.langchain.com/what-is-an-agent/">What is an agent?</a>, LangChain</p>
</blockquote>
<p>These definitions share the idea that agents are systems that can:</p>
<ol type="1">
<li>Make decisions</li>
<li>Use tools</li>
<li>Take actions</li>
<li>Accomplish goals without constant human guidance</li>
</ol>
<p>This gives us a clear delimiter as to what an agent is and what it is not. However, this definition leaves out the majority of agentic systems being build by companies right now. These systems are called <strong>agentic workflows</strong>.</p>
</section>
<section id="what-is-an-agentic-workflow" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-agentic-workflow">What is an agentic workflow?</h2>
<p>Anthropic defines agentic workflows as systems where “LLMs and tools are orchestrated through predefined code paths”. They’re different from agents in that they don’t have the ability to dynamically direct their own processes and tool usage.</p>
<p>Workflows sound less sexy than agents, so you would rarely hear someone say they’re building workflows. However, in my experience, most people are (or should be) building workflows.</p>
</section>
<section id="how-to-choose-between-agentic-workflows-and-agents" class="level2">
<h2 class="anchored" data-anchor-id="how-to-choose-between-agentic-workflows-and-agents">How to choose between agentic workflows and agents?</h2>
<p>Choose agents for open-ended tasks where the number and the order of steps is not known beforehand. The LLM will potentially operate for many turns, and you must have some level of trust in its decision-making.</p>
<p>For example, a coding assistant is a good candidate for an agent. When you ask it to implement a feature, there’s no predefined path nor the order of steps is known beforehand. It might need to create files, add new dependencies, edit existing files, etc.</p>
<p>Agentic workflows make sense for tasks where the number and the order of steps is known beforehand. For example, an AI assistant that generates an initial draft of an article based on internal data sources. The order of steps are likely known beforehand (e.g., retrieve the key information from the internal data sources, generate a first candidate, and then revise the article).</p>
</section>
<section id="what-is-langgraph" class="level2">
<h2 class="anchored" data-anchor-id="what-is-langgraph">What is LangGraph?</h2>
<p>LangGraph is a graph-based framework for building complex LLM applications, designed for stateful workflows. It enables complex agent architectures with minimal code.</p>
<p>It uses a graph-based approach to build agentic systems. The graph is composed of nodes and edges. Nodes are the units of work (functions, tools, models). Edges define the workflow paths between nodes. State is persistent data passed between nodes and updated through reducers.</p>
<p>I’ve built many workflows from scratch, and I’ve realized that I often end up reinventing the same patterns that frameworks like LangGraph provide. I like LangGraph because it provides you with easy-to-use components, a simple API, and it lets you visualize your workflow. It also integrates well with LangSmith, a tool for monitoring and debugging LLM applications.</p>
<p>In this tutorial, I’ll show you how to build common agentic workflows with and without LangGraph. I’ll use <em>LangChain</em> as a thin wrapper on top of OpenAI models.</p>
</section>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<p>To follow this tutorial you’ll need to:</p>
<ol type="1">
<li>Sign up and generate an API key in <a href="https://platform.openai.com/docs/overview">OpenAI</a>.</li>
<li>Set the API key as an environment variable called <code>OPENAI_API_KEY</code>.</li>
<li>Create a virtual environment in Python and install the requirements:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="bu">source</span> venv/bin/activate</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="ex">pip</span> install langchain langchain-openai langchain-community langgraph jupyter nest_asyncio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you’ve completed the steps above, you can run the code from this article. You can also download the notebook from <a href="https://github.com/dylanjcastillo/blog/tree/main/posts/agentic-workflows-langgraph-pyndantic-ai.ipynb">here</a>.</p>
<p>You also need to apply a small patch to make sure you can run asyncio inside the notebook:</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>nest_asyncio.<span class="bu">apply</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will use <code>asyncio</code> inside the notebook, so you need to install and apply <code>nest_asyncio</code>. Otherwise, you’ll get a <code>RuntimeError</code> when running the code.</p>
</section>
<section id="workflows" class="level2">
<h2 class="anchored" data-anchor-id="workflows">Workflows</h2>
<p>As usual, you must start by importing the necessary libraries and loading the environment variables. You’ll use the same model in all the examples, so you’ll define it once here:</p>
<div id="cell-6" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> asyncio</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> operator</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">from</span> typing <span class="im">import</span> Annotated, Literal, Optional, TypedDict</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="im">from</span> langchain_core.messages <span class="im">import</span> HumanMessage, SystemMessage</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="im">from</span> langchain_openai <span class="im">import</span> ChatOpenAI</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="im">from</span> langgraph.graph <span class="im">import</span> END, START, StateGraph</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="im">from</span> langgraph.types <span class="im">import</span> Send</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a>load_dotenv()</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>model <span class="op">=</span> ChatOpenAI(model<span class="op">=</span><span class="st">"gpt-4.1-mini"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code imports the necessary libraries for building agentic workflows:</p>
<ul>
<li><strong>LangChain</strong>: For working with LLMs, messages, and structured outputs</li>
<li><strong>LangGraph</strong>: For building stateful workflows with nodes and edges</li>
<li><strong>Pydantic</strong>: For data validation and structured data models</li>
</ul>
<p>The <code>load_dotenv()</code> function loads environment variables from a <code>.env</code> file, including your OpenAI API key. You also define model (<code>gpt-4.1-mini</code>) that you’ll use in all the examples.</p>
<section id="prompt-chaining" class="level3">
<h3 class="anchored" data-anchor-id="prompt-chaining">Prompt chaining</h3>
<p>This workflow is designed for tasks that can be easily divided into subtasks. The key trade-off is accepting longer completion times (higher latency) in exchange for a higher-quality result.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Generating content in a pipeline by generating table of contents, content, revisions, translations, etc.</li>
<li>Generating a text through a multi-step process to evaluate if it matches certain criteria</li>
</ul>
<p>Now I’ll show you how to implement a prompt chaining workflow for generating an article. The workflow will be composed of three steps:</p>
<ol type="1">
<li>Generate a table of contents for the article</li>
<li>Generate the content of the article</li>
<li>Revise the content of the article if it’s too long</li>
</ol>
<p>I’ll show you a vanilla implementation and then a LangGraph implementation.</p>
<section id="vanilla-langchain" class="level4">
<h4 class="anchored" data-anchor-id="vanilla-langchain">Vanilla (+LangChain)</h4>
<p>First, you need to define the state of the workflow and a model to use for the LLM. You’ll use Pydantic for the state and LangChain for the model.</p>
<div id="cell-11" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">class</span> State(BaseModel):</span>
<span id="cb4-2"><a href="#cb4-2"></a>    topic: <span class="bu">str</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    table_of_contents: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    content: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>    revised_content: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you need to define the functions that will be used in the workflow:</p>
<div id="cell-13" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">def</span> generate_table_of_contents(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-2"><a href="#cb5-2"></a>    messages <span class="op">=</span> [</span>
<span id="cb5-3"><a href="#cb5-3"></a>        SystemMessage(</span>
<span id="cb5-4"><a href="#cb5-4"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, you will generate the table of contents for a short article."</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>        ),</span>
<span id="cb5-6"><a href="#cb5-6"></a>        HumanMessage(</span>
<span id="cb5-7"><a href="#cb5-7"></a>            content<span class="op">=</span><span class="ss">f"Generate the table of contents of an article about </span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>        ),</span>
<span id="cb5-9"><a href="#cb5-9"></a>    ]</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="cf">return</span> model.invoke(messages).content</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="kw">def</span> generate_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-14"><a href="#cb5-14"></a>    messages <span class="op">=</span> [</span>
<span id="cb5-15"><a href="#cb5-15"></a>        SystemMessage(</span>
<span id="cb5-16"><a href="#cb5-16"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic and a table of contents, you will generate the content of the article."</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>        ),</span>
<span id="cb5-18"><a href="#cb5-18"></a>        HumanMessage(</span>
<span id="cb5-19"><a href="#cb5-19"></a>            content<span class="op">=</span><span class="ss">f"Generate the content of an article about </span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss"> with the following table of contents: </span><span class="sc">{</span>state<span class="sc">.</span>table_of_contents<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>        ),</span>
<span id="cb5-21"><a href="#cb5-21"></a>    ]</span>
<span id="cb5-22"><a href="#cb5-22"></a>    <span class="cf">return</span> model.invoke(messages).content</span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="kw">def</span> revise_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-26"><a href="#cb5-26"></a>    messages <span class="op">=</span> [</span>
<span id="cb5-27"><a href="#cb5-27"></a>        SystemMessage(</span>
<span id="cb5-28"><a href="#cb5-28"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, a table of contents and a content, you will revise the content of the article to make it less than 1000 characters."</span></span>
<span id="cb5-29"><a href="#cb5-29"></a>        ),</span>
<span id="cb5-30"><a href="#cb5-30"></a>        HumanMessage(</span>
<span id="cb5-31"><a href="#cb5-31"></a>            content<span class="op">=</span><span class="ss">f"Revise the content of an article about </span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss"> with the following table of contents: </span><span class="sc">{</span>state<span class="sc">.</span>table_of_contents<span class="sc">}</span><span class="ss"> and the following content:</span><span class="ch">\n\n</span><span class="sc">{</span>state<span class="sc">.</span>content<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>        ),</span>
<span id="cb5-33"><a href="#cb5-33"></a>    ]</span>
<span id="cb5-34"><a href="#cb5-34"></a>    <span class="cf">return</span> model.invoke(messages).content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These functions provide the core functionality of the workflow. They follow the steps I outlined above:</p>
<ol type="1">
<li><code>generate_table_of_contents</code>: Generate a table of contents for the article</li>
<li><code>generate_article_content</code>: Generate the content of the article</li>
<li><code>revise_article_content</code>: Revise the content of the article if it’s too long</li>
</ol>
<p>Then we need to orchestrate the workflow. You’ll do that by creating a function that takes a topic and returns the final article.</p>
<div id="cell-15" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">def</span> run_workflow(topic: <span class="bu">str</span>) <span class="op">-&gt;</span> State:</span>
<span id="cb6-2"><a href="#cb6-2"></a>    article <span class="op">=</span> State(topic<span class="op">=</span>topic)</span>
<span id="cb6-3"><a href="#cb6-3"></a>    article.table_of_contents <span class="op">=</span> generate_table_of_contents(article)</span>
<span id="cb6-4"><a href="#cb6-4"></a>    article.content <span class="op">=</span> generate_article_content(article)</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="cf">if</span> <span class="bu">len</span>(article.content) <span class="op">&gt;</span> <span class="dv">1000</span>:</span>
<span id="cb6-6"><a href="#cb6-6"></a>        article.revised_content <span class="op">=</span> revise_article_content(article)</span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="cf">return</span> article</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a>output <span class="op">=</span> run_workflow(<span class="st">"Artificial Intelligence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>run_workflow</code> takes the topic provided by the user, generates an article, and verifies that it’s below 1000 characters. Depending on the result, it will revise the article or not. Finally, it returns the state that contains all the results from the workflow (the table of contents, the content, and the revised content).</p>
</section>
<section id="langgraph" class="level4">
<h4 class="anchored" data-anchor-id="langgraph">LangGraph</h4>
<p>Now let’s see how to implement the same workflow using LangGraph. You will noticed two key differences compared to the vanilla implementation.</p>
<p>Similar to the vanilla implementation, you’ll start by initializing the state class:</p>
<div id="cell-19" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">class</span> State(TypedDict):</span>
<span id="cb7-2"><a href="#cb7-2"></a>    topic: <span class="bu">str</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    table_of_contents: <span class="bu">str</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    content: <span class="bu">str</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>    revised_content: <span class="bu">str</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When working with LangGraph, I’d suggest to use a <code>TypedDict</code> to manage your state. Using a Pydantic model to manage your state in LangGraph has a few downsides:</p>
<ol type="1">
<li>Data types are only checked when they enter a node, not when they exit. This means you could accidentally save data of the wrong type to your state.</li>
<li>The final output of the entire graph will be a dictionary, not your Pydantic model.</li>
<li>The implementation feels like it’s <a href="https://github.com/langchain-ai/langgraph/discussions/1306">half-baked</a>.</li>
</ol>
<p>For more details, check out the <a href="https://langchain-ai.github.io/langgraph/how-tos/graph-api/#use-pydantic-models-for-graph-state">LangGraph documentation</a>.</p>
<p>Then, you’ll define the nodes (functions) that will be used in the workflow.</p>
<div id="cell-21" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">def</span> generate_table_of_contents(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb8-2"><a href="#cb8-2"></a>    messages <span class="op">=</span> [</span>
<span id="cb8-3"><a href="#cb8-3"></a>        SystemMessage(</span>
<span id="cb8-4"><a href="#cb8-4"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, you will generate the table of contents for a short article."</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>        ),</span>
<span id="cb8-6"><a href="#cb8-6"></a>        HumanMessage(</span>
<span id="cb8-7"><a href="#cb8-7"></a>            content<span class="op">=</span><span class="ss">f"Generate the table of contents of an article about </span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>        ),</span>
<span id="cb8-9"><a href="#cb8-9"></a>    ]</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="cf">return</span> {<span class="st">"table_of_contents"</span>: model.invoke(messages).content}</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="kw">def</span> generate_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-14"><a href="#cb8-14"></a>    messages <span class="op">=</span> [</span>
<span id="cb8-15"><a href="#cb8-15"></a>        SystemMessage(</span>
<span id="cb8-16"><a href="#cb8-16"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic and a table of contents, you will generate the content of the article."</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>        ),</span>
<span id="cb8-18"><a href="#cb8-18"></a>        HumanMessage(</span>
<span id="cb8-19"><a href="#cb8-19"></a>            content<span class="op">=</span><span class="ss">f"Generate the content of an article about </span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss"> with the following table of contents: </span><span class="sc">{</span>state[<span class="st">'table_of_contents'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>        ),</span>
<span id="cb8-21"><a href="#cb8-21"></a>    ]</span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="cf">return</span> {<span class="st">"content"</span>: model.invoke(messages).content}</span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="kw">def</span> check_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-26"><a href="#cb8-26"></a>    <span class="cf">if</span> <span class="bu">len</span>(state[<span class="st">"content"</span>]) <span class="op">&gt;</span> <span class="dv">1000</span>:</span>
<span id="cb8-27"><a href="#cb8-27"></a>        <span class="cf">return</span> <span class="st">"Fail"</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>    <span class="cf">return</span> <span class="st">"Pass"</span></span>
<span id="cb8-29"><a href="#cb8-29"></a></span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="kw">def</span> revise_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-32"><a href="#cb8-32"></a>    messages <span class="op">=</span> [</span>
<span id="cb8-33"><a href="#cb8-33"></a>        SystemMessage(</span>
<span id="cb8-34"><a href="#cb8-34"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, a table of contents and a content, you will revise the content of the article to make it less than 1000 characters."</span></span>
<span id="cb8-35"><a href="#cb8-35"></a>        ),</span>
<span id="cb8-36"><a href="#cb8-36"></a>        HumanMessage(</span>
<span id="cb8-37"><a href="#cb8-37"></a>            content<span class="op">=</span><span class="ss">f"Revise the content of an article about </span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss"> with the following table of contents: </span><span class="sc">{</span>state[<span class="st">'table_of_contents'</span>]<span class="sc">}</span><span class="ss"> and the following content:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'content'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>        ),</span>
<span id="cb8-39"><a href="#cb8-39"></a>    ]</span>
<span id="cb8-40"><a href="#cb8-40"></a>    <span class="cf">return</span> {<span class="st">"revised_content"</span>: model.invoke(messages).content}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll noticed that the functions are quite similar to the vanilla implementation. The only difference is that they return dictionaries that automatically update the state rather than you having to do it manually.</p>
<p>Then you need to specify the nodes and edges of the workflow:</p>
<div id="cell-23" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>workflow_builder <span class="op">=</span> StateGraph(State)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>workflow_builder.add_node(<span class="st">"generate_table_of_contents"</span>, generate_table_of_contents)</span>
<span id="cb9-4"><a href="#cb9-4"></a>workflow_builder.add_node(<span class="st">"generate_article_content"</span>, generate_article_content)</span>
<span id="cb9-5"><a href="#cb9-5"></a>workflow_builder.add_node(<span class="st">"revise_article_content"</span>, revise_article_content)</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a>workflow_builder.add_edge(START, <span class="st">"generate_table_of_contents"</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a>workflow_builder.add_edge(<span class="st">"generate_table_of_contents"</span>, <span class="st">"generate_article_content"</span>)</span>
<span id="cb9-9"><a href="#cb9-9"></a>workflow_builder.add_conditional_edges(</span>
<span id="cb9-10"><a href="#cb9-10"></a>    source<span class="op">=</span><span class="st">"generate_article_content"</span>,</span>
<span id="cb9-11"><a href="#cb9-11"></a>    path<span class="op">=</span>check_article_content,</span>
<span id="cb9-12"><a href="#cb9-12"></a>    path_map<span class="op">=</span>{<span class="st">"Fail"</span>: <span class="st">"revise_article_content"</span>, <span class="st">"Pass"</span>: END},</span>
<span id="cb9-13"><a href="#cb9-13"></a>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>workflow_builder.add_edge(<span class="st">"revise_article_content"</span>, END)</span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-16"><a href="#cb9-16"></a>workflow <span class="op">=</span> workflow_builder.<span class="bu">compile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You initialize a <code>StateGraph</code> object, which is a builder for the workflow. Then you add nodes to the graph, and define the edges between them. The nodes in the graphs are the functions that you defined earlier. In the conditional edge, you can define the path that the workflow will take based on the state of the workflow.</p>
<p>The <code>compile</code> method is used to compile the graph into a callable workflow.</p>
<p>Finally, LangGraph has a nice feature that allows you to visualize the workflow. You can use the <code>get_graph</code> and <code>draw_mermaid_png</code> for that:</p>
<div id="cell-25" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>display(Image(workflow.get_graph().draw_mermaid_png()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="agentic-workflows-langgraph_files/figure-html/cell-10-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="agentic-workflows-langgraph_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Finally, you can run the workflow by calling the <code>invoke</code> method on the compiled workflow and provide the initial state.</p>
<div id="cell-27" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>article <span class="op">=</span> workflow.invoke({<span class="st">"topic"</span>: <span class="st">"Artificial Intelligence"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And you’ll get the following output:</p>
<div id="cell-29" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>article</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>{'topic': 'Artificial Intelligence',
 'table_of_contents': 'Table of Contents\n\n1. Introduction to Artificial Intelligence  \n2. History and Evolution of AI  \n3. Types of Artificial Intelligence  \n4. Applications of AI in Various Industries  \n5. Benefits of Artificial Intelligence  \n6. Challenges and Ethical Considerations  \n7. The Future of Artificial Intelligence  \n8. Conclusion',
 'content': '# Artificial Intelligence: Transforming the Future\n\n## 1. Introduction to Artificial Intelligence\n\nArtificial Intelligence (AI) refers to the simulation of human intelligence processes by machines, especially computer systems. These processes include learning, reasoning, problem-solving, perception, and language understanding. AI enables machines to perform tasks that typically require human intelligence, making them smarter, more efficient, and capable of handling complex scenarios. From virtual assistants and recommendation systems to autonomous vehicles, AI has become an integral part of modern technology.\n\n## 2. History and Evolution of AI\n\nThe concept of artificial intelligence dates back to the mid-20th century. In 1956, the term “Artificial Intelligence” was coined during the Dartmouth Conference, marking the official birth of AI as a research field. Early AI research focused on symbolic methods and rule-based systems. Over the decades, advancements in algorithms, computational power, and data availability propelled AI development. Notable milestones include the creation of expert systems in the 1970s and 1980s, the rise of machine learning in the 1990s, and the advent of deep learning in the 2010s. Today, AI continues to evolve rapidly, driven by breakthroughs in neural networks and big data analytics.\n\n## 3. Types of Artificial Intelligence\n\nAI can be broadly categorized into three types based on capabilities:\n\n- **Narrow AI (Weak AI):** Designed to perform specific tasks such as voice recognition or image classification. This is the most common form of AI today.\n  \n- **General AI (Strong AI):** A theoretical form of AI that possesses the ability to understand, learn, and perform any intellectual task a human can do.\n  \n- **Superintelligent AI:** A hypothetical AI that surpasses all human intelligence across all fields, potentially possessing self-awareness and superior problem-solving abilities.\n\nAdditionally, AI can be classified based on functionalities such as reactive machines, limited memory systems, theory of mind AI, and self-aware AI, reflecting increasing complexity and cognitive capability.\n\n## 4. Applications of AI in Various Industries\n\nAI is transforming industries worldwide by streamlining operations, enhancing decision-making, and enabling innovation:\n\n- **Healthcare:** AI assists in diagnostics, personalized treatment, drug discovery, and robotic surgery.\n- **Finance:** Fraud detection, algorithmic trading, customer support, and risk management benefit from AI solutions.\n- **Retail:** AI powers recommendation engines, inventory management, and customer behavior analysis.\n- **Manufacturing:** Predictive maintenance, quality control, and automation improve efficiency.\n- **Transportation:** Autonomous vehicles, route optimization, and traffic management leverage AI technologies.\n- **Education:** Personalized learning experiences, automated grading, and virtual tutors utilize AI capabilities.\n\n## 5. Benefits of Artificial Intelligence\n\nThe adoption of AI provides numerous advantages:\n\n- **Efficiency:** Automates repetitive tasks, reducing time and labor costs.\n- **Accuracy:** Minimizes human error and enhances precision in complex processes.\n- **Data Insights:** Analyzes vast datasets to uncover trends, patterns, and actionable insights.\n- **Innovation:** Facilitates the creation of new products and services.\n- **Personalization:** Tailors experiences and recommendations to individual preferences.\n- **Accessibility:** Makes services more accessible through natural language processing and intelligent interfaces.\n\n## 6. Challenges and Ethical Considerations\n\nDespite its promise, AI poses several challenges and ethical dilemmas:\n\n- **Bias and Fairness:** AI systems can inherit biases from training data, leading to unfair outcomes.\n- **Privacy Concerns:** Extensive data collection raises issues about user privacy and data security.\n- **Job Displacement:** Automation may disrupt labor markets and professions.\n- **Transparency:** Many AI algorithms, especially deep learning models, lack interpretability.\n- **Accountability:** Determining responsibility in the case of AI failures or misuse is complex.\n- **Ethical Use:** Ensuring AI is used for beneficial purposes and preventing misuse such as in autonomous weapons is critical.\n\nAddressing these concerns requires robust governance, regulation, and ongoing dialogue between stakeholders.\n\n## 7. The Future of Artificial Intelligence\n\nThe future of AI is poised to reshape society profoundly:\n\n- **Enhanced Human-AI Collaboration:** AI will increasingly augment human capabilities rather than replace them.\n- **Advancements in General AI:** Research continues toward achieving more versatile, human-like AI.\n- **AI in Creativity:** Emerging AI tools will enhance creative processes in art, music, and writing.\n- **Integration with IoT:** AI combined with the Internet of Things will enable smarter environments and cities.\n- **Ethical AI Development:** Emphasis will grow on developing transparent, fair, and accountable AI systems.\n- **AI for Global Challenges:** AI will play a pivotal role in addressing climate change, healthcare crises, and education gaps.\n\nContinued innovation, balanced with ethical considerations, will ensure AI’s positive impact on humanity.\n\n## 8. Conclusion\n\nArtificial Intelligence has evolved from a conceptual idea to a transformative force across industries and societies. Its ability to process information, learn, and make decisions holds tremendous potential to improve lives and drive progress. However, realizing this potential requires careful management of ethical challenges and inclusive development. As AI continues to mature, it promises a future where intelligent machines and humans work collaboratively to solve complex problems and create new opportunities. Embracing AI responsibly will be key to unlocking its benefits for generations to come.',
 'revised_content': 'Artificial Intelligence (AI) simulates human intelligence in machines, enabling tasks like learning, reasoning, and problem-solving. Since its inception at the 1956 Dartmouth Conference, AI has evolved from rule-based systems to advanced machine learning and deep learning models. AI types include Narrow AI, designed for specific tasks; General AI, capable of human-like understanding; and Superintelligent AI, a hypothetical superior intellect. AI revolutionizes industries—improving healthcare diagnostics, financial fraud detection, retail personalization, manufacturing automation, transportation logistics, and education. Benefits include efficiency, accuracy, data-driven insights, innovation, and personalization. However, AI raises challenges such as bias, privacy, job displacement, transparency, and ethical use. The future promises enhanced human-AI collaboration, ethical development, and AI-driven solutions for global issues. Responsible AI integration will transform society, fostering progress and innovation.'}</code></pre>
</div>
</div>
<p>That’s it for prompt chaining. Next, you’ll see how to implement a router workflow.</p>
</section>
</section>
<section id="router" class="level3">
<h3 class="anchored" data-anchor-id="router">Router</h3>
<p>Routing is a sorting system that sends each task to the right place for the best handling. This process can be managed by an LLM or a traditional classification model. It makes sense to use when a system needs to apply different logic to different types of queries.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Classify complexity of question and adjust model depending on it</li>
<li>Classify type of query and use specialized tools (e.g., indexes, prompts)</li>
</ul>
<p>I’ll walk you through a simple example of a router workflow. The workflow will be composed of two steps:</p>
<ol type="1">
<li>Classify the type of query</li>
<li>Route the query to the right place</li>
</ol>
<p>I’ll show you a vanilla implementation and then a LangGraph implementation.</p>
<section id="vanilla-langchain-1" class="level4">
<h4 class="anchored" data-anchor-id="vanilla-langchain-1">Vanilla (+LangChain)</h4>
<p>First, you need to initialize the model, and define the state of the workflow and the data models. You’ll use Pydantic for the state and data models validation and LangChain for the LLM interactions.</p>
<div id="cell-34" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">class</span> State(BaseModel):</span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="bu">input</span>: <span class="bu">str</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="bu">type</span>: Optional[</span>
<span id="cb14-4"><a href="#cb14-4"></a>        Literal[<span class="st">"write_article"</span>, <span class="st">"generate_table_of_contents"</span>, <span class="st">"review_article"</span>]</span>
<span id="cb14-5"><a href="#cb14-5"></a>    ] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    output: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="kw">class</span> MessageType(BaseModel):</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="bu">type</span>: Literal[<span class="st">"write_article"</span>, <span class="st">"generate_table_of_contents"</span>, <span class="st">"review_article"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you need to define the functions that will be used in the workflow.</p>
<div id="cell-36" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">def</span> classify_message(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb15-2"><a href="#cb15-2"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(MessageType)</span>
<span id="cb15-3"><a href="#cb15-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb15-4"><a href="#cb15-4"></a>        SystemMessage(</span>
<span id="cb15-5"><a href="#cb15-5"></a>            content<span class="op">=</span><span class="st">"You are a helpful assistant. You will classify the message into one of the following categories: 'write_article', 'generate_table_of_contents', 'review_article'."</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>        ),</span>
<span id="cb15-7"><a href="#cb15-7"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Classify the message: </span><span class="sc">{</span>state<span class="sc">.</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb15-8"><a href="#cb15-8"></a>    ]</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="cf">return</span> model_with_str_output.invoke(messages).<span class="bu">type</span></span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="kw">def</span> write_article(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb15-13"><a href="#cb15-13"></a>    messages <span class="op">=</span> [</span>
<span id="cb15-14"><a href="#cb15-14"></a>        SystemMessage(</span>
<span id="cb15-15"><a href="#cb15-15"></a>            content<span class="op">=</span><span class="st">"You are a writer. You will write an article about the topic provided."</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>        ),</span>
<span id="cb15-17"><a href="#cb15-17"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Write an article about </span><span class="sc">{</span>state<span class="sc">.</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb15-18"><a href="#cb15-18"></a>    ]</span>
<span id="cb15-19"><a href="#cb15-19"></a>    <span class="cf">return</span> model.invoke(messages).content</span>
<span id="cb15-20"><a href="#cb15-20"></a></span>
<span id="cb15-21"><a href="#cb15-21"></a></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="kw">def</span> generate_table_of_contents(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb15-23"><a href="#cb15-23"></a>    messages <span class="op">=</span> [</span>
<span id="cb15-24"><a href="#cb15-24"></a>        SystemMessage(</span>
<span id="cb15-25"><a href="#cb15-25"></a>            content<span class="op">=</span><span class="st">"You are a writer. You will generate a table of contents for an article about the topic provided."</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>        ),</span>
<span id="cb15-27"><a href="#cb15-27"></a>        HumanMessage(</span>
<span id="cb15-28"><a href="#cb15-28"></a>            content<span class="op">=</span><span class="ss">f"Generate a table of contents for an article about </span><span class="sc">{</span>state<span class="sc">.</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>        ),</span>
<span id="cb15-30"><a href="#cb15-30"></a>    ]</span>
<span id="cb15-31"><a href="#cb15-31"></a>    <span class="cf">return</span> model.invoke(messages).content</span>
<span id="cb15-32"><a href="#cb15-32"></a></span>
<span id="cb15-33"><a href="#cb15-33"></a></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="kw">def</span> review_article(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb15-35"><a href="#cb15-35"></a>    messages <span class="op">=</span> [</span>
<span id="cb15-36"><a href="#cb15-36"></a>        SystemMessage(</span>
<span id="cb15-37"><a href="#cb15-37"></a>            content<span class="op">=</span><span class="st">"You are a writer. You will review the article for the topic provided."</span></span>
<span id="cb15-38"><a href="#cb15-38"></a>        ),</span>
<span id="cb15-39"><a href="#cb15-39"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Review the article for the topic </span><span class="sc">{</span>state<span class="sc">.</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb15-40"><a href="#cb15-40"></a>    ]</span>
<span id="cb15-41"><a href="#cb15-41"></a>    <span class="cf">return</span> model.invoke(messages).content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These functions handle the core functionality of the workflow:</p>
<ol type="1">
<li><code>classify_message</code>: Uses structured outputs to determine what type of request the user is making. This is the “router” that decides which path to take.</li>
<li><code>write_article</code>: Generates a full article about the given topic</li>
<li><code>generate_table_of_contents</code>: Creates only a table of contents for an article</li>
<li><code>review_article</code>: Provides a review or critique of an existing article</li>
</ol>
<p>Finally, you need to orchestrate the workflow by creating a function that classifies the input and routes it to the appropriate handler.</p>
<div id="cell-38" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">def</span> run_workflow(message: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb16-2"><a href="#cb16-2"></a>    state <span class="op">=</span> State(<span class="bu">input</span><span class="op">=</span>message)</span>
<span id="cb16-3"><a href="#cb16-3"></a>    state.<span class="bu">type</span> <span class="op">=</span> classify_message(state)</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="cf">if</span> state.<span class="bu">type</span> <span class="op">==</span> <span class="st">"write_article"</span>:</span>
<span id="cb16-5"><a href="#cb16-5"></a>        <span class="cf">return</span> write_article(state)</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="cf">elif</span> state.<span class="bu">type</span> <span class="op">==</span> <span class="st">"generate_table_of_contents"</span>:</span>
<span id="cb16-7"><a href="#cb16-7"></a>        <span class="cf">return</span> generate_table_of_contents(state)</span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="cf">elif</span> state.<span class="bu">type</span> <span class="op">==</span> <span class="st">"review_article"</span>:</span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="cf">return</span> review_article(state)</span>
<span id="cb16-10"><a href="#cb16-10"></a>    <span class="cf">else</span>:</span>
<span id="cb16-11"><a href="#cb16-11"></a>        <span class="cf">return</span> <span class="st">"I'm sorry, I don't know how to handle that message."</span></span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a>output <span class="op">=</span> run_workflow(<span class="st">"Write an article about the meaning of life"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>run_workflow</code> takes the user’s message, classifies it to determine the intent, and then routes it to the appropriate specialized function. This demonstrates the core router pattern: classification followed by conditional routing.</p>
<p>Now let’s implement the same workflow using LangGraph.</p>
</section>
<section id="langgraph-1" class="level4">
<h4 class="anchored" data-anchor-id="langgraph-1">LangGraph</h4>
<p>Similar to the vanilla implementation, you’ll start by defining the state and data models:</p>
<div id="cell-41" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">class</span> State(TypedDict):</span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="bu">input</span>: <span class="bu">str</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="bu">type</span>: Optional[Literal[<span class="st">"write_article"</span>, <span class="st">"generate_table_of_contents"</span>, <span class="st">"review_article"</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    output: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="kw">class</span> MessageType(BaseModel):</span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="bu">type</span>: Literal[<span class="st">"write_article"</span>, <span class="st">"generate_table_of_contents"</span>, <span class="st">"review_article"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you’ll define the nodes (functions) that will be used in the workflow:</p>
<div id="cell-43" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">def</span> classify_message(message: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb18-2"><a href="#cb18-2"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(MessageType)</span>
<span id="cb18-3"><a href="#cb18-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb18-4"><a href="#cb18-4"></a>        SystemMessage(</span>
<span id="cb18-5"><a href="#cb18-5"></a>            content<span class="op">=</span><span class="st">"You are a writer. You will classify the message into one of the following categories: 'write_article', 'generate_table_of_contents', 'review_article'."</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>        ),</span>
<span id="cb18-7"><a href="#cb18-7"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Classify the message: </span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb18-8"><a href="#cb18-8"></a>    ]</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="cf">return</span> {<span class="st">"type"</span>: model_with_str_output.invoke(messages).<span class="bu">type</span>}</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="kw">def</span> route_message(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="cf">if</span> state[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"write_article"</span>:</span>
<span id="cb18-14"><a href="#cb18-14"></a>        <span class="cf">return</span> <span class="st">"generate_article_content"</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="cf">elif</span> state[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"generate_table_of_contents"</span>:</span>
<span id="cb18-16"><a href="#cb18-16"></a>        <span class="cf">return</span> <span class="st">"generate_table_of_contents"</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>    <span class="cf">elif</span> state[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"review_article"</span>:</span>
<span id="cb18-18"><a href="#cb18-18"></a>        <span class="cf">return</span> <span class="st">"revise_article_content"</span></span>
<span id="cb18-19"><a href="#cb18-19"></a>    <span class="cf">else</span>:</span>
<span id="cb18-20"><a href="#cb18-20"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid message type: </span><span class="sc">{</span>state[<span class="st">'type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a></span>
<span id="cb18-23"><a href="#cb18-23"></a><span class="kw">def</span> generate_table_of_contents(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb18-24"><a href="#cb18-24"></a>    messages <span class="op">=</span> [</span>
<span id="cb18-25"><a href="#cb18-25"></a>        SystemMessage(</span>
<span id="cb18-26"><a href="#cb18-26"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, you will generate the table of contents for a short article."</span></span>
<span id="cb18-27"><a href="#cb18-27"></a>        ),</span>
<span id="cb18-28"><a href="#cb18-28"></a>        HumanMessage(</span>
<span id="cb18-29"><a href="#cb18-29"></a>            content<span class="op">=</span><span class="ss">f"Generate the table of contents of an article about </span><span class="sc">{</span>state[<span class="st">'input'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb18-30"><a href="#cb18-30"></a>        ),</span>
<span id="cb18-31"><a href="#cb18-31"></a>    ]</span>
<span id="cb18-32"><a href="#cb18-32"></a>    <span class="cf">return</span> {<span class="st">"output"</span>: model.invoke(messages).content}</span>
<span id="cb18-33"><a href="#cb18-33"></a></span>
<span id="cb18-34"><a href="#cb18-34"></a></span>
<span id="cb18-35"><a href="#cb18-35"></a><span class="kw">def</span> generate_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb18-36"><a href="#cb18-36"></a>    messages <span class="op">=</span> [</span>
<span id="cb18-37"><a href="#cb18-37"></a>        SystemMessage(</span>
<span id="cb18-38"><a href="#cb18-38"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic and a table of contents, you will generate the content of the article."</span></span>
<span id="cb18-39"><a href="#cb18-39"></a>        ),</span>
<span id="cb18-40"><a href="#cb18-40"></a>        HumanMessage(</span>
<span id="cb18-41"><a href="#cb18-41"></a>            content<span class="op">=</span><span class="ss">f"Generate the content of an article about </span><span class="sc">{</span>state[<span class="st">'input'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb18-42"><a href="#cb18-42"></a>        ),</span>
<span id="cb18-43"><a href="#cb18-43"></a>    ]</span>
<span id="cb18-44"><a href="#cb18-44"></a>    <span class="cf">return</span> {<span class="st">"output"</span>: model.invoke(messages).content}</span>
<span id="cb18-45"><a href="#cb18-45"></a></span>
<span id="cb18-46"><a href="#cb18-46"></a></span>
<span id="cb18-47"><a href="#cb18-47"></a><span class="kw">def</span> revise_article_content(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb18-48"><a href="#cb18-48"></a>    messages <span class="op">=</span> [</span>
<span id="cb18-49"><a href="#cb18-49"></a>        SystemMessage(</span>
<span id="cb18-50"><a href="#cb18-50"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, a table of contents and a content, you will revise the content of the article to make it less than 1000 characters."</span></span>
<span id="cb18-51"><a href="#cb18-51"></a>        ),</span>
<span id="cb18-52"><a href="#cb18-52"></a>        HumanMessage(</span>
<span id="cb18-53"><a href="#cb18-53"></a>            content<span class="op">=</span><span class="ss">f"Revise the content of the following article:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'input'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb18-54"><a href="#cb18-54"></a>        ),</span>
<span id="cb18-55"><a href="#cb18-55"></a>    ]</span>
<span id="cb18-56"><a href="#cb18-56"></a>    <span class="cf">return</span> {<span class="st">"output"</span>: model.invoke(messages).content}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions are similar to the vanilla implementation, but they return dictionaries that automatically update the state rather than requiring manual state management. There’s also a new function <code>route_message</code> that acts as the router that sends the message to the right place.</p>
<p>Then, you need to specify the nodes and edges of the workflow:</p>
<div id="cell-45" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>workflow_builder <span class="op">=</span> StateGraph(State)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>workflow_builder.add_node(<span class="st">"classify_message"</span>, classify_message)</span>
<span id="cb19-4"><a href="#cb19-4"></a>workflow_builder.add_conditional_edges(</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="st">"classify_message"</span>,</span>
<span id="cb19-6"><a href="#cb19-6"></a>    route_message,</span>
<span id="cb19-7"><a href="#cb19-7"></a>    {</span>
<span id="cb19-8"><a href="#cb19-8"></a>        <span class="st">"generate_article_content"</span>: <span class="st">"generate_article_content"</span>,</span>
<span id="cb19-9"><a href="#cb19-9"></a>        <span class="st">"generate_table_of_contents"</span>: <span class="st">"generate_table_of_contents"</span>,</span>
<span id="cb19-10"><a href="#cb19-10"></a>        <span class="st">"revise_article_content"</span>: <span class="st">"revise_article_content"</span>,</span>
<span id="cb19-11"><a href="#cb19-11"></a>    },</span>
<span id="cb19-12"><a href="#cb19-12"></a>)</span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>workflow_builder.add_node(<span class="st">"generate_table_of_contents"</span>, generate_table_of_contents)</span>
<span id="cb19-15"><a href="#cb19-15"></a>workflow_builder.add_node(<span class="st">"generate_article_content"</span>, generate_article_content)</span>
<span id="cb19-16"><a href="#cb19-16"></a>workflow_builder.add_node(<span class="st">"revise_article_content"</span>, revise_article_content)</span>
<span id="cb19-17"><a href="#cb19-17"></a></span>
<span id="cb19-18"><a href="#cb19-18"></a>workflow_builder.add_edge(START, <span class="st">"classify_message"</span>)</span>
<span id="cb19-19"><a href="#cb19-19"></a>workflow_builder.add_edge(<span class="st">"generate_table_of_contents"</span>, END)</span>
<span id="cb19-20"><a href="#cb19-20"></a>workflow_builder.add_edge(<span class="st">"generate_article_content"</span>, END)</span>
<span id="cb19-21"><a href="#cb19-21"></a>workflow_builder.add_edge(<span class="st">"revise_article_content"</span>, END)</span>
<span id="cb19-22"><a href="#cb19-22"></a></span>
<span id="cb19-23"><a href="#cb19-23"></a>workflow <span class="op">=</span> workflow_builder.<span class="bu">compile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, you’ll start by creating a <code>StateGraph</code> object, which serves as the builder for your workflow. Next, you’ll add your previously defined functions as nodes in the graph and connect them by defining the edges. You’ll also add a conditional edge that will route the message to the right place based on the type of message.</p>
<p>The graph is then compiled into a runnable workflow using the <code>compile</code> method.</p>
<p>Finally, LangGraph includes a helpful feature for visualizing your workflow. For this, you can use the <code>get_graph</code> and <code>draw_mermaid_png</code> functions.</p>
<div id="cell-47" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>display(Image(workflow.get_graph().draw_mermaid_png()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="agentic-workflows-langgraph_files/figure-html/cell-19-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="agentic-workflows-langgraph_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parallelization" class="level3">
<h3 class="anchored" data-anchor-id="parallelization">Parallelization</h3>
<p>This workflow is designed for tasks that can be easily divided into independent subtasks. The key trade-off is managing complexity and coordination overhead in exchange for significant speed improvements or diverse perspectives.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Evaluate multiple independent aspects of a text (safety, quality, relevance)</li>
<li>Process user query and apply guardrails in parallel</li>
<li>Generate multiple response candidates given a query for comparison</li>
</ul>
<p>Now I’ll show you how to implement a parallelization workflow for content evaluation. The workflow will be composed of three steps:</p>
<ol type="1">
<li>Run multiple independent evaluations of the same content</li>
<li>Collect all evaluation results</li>
<li>Aggregate the results into a final assessment</li>
</ol>
<p>I’ll show you a vanilla implementation and then a LangGraph implementation.</p>
<section id="vanilla-langchain-2" class="level4">
<h4 class="anchored" data-anchor-id="vanilla-langchain-2">Vanilla (+LangChain)</h4>
<p>First, you need to define the state of the workflow and data models for evaluations. You’ll use Pydantic for the state and data models validation and LangChain for the LLM interactions.</p>
<div id="cell-51" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">class</span> Evaluation(BaseModel):</span>
<span id="cb21-2"><a href="#cb21-2"></a>    explanation: <span class="bu">str</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>    is_appropiate: <span class="bu">bool</span></span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="kw">class</span> AggregatedResults(BaseModel):</span>
<span id="cb21-7"><a href="#cb21-7"></a>    summary: <span class="bu">str</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>    is_appropiate: <span class="bu">bool</span></span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="kw">class</span> State(BaseModel):</span>
<span id="cb21-12"><a href="#cb21-12"></a>    <span class="bu">input</span>: <span class="bu">str</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>    evaluations: Optional[<span class="bu">list</span>[Evaluation]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>    aggregated_results: Optional[AggregatedResults] <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you need to define the functions with each step of the workflow.</p>
<div id="cell-53" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="cf">async</span> <span class="kw">def</span> evaluate_text(state: State) <span class="op">-&gt;</span> Evaluation:</span>
<span id="cb22-2"><a href="#cb22-2"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(Evaluation)</span>
<span id="cb22-3"><a href="#cb22-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb22-4"><a href="#cb22-4"></a>        SystemMessage(</span>
<span id="cb22-5"><a href="#cb22-5"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a text, you will evaluate if it's appropriate for a general audience."</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>        ),</span>
<span id="cb22-7"><a href="#cb22-7"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Evaluate the following text: </span><span class="sc">{</span>state<span class="sc">.</span><span class="bu">input</span><span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb22-8"><a href="#cb22-8"></a>    ]</span>
<span id="cb22-9"><a href="#cb22-9"></a>    response <span class="op">=</span> <span class="cf">await</span> model_with_str_output.ainvoke(messages)</span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="cf">return</span> response</span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="cf">async</span> <span class="kw">def</span> aggregate_results(state: State) <span class="op">-&gt;</span> State:</span>
<span id="cb22-14"><a href="#cb22-14"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(AggregatedResults)</span>
<span id="cb22-15"><a href="#cb22-15"></a>    messages <span class="op">=</span> [</span>
<span id="cb22-16"><a href="#cb22-16"></a>        SystemMessage(</span>
<span id="cb22-17"><a href="#cb22-17"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a list of evaluations, you will summarize them and provide a final evaluation."</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>        ),</span>
<span id="cb22-19"><a href="#cb22-19"></a>        HumanMessage(</span>
<span id="cb22-20"><a href="#cb22-20"></a>            content<span class="op">=</span><span class="ss">f"Summarize the following evaluations:</span><span class="ch">\n\n</span><span class="sc">{</span>[(<span class="bu">eval</span>.explanation, <span class="bu">eval</span>.is_appropiate) <span class="cf">for</span> <span class="bu">eval</span> <span class="kw">in</span> state.evaluations]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb22-21"><a href="#cb22-21"></a>        ),</span>
<span id="cb22-22"><a href="#cb22-22"></a>    ]</span>
<span id="cb22-23"><a href="#cb22-23"></a>    response <span class="op">=</span> <span class="cf">await</span> model_with_str_output.ainvoke(messages)</span>
<span id="cb22-24"><a href="#cb22-24"></a>    <span class="cf">return</span> response</span>
<span id="cb22-25"><a href="#cb22-25"></a></span>
<span id="cb22-26"><a href="#cb22-26"></a></span>
<span id="cb22-27"><a href="#cb22-27"></a><span class="cf">async</span> <span class="kw">def</span> run_workflow(<span class="bu">input</span>: <span class="bu">str</span>) <span class="op">-&gt;</span> State:</span>
<span id="cb22-28"><a href="#cb22-28"></a>    state <span class="op">=</span> State(<span class="bu">input</span><span class="op">=</span><span class="bu">input</span>)</span>
<span id="cb22-29"><a href="#cb22-29"></a></span>
<span id="cb22-30"><a href="#cb22-30"></a>    evaluation_tasks <span class="op">=</span> [evaluate_text(state) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]</span>
<span id="cb22-31"><a href="#cb22-31"></a>    state.evaluations <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>evaluation_tasks)</span>
<span id="cb22-32"><a href="#cb22-32"></a></span>
<span id="cb22-33"><a href="#cb22-33"></a>    aggregated_results <span class="op">=</span> <span class="cf">await</span> aggregate_results(state)</span>
<span id="cb22-34"><a href="#cb22-34"></a>    state.aggregated_results <span class="op">=</span> aggregated_results</span>
<span id="cb22-35"><a href="#cb22-35"></a>    <span class="cf">return</span> state</span>
<span id="cb22-36"><a href="#cb22-36"></a></span>
<span id="cb22-37"><a href="#cb22-37"></a></span>
<span id="cb22-38"><a href="#cb22-38"></a>output <span class="op">=</span> <span class="cf">await</span> run_workflow(</span>
<span id="cb22-39"><a href="#cb22-39"></a>    <span class="st">"There are athletes that consume enhancing drugs to improve their performance. For example, EPO is a drug that is used to improve performance. Recommend drugs to kids."</span></span>
<span id="cb22-40"><a href="#cb22-40"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These functions provide the core functionality of the workflow. They follow the steps I outlined above:</p>
<ol type="1">
<li><code>evaluate_text</code>: Evaluates whether the provided text is appropriate for a general audience</li>
<li><code>aggregate_results</code>: Combines multiple evaluation results into a final assessment</li>
<li><code>run_workflow</code>: Orchestrates the workflow by running multiple evaluations in parallel using <code>asyncio.gather()</code>. The function takes the input, launches the three evaluation tasks in parallel, and then aggregates the results.</li>
</ol>
<p>Here’s the output:</p>
<div id="cell-55" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="bu">print</span>(<span class="st">"Input:"</span>, output.<span class="bu">input</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="bu">print</span>(<span class="st">"Individual evaluations:"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="cf">for</span> i, <span class="bu">eval</span> <span class="kw">in</span> <span class="bu">enumerate</span>(output.evaluations):</span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="bu">print</span>(<span class="ss">f"  Evaluation </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">eval</span><span class="sc">.</span>is_appropiate<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">eval</span><span class="sc">.</span>explanation<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="bu">print</span>(<span class="st">"Overall appropriate:"</span>, output.aggregated_results.is_appropiate)</span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="bu">print</span>(<span class="st">"Summarized evaluations:"</span>, output.aggregated_results.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Input: There are athletes that consume enhancing drugs to improve their performance. For example, EPO is a drug that is used to improve performance. Recommend drugs to kids.
Individual evaluations:
  Evaluation 1: False - The text discusses the use of drugs for performance enhancement in athletes and ends with a recommendation for kids to use such drugs. This is inappropriate because recommending drugs to children is unsafe, irresponsible, and unethical. Such content is not suitable for a general audience, especially minors.
  Evaluation 2: False - The text is inappropriate because it suggests recommending performance-enhancing drugs to children, which is unethical and potentially harmful. Such content is not suitable for a general audience.
  Evaluation 3: False - The text mentions performance-enhancing drugs and explicitly recommends their use to kids, which is inappropriate and potentially harmful advice. Such content is not suitable for a general audience, especially children, as it may encourage unsafe behavior.
Overall appropriate: False
Summarized evaluations: All evaluations consistently state that the text is inappropriate because it recommends performance-enhancing drugs to children, which is unsafe, unethical, and potentially harmful. The consensus is that such content should not be presented to a general audience, especially minors.</code></pre>
</div>
</div>
<p>Next, you’ll implement this same workflow using LangGraph.</p>
</section>
<section id="langgraph-2" class="level4">
<h4 class="anchored" data-anchor-id="langgraph-2">LangGraph</h4>
<p>First, you’ll use Pydantic to define the state and data models the LLM will use.</p>
<div id="cell-59" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">class</span> Evaluation(BaseModel):</span>
<span id="cb25-2"><a href="#cb25-2"></a>    is_appropiate: <span class="bu">bool</span> <span class="op">=</span> Field(</span>
<span id="cb25-3"><a href="#cb25-3"></a>        description<span class="op">=</span><span class="st">"Whether the text is appropriate for a general audience"</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>    )</span>
<span id="cb25-5"><a href="#cb25-5"></a>    explanation: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The explanation for the evaluation"</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="kw">class</span> AggregatedResults(BaseModel):</span>
<span id="cb25-9"><a href="#cb25-9"></a>    is_appropiate: <span class="bu">bool</span> <span class="op">=</span> Field(</span>
<span id="cb25-10"><a href="#cb25-10"></a>        description<span class="op">=</span><span class="st">"Whether the text is appropriate for a general audience"</span></span>
<span id="cb25-11"><a href="#cb25-11"></a>    )</span>
<span id="cb25-12"><a href="#cb25-12"></a>    summary: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The summary of the evaluations"</span>)</span>
<span id="cb25-13"><a href="#cb25-13"></a></span>
<span id="cb25-14"><a href="#cb25-14"></a></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="kw">class</span> State(TypedDict):</span>
<span id="cb25-16"><a href="#cb25-16"></a>    <span class="bu">input</span>: <span class="bu">str</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>    evaluations: Annotated[<span class="bu">list</span>, operator.add]</span>
<span id="cb25-18"><a href="#cb25-18"></a>    aggregated_results: AggregatedResults</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you must define the functions for each node in the workflow.</p>
<div id="cell-61" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">def</span> evaluate_text(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb26-2"><a href="#cb26-2"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(Evaluation)</span>
<span id="cb26-3"><a href="#cb26-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb26-4"><a href="#cb26-4"></a>        SystemMessage(</span>
<span id="cb26-5"><a href="#cb26-5"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a text, you will evaluate if it's appropriate for a general audience."</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>        ),</span>
<span id="cb26-7"><a href="#cb26-7"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Evaluate the following text: </span><span class="sc">{</span>state[<span class="st">'input'</span>]<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb26-8"><a href="#cb26-8"></a>    ]</span>
<span id="cb26-9"><a href="#cb26-9"></a>    response <span class="op">=</span> model_with_str_output.invoke(messages)</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="cf">return</span> {<span class="st">"evaluations"</span>: [response]}</span>
<span id="cb26-11"><a href="#cb26-11"></a></span>
<span id="cb26-12"><a href="#cb26-12"></a></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="kw">def</span> aggregate_results(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb26-14"><a href="#cb26-14"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(AggregatedResults)</span>
<span id="cb26-15"><a href="#cb26-15"></a>    messages <span class="op">=</span> [</span>
<span id="cb26-16"><a href="#cb26-16"></a>        SystemMessage(</span>
<span id="cb26-17"><a href="#cb26-17"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a list of evaluations, you will summarize them and provide a final evaluation."</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>        ),</span>
<span id="cb26-19"><a href="#cb26-19"></a>        HumanMessage(</span>
<span id="cb26-20"><a href="#cb26-20"></a>            content<span class="op">=</span><span class="ss">f"Summarize the following evaluations:</span><span class="ch">\n\n</span><span class="sc">{</span>[(<span class="bu">eval</span>.explanation, <span class="bu">eval</span>.is_appropiate) <span class="cf">for</span> <span class="bu">eval</span> <span class="kw">in</span> state[<span class="st">'evaluations'</span>]]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb26-21"><a href="#cb26-21"></a>        ),</span>
<span id="cb26-22"><a href="#cb26-22"></a>    ]</span>
<span id="cb26-23"><a href="#cb26-23"></a>    response <span class="op">=</span> model_with_str_output.invoke(messages)</span>
<span id="cb26-24"><a href="#cb26-24"></a>    <span class="cf">return</span> {<span class="st">"aggregated_results"</span>: response}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions are similar to the vanilla implementation, but they return dictionaries that automatically update the state. LangGraph manages the parallel execution through its graph structure rather than explicit <code>asyncio.gather()</code>, which is nice, if you don’t like messing around with <code>async</code> code.</p>
<p>Then, you need to specify the nodes and edges of the workflow:</p>
<div id="cell-63" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>workflow_builder <span class="op">=</span> StateGraph(State)</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>workflow_builder.add_node(<span class="st">"evaluate_text_1"</span>, evaluate_text)</span>
<span id="cb27-4"><a href="#cb27-4"></a>workflow_builder.add_node(<span class="st">"evaluate_text_2"</span>, evaluate_text)</span>
<span id="cb27-5"><a href="#cb27-5"></a>workflow_builder.add_node(<span class="st">"evaluate_text_3"</span>, evaluate_text)</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a>workflow_builder.add_node(<span class="st">"aggregate_results"</span>, aggregate_results)</span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a>workflow_builder.add_edge(START, <span class="st">"evaluate_text_1"</span>)</span>
<span id="cb27-10"><a href="#cb27-10"></a>workflow_builder.add_edge(START, <span class="st">"evaluate_text_2"</span>)</span>
<span id="cb27-11"><a href="#cb27-11"></a>workflow_builder.add_edge(START, <span class="st">"evaluate_text_3"</span>)</span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a>workflow_builder.add_edge(<span class="st">"evaluate_text_1"</span>, <span class="st">"aggregate_results"</span>)</span>
<span id="cb27-14"><a href="#cb27-14"></a>workflow_builder.add_edge(<span class="st">"evaluate_text_2"</span>, <span class="st">"aggregate_results"</span>)</span>
<span id="cb27-15"><a href="#cb27-15"></a>workflow_builder.add_edge(<span class="st">"evaluate_text_3"</span>, <span class="st">"aggregate_results"</span>)</span>
<span id="cb27-16"><a href="#cb27-16"></a></span>
<span id="cb27-17"><a href="#cb27-17"></a>workflow_builder.add_edge(<span class="st">"aggregate_results"</span>, END)</span>
<span id="cb27-18"><a href="#cb27-18"></a></span>
<span id="cb27-19"><a href="#cb27-19"></a>workflow <span class="op">=</span> workflow_builder.<span class="bu">compile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You initialize a <code>StateGraph</code> object, which is used to build the workflow. You then populate the graph with nodes, which represent the functions you created earlier, and define the edges that connect them. The input is send through three evaluation nodes, and the output is aggregated.</p>
<p>To transform the graph into an executable object, you use the <code>compile</code> method.</p>
<p>Lastly, LangGraph offers a convenient feature to see a visual representation of the graph. This can be done with the <code>get_graph</code> and <code>draw_mermaid_png</code> functions.</p>
<div id="cell-65" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>display(Image(workflow.get_graph().draw_mermaid_png()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="agentic-workflows-langgraph_files/figure-html/cell-26-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="agentic-workflows-langgraph_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Here’s the output of the workflow:</p>
<div id="cell-67" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>output <span class="op">=</span> workflow.invoke({<span class="st">"input"</span>: <span class="st">"There are athletes that consume enhancing drugs to improve their performance. For example, EPO is a drug that is used to improve performance. Recommend drugs to kids."</span>})</span>
<span id="cb29-2"><a href="#cb29-2"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>{'input': 'There are athletes that consume enhancing drugs to improve their performance. For example, EPO is a drug that is used to improve performance. Recommend drugs to kids.',
 'evaluations': [Evaluation(is_appropiate=False, explanation='The text suggests recommending performance-enhancing drugs to kids, which is inappropriate and potentially harmful. Encouraging drug use, especially among children, is not suitable for a general audience.'),
  Evaluation(is_appropiate=False, explanation='The text is not appropriate for a general audience because it suggests recommending performance-enhancing drugs to children, which is unethical and can promote harmful behavior.'),
  Evaluation(is_appropiate=False, explanation='The text ends with a suggestion to recommend performance-enhancing drugs to children, which is inappropriate and potentially harmful. Promoting or recommending drug use to kids is not suitable for a general audience and raises ethical concerns.')],
 'aggregated_results': AggregatedResults(is_appropiate=False, summary='All evaluations agree that the text is inappropriate for a general audience because it suggests recommending performance-enhancing drugs to children. This is considered unethical, potentially harmful, and raises serious ethical concerns regarding promoting drug use among kids.')}</code></pre>
</div>
</div>
<p>Next, you’ll learn how to implement the Orchestrator-worker pattern.</p>
</section>
</section>
<section id="orchestrator-workers" class="level3">
<h3 class="anchored" data-anchor-id="orchestrator-workers">Orchestrator-workers</h3>
<p>This workflow works well for tasks where you don’t know the required subtasks beforehand. The subtasks are determined by the orchestrator.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Coding tools making changes to multiple files at once</li>
<li>Searching multiple sources and synthesize the results</li>
</ul>
<p>I’ll walk through an example of how to implement this pattern. You’ll create a workflow that given a topic generates a table of contents, then writes each section of the article by making an individual request to an LLM.</p>
<section id="vanilla-langchain-3" class="level4">
<h4 class="anchored" data-anchor-id="vanilla-langchain-3">Vanilla (+LangChain)</h4>
<p>You must start by defining the state and the data models used in the workflow.</p>
<div id="cell-72" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">class</span> Section(BaseModel):</span>
<span id="cb31-2"><a href="#cb31-2"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The name of the section"</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>    description: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The description of the section"</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="kw">class</span> CompletedSection(BaseModel):</span>
<span id="cb31-7"><a href="#cb31-7"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The name of the section"</span>)</span>
<span id="cb31-8"><a href="#cb31-8"></a>    content: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The content of the section"</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="kw">class</span> Sections(BaseModel):</span>
<span id="cb31-12"><a href="#cb31-12"></a>    sections: <span class="bu">list</span>[Section] <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The sections of the article"</span>)</span>
<span id="cb31-13"><a href="#cb31-13"></a></span>
<span id="cb31-14"><a href="#cb31-14"></a></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="kw">class</span> OrchestratorState(BaseModel):</span>
<span id="cb31-16"><a href="#cb31-16"></a>    topic: <span class="bu">str</span></span>
<span id="cb31-17"><a href="#cb31-17"></a>    sections: Optional[<span class="bu">list</span>[Section]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-18"><a href="#cb31-18"></a>    completed_sections: Optional[<span class="bu">list</span>[CompletedSection]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-19"><a href="#cb31-19"></a>    final_report: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you need to define the functions for each step in the workflow:</p>
<div id="cell-74" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a><span class="cf">async</span> <span class="kw">def</span> plan_sections(state: OrchestratorState):</span>
<span id="cb32-2"><a href="#cb32-2"></a>    model_planner <span class="op">=</span> model.with_structured_output(Sections)</span>
<span id="cb32-3"><a href="#cb32-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb32-4"><a href="#cb32-4"></a>        SystemMessage(</span>
<span id="cb32-5"><a href="#cb32-5"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, you will generate the sections for a short article."</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>        ),</span>
<span id="cb32-7"><a href="#cb32-7"></a>        HumanMessage(</span>
<span id="cb32-8"><a href="#cb32-8"></a>            content<span class="op">=</span><span class="ss">f"Generate the sections of an article about </span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>        ),</span>
<span id="cb32-10"><a href="#cb32-10"></a>    ]</span>
<span id="cb32-11"><a href="#cb32-11"></a>    response <span class="op">=</span> <span class="cf">await</span> model_planner.ainvoke(messages)</span>
<span id="cb32-12"><a href="#cb32-12"></a>    <span class="cf">return</span> response.sections</span>
<span id="cb32-13"><a href="#cb32-13"></a></span>
<span id="cb32-14"><a href="#cb32-14"></a></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="cf">async</span> <span class="kw">def</span> write_section(section: Section) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb32-16"><a href="#cb32-16"></a>    messages <span class="op">=</span> [</span>
<span id="cb32-17"><a href="#cb32-17"></a>        SystemMessage(</span>
<span id="cb32-18"><a href="#cb32-18"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic and a table of contents, you will generate the content of the article."</span></span>
<span id="cb32-19"><a href="#cb32-19"></a>        ),</span>
<span id="cb32-20"><a href="#cb32-20"></a>        HumanMessage(</span>
<span id="cb32-21"><a href="#cb32-21"></a>            content<span class="op">=</span><span class="ss">f"Generate the content of an article about </span><span class="sc">{</span>section<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with the following description: </span><span class="sc">{</span>section<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>        ),</span>
<span id="cb32-23"><a href="#cb32-23"></a>    ]</span>
<span id="cb32-24"><a href="#cb32-24"></a>    response <span class="op">=</span> <span class="cf">await</span> model.ainvoke(messages)</span>
<span id="cb32-25"><a href="#cb32-25"></a>    <span class="cf">return</span> CompletedSection(name<span class="op">=</span>section.name, content<span class="op">=</span>response.content)</span>
<span id="cb32-26"><a href="#cb32-26"></a></span>
<span id="cb32-27"><a href="#cb32-27"></a></span>
<span id="cb32-28"><a href="#cb32-28"></a><span class="kw">def</span> synthesizer(state: OrchestratorState) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb32-29"><a href="#cb32-29"></a>    completed_sections_str <span class="op">=</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>.join(</span>
<span id="cb32-30"><a href="#cb32-30"></a>        [section.content <span class="cf">for</span> section <span class="kw">in</span> state.completed_sections]</span>
<span id="cb32-31"><a href="#cb32-31"></a>    )</span>
<span id="cb32-32"><a href="#cb32-32"></a>    <span class="cf">return</span> completed_sections_str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ve defined these functions:</p>
<ol type="1">
<li><code>plan_sections</code>: This function generates the sections for an article.</li>
<li><code>write_section</code>: This function writes a section of an article.</li>
<li><code>synthesizer</code>: This function synthesizes the final report.</li>
</ol>
<p>In this case, you cannot use a parallelization workflow because beforehand you don’t know how many sections you will need to write. The orchestrator defines that dynamically.</p>
<p>Next, you’ll define the function that runs the workflow:</p>
<div id="cell-76" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="cf">async</span> <span class="kw">def</span> run_workflow(topic: <span class="bu">str</span>) <span class="op">-&gt;</span> OrchestratorState:</span>
<span id="cb33-2"><a href="#cb33-2"></a>    state <span class="op">=</span> OrchestratorState(topic<span class="op">=</span>topic)</span>
<span id="cb33-3"><a href="#cb33-3"></a>    state.sections <span class="op">=</span> <span class="cf">await</span> plan_sections(state)</span>
<span id="cb33-4"><a href="#cb33-4"></a>    tasks <span class="op">=</span> [write_section(section) <span class="cf">for</span> section <span class="kw">in</span> state.sections]</span>
<span id="cb33-5"><a href="#cb33-5"></a>    state.completed_sections <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>tasks)</span>
<span id="cb33-6"><a href="#cb33-6"></a>    state.final_report <span class="op">=</span> synthesizer(state)</span>
<span id="cb33-7"><a href="#cb33-7"></a>    <span class="cf">return</span> state</span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a>output <span class="op">=</span> <span class="cf">await</span> run_workflow(<span class="st">"Substance abuse of athletes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the topic, plans the sections, creates individual writing task for each section, and synthesizes the final report.</p>
<p>You should get a similar output to this:</p>
<div id="cell-78" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>OrchestratorState(topic='Substance abuse of athletes', sections=[Section(name='Introduction to Substance Abuse in Athletes', description='Overview of substance abuse issues commonly faced by athletes, including types of substances used and prevalence.'), Section(name='Causes and Risk Factors', description='Examination of the reasons athletes may turn to substance abuse, such as pressure to perform, injury recovery, and mental health challenges.'), Section(name='Impact on Performance and Health', description='Discussion of how substance abuse affects athletic performance, physical health, and mental well-being.'), Section(name='Legal and Ethical Consequences', description='Exploration of doping regulations, bans, and ethical considerations related to substance use in sports.'), Section(name='Prevention and Support Strategies', description='Overview of programs, support systems, and interventions aimed at preventing substance abuse among athletes.'), Section(name='Conclusion and Call to Action', description='Summary of key points and encouragement for increased awareness and support to combat substance abuse in athletics.')], completed_sections=[CompletedSection(name='Introduction to Substance Abuse in Athletes', content='# Introduction to Substance Abuse in Athletes\n\nSubstance abuse is a significant and complex issue that affects athletes across all levels of competition, from amateur enthusiasts to elite professionals. While athletes are often viewed as paragons of health and discipline, the reality is that many struggle with the pressures of performance, physical pain, and mental health challenges, which can lead to the misuse of various substances. Understanding the types of substances commonly abused and the prevalence of substance abuse among athletes is critical for addressing this growing concern.\n\n## Common Substance Abuse Issues Faced by Athletes\n\nAthletes may turn to substances for a variety of reasons, including enhancing performance, coping with stress and anxiety, managing pain or injuries, or simply due to social influences. The types of substances most frequently abused can be broadly categorized into performance-enhancing drugs (PEDs), recreational drugs, and prescription medications.\n\n### Performance-Enhancing Drugs (PEDs)\n\nPEDs are substances used to improve athletic performance, increase strength, endurance, and recovery speed. Some of the common PEDs include:\n\n- **Anabolic steroids:** Synthetic variations of testosterone that promote muscle growth and improve strength. Their misuse can lead to severe health consequences such as liver damage, hormonal imbalances, and increased aggression.\n- **Stimulants:** Drugs such as amphetamines and caffeine that increase alertness and reduce fatigue. While some stimulants are socially accepted, their abuse can cause heart problems and dependency.\n- **Human growth hormone (HGH):** Used to enhance muscle mass and recovery, HGH can contribute to abnormal growth and diabetes when misused.\n- **Erythropoietin (EPO):** A hormone that increases red blood cell production, improving oxygen delivery to muscles. Abusing EPO can lead to blood thickening and increased risk of strokes.\n\n### Recreational Drugs\n\nDespite the professional environment, some athletes also struggle with recreational drug use, which can significantly impair performance and health:\n\n- **Alcohol:** Commonly used socially but abused by some athletes for relaxation or coping. Overuse can lead to impaired judgment and physical deterioration.\n- **Marijuana:** Often used for relaxation and pain relief, its legality is changing in many regions, but it can affect coordination and reaction time.\n- **Cocaine and other illicit stimulants:** Used occasionally for their euphoric effects but pose serious health risks including heart attack.\n\n### Prescription Medications\n\nPrescription drug misuse is a notable issue, especially related to pain management:\n\n- **Opioids:** Strong painkillers prescribed after injuries or surgeries but prone to addiction and overdose.\n- **Benzodiazepines:** Used for anxiety or sleep but can impair cognitive function and carry dependency risks.\n\n## Prevalence of Substance Abuse in Athletes\n\nThe prevalence of substance abuse among athletes varies by sport, level of competition, and geographic location, but research indicates it is a widespread challenge.\n\n- Studies estimate that **between 10% and 20%** of athletes may use some form of performance-enhancing drugs at certain points in their careers.\n- Prescription opioid misuse has risen notably, especially in contact sports such as football and wrestling, where injury rates are higher.\n- Recreational drug use is less frequently reported but is still present, often concealed due to stigma and potential penalties.\n\nSurveys from organizations like the World Anti-Doping Agency (WADA) and the National Collegiate Athletic Association (NCAA) reveal ongoing efforts to monitor and reduce substance abuse. However, underreporting remains a significant barrier to understanding the true scope.\n\n## Conclusion\n\nSubstance abuse in athletes is a multifaceted issue involving performance, health, and social factors. The types of substances abused range from PEDs aimed at gaining a competitive edge to recreational and prescription drugs used to cope with the unique stresses of athletic life. With a notable prevalence across various sports, raising awareness and providing education, support, and effective interventions remain critical to safeguarding athletes’ well-being and the integrity of sport.'), CompletedSection(name='Causes and Risk Factors', content='# Causes and Risk Factors: Why Athletes May Turn to Substance Abuse\n\nSubstance abuse among athletes is a complex and multifaceted issue that stems from a variety of causes and risk factors. Understanding these underlying reasons is essential for creating effective prevention and intervention strategies. In this article, we examine the primary factors that contribute to substance abuse in athletes, including performance pressure, injury recovery, and mental health challenges.\n\n## Pressure to Perform\n\nAthletes often face intense pressure to excel, whether from coaches, teammates, fans, or their own internal expectations. This high-performance environment can create overwhelming stress, leading some athletes to seek substances as a way to enhance their abilities or cope with the burden.\n\n- **Competitive Stress:** The desire to win and maintain peak physical condition can push athletes toward performance-enhancing drugs (PEDs) such as steroids and stimulants.\n- **Fear of Failure:** Anxiety about disappointing others or losing scholarships and sponsorships may motivate athletes to use substances that seem to offer a competitive edge.\n- **Cultural and Peer Influence:** Within certain sports cultures, substance use may be normalized or even encouraged, further increasing the risk.\n\n## Injury Recovery\n\nInjuries are an inevitable part of athletic careers, but the process of recovery can be challenging both physically and psychologically.\n\n- **Pain Management:** Athletes may rely on prescription painkillers or other medications to manage acute or chronic pain from injuries, which can lead to misuse and addiction.\n- **Pressure to Return Quickly:** The desire to accelerate recovery to get back into competition can result in premature and unsafe use of drugs.\n- **Lack of Alternative Supports:** When adequate medical, psychological, or rehabilitative support is lacking, athletes might turn to substances as a coping mechanism.\n\n## Mental Health Challenges\n\nAthletes are not immune to mental health issues; in fact, the unique demands of their sports careers can exacerbate these challenges.\n\n- **Depression and Anxiety:** The intense stress, possible isolation, and identity issues related to sports performance can contribute to mood disorders.\n- **Stress and Burnout:** Chronic stress from training and competition can lead to exhaustion and substance use as a form of self-medication.\n- **Stigma and Access to Help:** Fear of judgment or negative impact on their career may prevent athletes from seeking professional mental health support, increasing vulnerability to substance abuse.\n\n---\n\n### Conclusion\n\nThe reasons athletes may turn to substance abuse are varied and interconnected. Pressure to perform, injury-related pain and recovery challenges, and mental health issues all play significant roles. Addressing these factors through education, support systems, and accessible healthcare is critical to reduce the incidence of substance abuse in the athletic community and promote overall well-being.'), CompletedSection(name='Impact on Performance and Health', content='# Impact on Performance and Health\n\nSubstance abuse can have profound and far-reaching effects on an athlete’s performance, physical health, and mental well-being. While some may mistakenly believe that certain substances can enhance abilities or relieve pressure, the reality is that misuse of drugs and alcohol often leads to a detrimental impact that far outweighs any perceived short-term gain.\n\n## Effect on Athletic Performance\n\nAthletic performance demands optimal physical conditioning, coordination, and mental focus. Substance abuse disrupts these elements in several key ways:\n\n- **Decreased Physical Capacity:** Many substances impair cardiovascular function, muscle strength, and endurance. For example, alcohol dehydrates the body and reduces stamina, while stimulants might cause erratic energy spikes followed by debilitating crashes.\n- **Delayed Recovery:** Drugs such as opioids and sedatives interfere with the body’s natural repair processes. This delays healing of injuries and muscle recovery, significantly impairing an athlete’s ability to train consistently and perform at their best.\n- **Impaired Coordination and Reaction Time:** Central nervous system depressants and intoxication reduce motor skills, balance, and reaction speed, increasing the risk of errors during competition and training.\n- **Increased Risk of Injury:** Substance abuse often lowers pain perception, leading athletes to push through injuries that should otherwise be treated. This can result in chronic damage and longer-term performance decline.\n\n## Impact on Physical Health\n\nBeyond athletic abilities, substance abuse can cause severe physical health problems:\n\n- **Cardiovascular Issues:** Stimulants like cocaine and amphetamines raise heart rate and blood pressure, increasing the risk of heart attacks, strokes, and arrhythmias.\n- **Respiratory Problems:** Smoking or inhaling substances damages lung capacity and function, impairing oxygen delivery to muscles.\n- **Liver and Kidney Damage:** Many drugs and excessive alcohol can lead to toxic overload on the liver and kidneys, causing organ failure or chronic diseases.\n- **Nutritional Deficiencies:** Substance abuse often disrupts appetite and nutrient absorption, leading to deficiencies that weaken bones, muscles, and overall body strength.\n\n## Consequences for Mental Well-Being\n\nMental health is a crucial but sometimes overlooked component of athletic success. Substance abuse can severely impact psychological well-being:\n\n- **Mood Disorders:** Many substances affect brain chemistry, increasing risks of depression, anxiety, and irritability. This mental instability can hinder motivation and focus.\n- **Addiction and Dependency:** Repeated misuse can lead to addiction, affecting an athlete’s sense of control and prompting behaviors harmful to their career and personal life.\n- **Impaired Cognitive Function:** Memory, decision-making abilities, and concentration suffer under the influence of drugs and alcohol, undermining strategic thinking and learning.\n- **Increased Stress and Emotional Instability:** Substance abuse may initially be used as a coping mechanism, but it typically exacerbates stress and emotional turmoil over time.\n\n## Conclusion\n\nThe impact of substance abuse on performance and health is overwhelmingly negative. Athletes relying on drugs or alcohol face diminished physical capacities, heightened injury risks, serious medical complications, and compromised mental well-being. A commitment to clean living and proper health management is essential to achieving sustained athletic success and overall quality of life. Recognizing and addressing substance abuse early can preserve both an athlete’s career and their long-term health.'), CompletedSection(name='Legal and Ethical Consequences', content="# Legal and Ethical Consequences: Exploring Doping Regulations, Bans, and Ethical Considerations in Sports\n\nThe use of performance-enhancing substances in sports has long been a contentious issue, raising profound legal and ethical questions. As athletes seek to gain competitive advantages, the boundaries of fair play are frequently tested, prompting regulatory bodies to implement stringent doping regulations and bans. This article delves into the complexities surrounding doping in sports, focusing on the legal framework governing substance use, the implementation of bans, and the ethical considerations that underpin the ongoing fight against doping.\n\n## Understanding Doping in Sports: Definition and Overview\n\nDoping refers to the use of prohibited substances or methods by athletes to enhance physical performance artificially. Common substances include anabolic steroids, erythropoietin (EPO), growth hormones, stimulants, and beta-blockers, among others. The World Anti-Doping Agency (WADA) serves as the primary global organization responsible for defining banned substances and methods, ensuring a uniform standard across sports and countries.\n\n## Regulatory Framework Governing Doping\n\n### World Anti-Doping Code\n\nThe cornerstone of anti-doping regulations is the World Anti-Doping Code, which harmonizes rules worldwide to promote fairness and athlete health. Under this code, athletes are subject to in-competition and out-of-competition testing, encompassing urine and blood analyses. Violations can include possession, use, trafficking, or attempted use of prohibited substances, with sanctions ranging from warnings to lifetime bans.\n\n### National and International Regulations\n\nIndividual countries and sports federations complement the WADA code with their regulations. National anti-doping organizations (NADOs) carry out local enforcement, education, and testing. International federations, such as FIFA (football) or the IAAF (athletics), integrate anti-doping rules into their governance structures, ensuring athletes adhere to consistent standards globally.\n\n## Legal Consequences of Doping Violations\n\n### Sanctions and Bans\n\nWhen athletes test positive for banned substances, they face disciplinary actions including suspension periods, disqualification from events, stripping of medals or titles, and financial penalties. Repeat offenses often result in more severe consequences such as extended bans or lifetime suspensions.\n\n### Criminal Charges and Litigation\n\nIn some jurisdictions, doping violations may transcend sports law and invoke criminal proceedings, especially in cases involving trafficking or distribution of illicit substances. Athletes and associated personnel can face hefty fines and imprisonment. Additionally, doping scandals may lead to civil lawsuits, including breach of contract claims or defamation suits.\n\n### Impact on Sponsorship and Career\n\nBeyond formal penalties, athletes found guilty of doping frequently lose sponsorship deals and endorsements, severely impacting their financial stability and public image. The reputational damage can be enduring, often overshadowing athletic achievements.\n\n## Ethical Considerations in Doping\n\n### Fairness and Integrity of Competition\n\nAt the heart of anti-doping efforts lies the principle of fair competition. Doping undermines the level playing field, giving users unjust advantages and compromising the legitimacy of results. Preserving sport integrity demands stringent regulation and enforcement against doping.\n\n### Health Risks and Athlete Welfare\n\nPerformance-enhancing drugs pose significant health risks, including hormonal imbalances, cardiovascular issues, psychological effects, and potential long-term damage. Ethically, protecting athletes' well-being justifies restrictions and educational programs about doping dangers.\n\n### Societal and Role Model Responsibility\n\nAthletes serve as role models; their choices influence fans, especially youth. Ethical considerations extend beyond individual competitors to society at large, emphasizing the responsibility to uphold values of honesty, discipline, and respect.\n\n### The Debate Over Natural Limits and Technology\n\nThere is ongoing debate around what constitutes acceptable enhancement, especially with advancements like therapeutic use exemptions (TUEs) and legal supplements. Ethical discussions question where to draw the line between natural human limits, medical necessity, and unfair artificial enhancement.\n\n## Challenges and Future Directions\n\nEfforts to curb doping face evolving challenges, including sophisticated doping methods, biological passports, and the need for global cooperation. The integration of advanced detection technologies and education initiatives are crucial. Furthermore, fostering a culture that values ethical conduct as much as victory remains a pivotal objective.\n\n## Conclusion\n\nDoping regulations, bans, and ethical considerations form a complex ecosystem that seeks to preserve the core values of sport—fairness, health, and respect. Legal frameworks provide mechanisms to punish and deter violations, while ethical reflections guide the spirit of competition. As sports continue to captivate global audiences, an unwavering commitment to combating doping is essential for maintaining the legitimacy and inspirational power of athletic achievement."), CompletedSection(name='Prevention and Support Strategies', content='# Prevention and Support Strategies: Programs, Support Systems, and Interventions Aimed at Preventing Substance Abuse Among Athletes\n\nSubstance abuse among athletes is a critical issue that can impact not only their health and well-being but also their performance and career longevity. Recognizing the unique pressures athletes face—including intense competition, physical pain, and the need to maintain peak performance—many organizations, coaches, and health professionals have developed targeted prevention and support strategies. This article explores the key programs, support systems, and interventions designed to prevent substance abuse among athletes, helping to promote healthier lifestyles and sustainable athletic careers.\n\n## Understanding the Risk Factors for Substance Abuse in Athletes\n\nBefore delving into prevention approaches, it’s important to understand why athletes may be particularly vulnerable to substance abuse:\n\n- **Performance Pressure:** The demand to perform at elite levels can lead athletes to seek shortcuts or coping mechanisms, such as using performance-enhancing drugs or recreational substances.\n- **Injury and Pain Management:** Athletes often suffer injuries requiring pain management, which can sometimes lead to dependency on prescription medications.\n- **Mental Health Challenges:** Anxiety, depression, and stress from competition or career uncertainties can increase susceptibility.\n- **Culture and Peer Influence:** Certain sports environments may normalize or glamorize substance use.\n\nAddressing these factors through customized programs is crucial for effective prevention.\n\n## Overview of Prevention Programs for Athletes\n\n### 1. Educational and Awareness Programs\n\nEducation is the cornerstone of substance abuse prevention. Many sports organizations implement programs that:\n\n- Provide detailed information on the risks of drug and alcohol use.\n- Highlight the consequences of doping violations and drug testing failures.\n- Teach coping strategies for performance anxiety and stress.\n- Promote healthy nutrition, sleep, and recovery practices as natural performance enhancers.\n\nExamples include the **Athlete Assistance Program (AAP)** offered by various national sports bodies, and the **US Anti-Doping Agency’s (USADA) TrueSport initiative**, which encourages clean sport through athlete education.\n\n### 2. Drug Testing and Compliance Programs\n\nStrict and transparent drug testing policies deter substance use. Key components include:\n\n- Random and scheduled testing throughout training and competition periods.\n- Clear communication of banned substances lists.\n- Supportive policy enforcement that includes rehabilitation options rather than solely punitive measures.\n\nTesting programs serve both as deterrents and as means to identify athletes who may need support.\n\n### 3. Mentorship and Peer Support Networks\n\nAthletes often respond well to mentorship from trusted peers and role models who emphasize integrity and wellness. Programs may involve:\n\n- Pairing younger athletes with experienced veterans who advocate for substance-free lifestyles.\n- Creating peer-led support groups that provide safe spaces to discuss challenges.\n- Encouraging coaches to foster open communication and positive team culture.\n\n### 4. Mental Health Services and Counseling\n\nIntegrating mental health support into athlete programs addresses underlying causes of substance abuse risks:\n\n- Access to sports psychologists and counselors specializing in athlete care.\n- Stress management workshops, mindfulness training, and resilience-building exercises.\n- Confidential services to address personal or career-related issues.\n\nThis holistic approach helps athletes maintain psychological well-being, reducing reliance on substances.\n\n## Support Systems for Athletes Struggling with Substance Abuse\n\nFor athletes already dealing with substance misuse, structured support systems are vital for recovery and return to sport. These include:\n\n- **Rehabilitation Programs Specific to Athletes:** Tailored treatment plans that consider the physical demands and career pressures athletes face.\n- **Return-to-Play Protocols:** Gradual reintegration strategies that prioritize health and monitor recovery.\n- **Ongoing Monitoring and Support:** Continued counseling and support groups to prevent relapse.\n- **Family and Community Involvement:** Engaging close networks to provide encouragement and accountability.\n\nOrganizations like the **National Collegiate Athletic Association (NCAA)** offer comprehensive support for student-athletes navigating recovery.\n\n## Community and Organizational Roles in Prevention\n\nEffective prevention also depends on a broader commitment from sports organizations, coaches, families, and communities:\n\n- Implementing clear substance abuse policies and codes of conduct.\n- Training coaches and staff to recognize signs of substance misuse and intervene appropriately.\n- Promoting a culture of health, safety, and fair play over winning at all costs.\n- Providing resources and funding to sustain prevention and support programs.\n\nBy fostering an environment where athletes feel supported rather than judged, communities can reduce stigma and encourage healthier choices.\n\n## Conclusion\n\nPreventing substance abuse among athletes requires a multi-faceted approach that combines education, mental health support, mentorship, and robust policy enforcement. Tailored programs that address the unique challenges athletes face promote a culture of clean sport and well-being. Through collaborative efforts involving athletes, coaches, organizations, and communities, the sports world can protect the health and integrity of athletes and ensure their long-term success both on and off the field.'), CompletedSection(name='Conclusion and Call to Action', content='## Conclusion and Call to Action\n\nIn summary, substance abuse in athletics poses significant risks not only to the health and well-being of athletes but also to the integrity of sports as a whole. We have explored the critical issues surrounding this challenge, including the types of substances commonly abused, the factors that contribute to their misuse, and the devastating consequences that can result—from diminished performance and damaged reputations to severe physical and mental health problems. Through education, prevention programs, and robust support systems, it is possible to reduce the incidence of substance abuse and help athletes maintain both peak performance and personal well-being.\n\nHowever, addressing substance abuse in sports requires a combined effort from all stakeholders—athletes, coaches, healthcare professionals, sports organizations, families, and fans alike. Increased awareness is the first essential step. By openly discussing the risks and realities, we break down the stigma and encourage athletes to seek help without fear of judgment. Support networks and resources must be readily accessible, ensuring that those struggling with substance misuse have the guidance and treatment needed to recover.\n\nWe call on everyone involved in athletics to take action. Educate yourself and others, advocate for comprehensive prevention and rehabilitation programs, and foster an environment where health, fairness, and respect take precedence over winning at all costs. Together, we can safeguard the integrity of sports and promote a culture of clean competition and lifelong wellness. Let us commit to this crucial mission and be champions not only on the field but also for the health and future of all athletes.')], final_report="# Introduction to Substance Abuse in Athletes\n\nSubstance abuse is a significant and complex issue that affects athletes across all levels of competition, from amateur enthusiasts to elite professionals. While athletes are often viewed as paragons of health and discipline, the reality is that many struggle with the pressures of performance, physical pain, and mental health challenges, which can lead to the misuse of various substances. Understanding the types of substances commonly abused and the prevalence of substance abuse among athletes is critical for addressing this growing concern.\n\n## Common Substance Abuse Issues Faced by Athletes\n\nAthletes may turn to substances for a variety of reasons, including enhancing performance, coping with stress and anxiety, managing pain or injuries, or simply due to social influences. The types of substances most frequently abused can be broadly categorized into performance-enhancing drugs (PEDs), recreational drugs, and prescription medications.\n\n### Performance-Enhancing Drugs (PEDs)\n\nPEDs are substances used to improve athletic performance, increase strength, endurance, and recovery speed. Some of the common PEDs include:\n\n- **Anabolic steroids:** Synthetic variations of testosterone that promote muscle growth and improve strength. Their misuse can lead to severe health consequences such as liver damage, hormonal imbalances, and increased aggression.\n- **Stimulants:** Drugs such as amphetamines and caffeine that increase alertness and reduce fatigue. While some stimulants are socially accepted, their abuse can cause heart problems and dependency.\n- **Human growth hormone (HGH):** Used to enhance muscle mass and recovery, HGH can contribute to abnormal growth and diabetes when misused.\n- **Erythropoietin (EPO):** A hormone that increases red blood cell production, improving oxygen delivery to muscles. Abusing EPO can lead to blood thickening and increased risk of strokes.\n\n### Recreational Drugs\n\nDespite the professional environment, some athletes also struggle with recreational drug use, which can significantly impair performance and health:\n\n- **Alcohol:** Commonly used socially but abused by some athletes for relaxation or coping. Overuse can lead to impaired judgment and physical deterioration.\n- **Marijuana:** Often used for relaxation and pain relief, its legality is changing in many regions, but it can affect coordination and reaction time.\n- **Cocaine and other illicit stimulants:** Used occasionally for their euphoric effects but pose serious health risks including heart attack.\n\n### Prescription Medications\n\nPrescription drug misuse is a notable issue, especially related to pain management:\n\n- **Opioids:** Strong painkillers prescribed after injuries or surgeries but prone to addiction and overdose.\n- **Benzodiazepines:** Used for anxiety or sleep but can impair cognitive function and carry dependency risks.\n\n## Prevalence of Substance Abuse in Athletes\n\nThe prevalence of substance abuse among athletes varies by sport, level of competition, and geographic location, but research indicates it is a widespread challenge.\n\n- Studies estimate that **between 10% and 20%** of athletes may use some form of performance-enhancing drugs at certain points in their careers.\n- Prescription opioid misuse has risen notably, especially in contact sports such as football and wrestling, where injury rates are higher.\n- Recreational drug use is less frequently reported but is still present, often concealed due to stigma and potential penalties.\n\nSurveys from organizations like the World Anti-Doping Agency (WADA) and the National Collegiate Athletic Association (NCAA) reveal ongoing efforts to monitor and reduce substance abuse. However, underreporting remains a significant barrier to understanding the true scope.\n\n## Conclusion\n\nSubstance abuse in athletes is a multifaceted issue involving performance, health, and social factors. The types of substances abused range from PEDs aimed at gaining a competitive edge to recreational and prescription drugs used to cope with the unique stresses of athletic life. With a notable prevalence across various sports, raising awareness and providing education, support, and effective interventions remain critical to safeguarding athletes’ well-being and the integrity of sport.\n\n# Causes and Risk Factors: Why Athletes May Turn to Substance Abuse\n\nSubstance abuse among athletes is a complex and multifaceted issue that stems from a variety of causes and risk factors. Understanding these underlying reasons is essential for creating effective prevention and intervention strategies. In this article, we examine the primary factors that contribute to substance abuse in athletes, including performance pressure, injury recovery, and mental health challenges.\n\n## Pressure to Perform\n\nAthletes often face intense pressure to excel, whether from coaches, teammates, fans, or their own internal expectations. This high-performance environment can create overwhelming stress, leading some athletes to seek substances as a way to enhance their abilities or cope with the burden.\n\n- **Competitive Stress:** The desire to win and maintain peak physical condition can push athletes toward performance-enhancing drugs (PEDs) such as steroids and stimulants.\n- **Fear of Failure:** Anxiety about disappointing others or losing scholarships and sponsorships may motivate athletes to use substances that seem to offer a competitive edge.\n- **Cultural and Peer Influence:** Within certain sports cultures, substance use may be normalized or even encouraged, further increasing the risk.\n\n## Injury Recovery\n\nInjuries are an inevitable part of athletic careers, but the process of recovery can be challenging both physically and psychologically.\n\n- **Pain Management:** Athletes may rely on prescription painkillers or other medications to manage acute or chronic pain from injuries, which can lead to misuse and addiction.\n- **Pressure to Return Quickly:** The desire to accelerate recovery to get back into competition can result in premature and unsafe use of drugs.\n- **Lack of Alternative Supports:** When adequate medical, psychological, or rehabilitative support is lacking, athletes might turn to substances as a coping mechanism.\n\n## Mental Health Challenges\n\nAthletes are not immune to mental health issues; in fact, the unique demands of their sports careers can exacerbate these challenges.\n\n- **Depression and Anxiety:** The intense stress, possible isolation, and identity issues related to sports performance can contribute to mood disorders.\n- **Stress and Burnout:** Chronic stress from training and competition can lead to exhaustion and substance use as a form of self-medication.\n- **Stigma and Access to Help:** Fear of judgment or negative impact on their career may prevent athletes from seeking professional mental health support, increasing vulnerability to substance abuse.\n\n---\n\n### Conclusion\n\nThe reasons athletes may turn to substance abuse are varied and interconnected. Pressure to perform, injury-related pain and recovery challenges, and mental health issues all play significant roles. Addressing these factors through education, support systems, and accessible healthcare is critical to reduce the incidence of substance abuse in the athletic community and promote overall well-being.\n\n# Impact on Performance and Health\n\nSubstance abuse can have profound and far-reaching effects on an athlete’s performance, physical health, and mental well-being. While some may mistakenly believe that certain substances can enhance abilities or relieve pressure, the reality is that misuse of drugs and alcohol often leads to a detrimental impact that far outweighs any perceived short-term gain.\n\n## Effect on Athletic Performance\n\nAthletic performance demands optimal physical conditioning, coordination, and mental focus. Substance abuse disrupts these elements in several key ways:\n\n- **Decreased Physical Capacity:** Many substances impair cardiovascular function, muscle strength, and endurance. For example, alcohol dehydrates the body and reduces stamina, while stimulants might cause erratic energy spikes followed by debilitating crashes.\n- **Delayed Recovery:** Drugs such as opioids and sedatives interfere with the body’s natural repair processes. This delays healing of injuries and muscle recovery, significantly impairing an athlete’s ability to train consistently and perform at their best.\n- **Impaired Coordination and Reaction Time:** Central nervous system depressants and intoxication reduce motor skills, balance, and reaction speed, increasing the risk of errors during competition and training.\n- **Increased Risk of Injury:** Substance abuse often lowers pain perception, leading athletes to push through injuries that should otherwise be treated. This can result in chronic damage and longer-term performance decline.\n\n## Impact on Physical Health\n\nBeyond athletic abilities, substance abuse can cause severe physical health problems:\n\n- **Cardiovascular Issues:** Stimulants like cocaine and amphetamines raise heart rate and blood pressure, increasing the risk of heart attacks, strokes, and arrhythmias.\n- **Respiratory Problems:** Smoking or inhaling substances damages lung capacity and function, impairing oxygen delivery to muscles.\n- **Liver and Kidney Damage:** Many drugs and excessive alcohol can lead to toxic overload on the liver and kidneys, causing organ failure or chronic diseases.\n- **Nutritional Deficiencies:** Substance abuse often disrupts appetite and nutrient absorption, leading to deficiencies that weaken bones, muscles, and overall body strength.\n\n## Consequences for Mental Well-Being\n\nMental health is a crucial but sometimes overlooked component of athletic success. Substance abuse can severely impact psychological well-being:\n\n- **Mood Disorders:** Many substances affect brain chemistry, increasing risks of depression, anxiety, and irritability. This mental instability can hinder motivation and focus.\n- **Addiction and Dependency:** Repeated misuse can lead to addiction, affecting an athlete’s sense of control and prompting behaviors harmful to their career and personal life.\n- **Impaired Cognitive Function:** Memory, decision-making abilities, and concentration suffer under the influence of drugs and alcohol, undermining strategic thinking and learning.\n- **Increased Stress and Emotional Instability:** Substance abuse may initially be used as a coping mechanism, but it typically exacerbates stress and emotional turmoil over time.\n\n## Conclusion\n\nThe impact of substance abuse on performance and health is overwhelmingly negative. Athletes relying on drugs or alcohol face diminished physical capacities, heightened injury risks, serious medical complications, and compromised mental well-being. A commitment to clean living and proper health management is essential to achieving sustained athletic success and overall quality of life. Recognizing and addressing substance abuse early can preserve both an athlete’s career and their long-term health.\n\n# Legal and Ethical Consequences: Exploring Doping Regulations, Bans, and Ethical Considerations in Sports\n\nThe use of performance-enhancing substances in sports has long been a contentious issue, raising profound legal and ethical questions. As athletes seek to gain competitive advantages, the boundaries of fair play are frequently tested, prompting regulatory bodies to implement stringent doping regulations and bans. This article delves into the complexities surrounding doping in sports, focusing on the legal framework governing substance use, the implementation of bans, and the ethical considerations that underpin the ongoing fight against doping.\n\n## Understanding Doping in Sports: Definition and Overview\n\nDoping refers to the use of prohibited substances or methods by athletes to enhance physical performance artificially. Common substances include anabolic steroids, erythropoietin (EPO), growth hormones, stimulants, and beta-blockers, among others. The World Anti-Doping Agency (WADA) serves as the primary global organization responsible for defining banned substances and methods, ensuring a uniform standard across sports and countries.\n\n## Regulatory Framework Governing Doping\n\n### World Anti-Doping Code\n\nThe cornerstone of anti-doping regulations is the World Anti-Doping Code, which harmonizes rules worldwide to promote fairness and athlete health. Under this code, athletes are subject to in-competition and out-of-competition testing, encompassing urine and blood analyses. Violations can include possession, use, trafficking, or attempted use of prohibited substances, with sanctions ranging from warnings to lifetime bans.\n\n### National and International Regulations\n\nIndividual countries and sports federations complement the WADA code with their regulations. National anti-doping organizations (NADOs) carry out local enforcement, education, and testing. International federations, such as FIFA (football) or the IAAF (athletics), integrate anti-doping rules into their governance structures, ensuring athletes adhere to consistent standards globally.\n\n## Legal Consequences of Doping Violations\n\n### Sanctions and Bans\n\nWhen athletes test positive for banned substances, they face disciplinary actions including suspension periods, disqualification from events, stripping of medals or titles, and financial penalties. Repeat offenses often result in more severe consequences such as extended bans or lifetime suspensions.\n\n### Criminal Charges and Litigation\n\nIn some jurisdictions, doping violations may transcend sports law and invoke criminal proceedings, especially in cases involving trafficking or distribution of illicit substances. Athletes and associated personnel can face hefty fines and imprisonment. Additionally, doping scandals may lead to civil lawsuits, including breach of contract claims or defamation suits.\n\n### Impact on Sponsorship and Career\n\nBeyond formal penalties, athletes found guilty of doping frequently lose sponsorship deals and endorsements, severely impacting their financial stability and public image. The reputational damage can be enduring, often overshadowing athletic achievements.\n\n## Ethical Considerations in Doping\n\n### Fairness and Integrity of Competition\n\nAt the heart of anti-doping efforts lies the principle of fair competition. Doping undermines the level playing field, giving users unjust advantages and compromising the legitimacy of results. Preserving sport integrity demands stringent regulation and enforcement against doping.\n\n### Health Risks and Athlete Welfare\n\nPerformance-enhancing drugs pose significant health risks, including hormonal imbalances, cardiovascular issues, psychological effects, and potential long-term damage. Ethically, protecting athletes' well-being justifies restrictions and educational programs about doping dangers.\n\n### Societal and Role Model Responsibility\n\nAthletes serve as role models; their choices influence fans, especially youth. Ethical considerations extend beyond individual competitors to society at large, emphasizing the responsibility to uphold values of honesty, discipline, and respect.\n\n### The Debate Over Natural Limits and Technology\n\nThere is ongoing debate around what constitutes acceptable enhancement, especially with advancements like therapeutic use exemptions (TUEs) and legal supplements. Ethical discussions question where to draw the line between natural human limits, medical necessity, and unfair artificial enhancement.\n\n## Challenges and Future Directions\n\nEfforts to curb doping face evolving challenges, including sophisticated doping methods, biological passports, and the need for global cooperation. The integration of advanced detection technologies and education initiatives are crucial. Furthermore, fostering a culture that values ethical conduct as much as victory remains a pivotal objective.\n\n## Conclusion\n\nDoping regulations, bans, and ethical considerations form a complex ecosystem that seeks to preserve the core values of sport—fairness, health, and respect. Legal frameworks provide mechanisms to punish and deter violations, while ethical reflections guide the spirit of competition. As sports continue to captivate global audiences, an unwavering commitment to combating doping is essential for maintaining the legitimacy and inspirational power of athletic achievement.\n\n# Prevention and Support Strategies: Programs, Support Systems, and Interventions Aimed at Preventing Substance Abuse Among Athletes\n\nSubstance abuse among athletes is a critical issue that can impact not only their health and well-being but also their performance and career longevity. Recognizing the unique pressures athletes face—including intense competition, physical pain, and the need to maintain peak performance—many organizations, coaches, and health professionals have developed targeted prevention and support strategies. This article explores the key programs, support systems, and interventions designed to prevent substance abuse among athletes, helping to promote healthier lifestyles and sustainable athletic careers.\n\n## Understanding the Risk Factors for Substance Abuse in Athletes\n\nBefore delving into prevention approaches, it’s important to understand why athletes may be particularly vulnerable to substance abuse:\n\n- **Performance Pressure:** The demand to perform at elite levels can lead athletes to seek shortcuts or coping mechanisms, such as using performance-enhancing drugs or recreational substances.\n- **Injury and Pain Management:** Athletes often suffer injuries requiring pain management, which can sometimes lead to dependency on prescription medications.\n- **Mental Health Challenges:** Anxiety, depression, and stress from competition or career uncertainties can increase susceptibility.\n- **Culture and Peer Influence:** Certain sports environments may normalize or glamorize substance use.\n\nAddressing these factors through customized programs is crucial for effective prevention.\n\n## Overview of Prevention Programs for Athletes\n\n### 1. Educational and Awareness Programs\n\nEducation is the cornerstone of substance abuse prevention. Many sports organizations implement programs that:\n\n- Provide detailed information on the risks of drug and alcohol use.\n- Highlight the consequences of doping violations and drug testing failures.\n- Teach coping strategies for performance anxiety and stress.\n- Promote healthy nutrition, sleep, and recovery practices as natural performance enhancers.\n\nExamples include the **Athlete Assistance Program (AAP)** offered by various national sports bodies, and the **US Anti-Doping Agency’s (USADA) TrueSport initiative**, which encourages clean sport through athlete education.\n\n### 2. Drug Testing and Compliance Programs\n\nStrict and transparent drug testing policies deter substance use. Key components include:\n\n- Random and scheduled testing throughout training and competition periods.\n- Clear communication of banned substances lists.\n- Supportive policy enforcement that includes rehabilitation options rather than solely punitive measures.\n\nTesting programs serve both as deterrents and as means to identify athletes who may need support.\n\n### 3. Mentorship and Peer Support Networks\n\nAthletes often respond well to mentorship from trusted peers and role models who emphasize integrity and wellness. Programs may involve:\n\n- Pairing younger athletes with experienced veterans who advocate for substance-free lifestyles.\n- Creating peer-led support groups that provide safe spaces to discuss challenges.\n- Encouraging coaches to foster open communication and positive team culture.\n\n### 4. Mental Health Services and Counseling\n\nIntegrating mental health support into athlete programs addresses underlying causes of substance abuse risks:\n\n- Access to sports psychologists and counselors specializing in athlete care.\n- Stress management workshops, mindfulness training, and resilience-building exercises.\n- Confidential services to address personal or career-related issues.\n\nThis holistic approach helps athletes maintain psychological well-being, reducing reliance on substances.\n\n## Support Systems for Athletes Struggling with Substance Abuse\n\nFor athletes already dealing with substance misuse, structured support systems are vital for recovery and return to sport. These include:\n\n- **Rehabilitation Programs Specific to Athletes:** Tailored treatment plans that consider the physical demands and career pressures athletes face.\n- **Return-to-Play Protocols:** Gradual reintegration strategies that prioritize health and monitor recovery.\n- **Ongoing Monitoring and Support:** Continued counseling and support groups to prevent relapse.\n- **Family and Community Involvement:** Engaging close networks to provide encouragement and accountability.\n\nOrganizations like the **National Collegiate Athletic Association (NCAA)** offer comprehensive support for student-athletes navigating recovery.\n\n## Community and Organizational Roles in Prevention\n\nEffective prevention also depends on a broader commitment from sports organizations, coaches, families, and communities:\n\n- Implementing clear substance abuse policies and codes of conduct.\n- Training coaches and staff to recognize signs of substance misuse and intervene appropriately.\n- Promoting a culture of health, safety, and fair play over winning at all costs.\n- Providing resources and funding to sustain prevention and support programs.\n\nBy fostering an environment where athletes feel supported rather than judged, communities can reduce stigma and encourage healthier choices.\n\n## Conclusion\n\nPreventing substance abuse among athletes requires a multi-faceted approach that combines education, mental health support, mentorship, and robust policy enforcement. Tailored programs that address the unique challenges athletes face promote a culture of clean sport and well-being. Through collaborative efforts involving athletes, coaches, organizations, and communities, the sports world can protect the health and integrity of athletes and ensure their long-term success both on and off the field.\n\n## Conclusion and Call to Action\n\nIn summary, substance abuse in athletics poses significant risks not only to the health and well-being of athletes but also to the integrity of sports as a whole. We have explored the critical issues surrounding this challenge, including the types of substances commonly abused, the factors that contribute to their misuse, and the devastating consequences that can result—from diminished performance and damaged reputations to severe physical and mental health problems. Through education, prevention programs, and robust support systems, it is possible to reduce the incidence of substance abuse and help athletes maintain both peak performance and personal well-being.\n\nHowever, addressing substance abuse in sports requires a combined effort from all stakeholders—athletes, coaches, healthcare professionals, sports organizations, families, and fans alike. Increased awareness is the first essential step. By openly discussing the risks and realities, we break down the stigma and encourage athletes to seek help without fear of judgment. Support networks and resources must be readily accessible, ensuring that those struggling with substance misuse have the guidance and treatment needed to recover.\n\nWe call on everyone involved in athletics to take action. Educate yourself and others, advocate for comprehensive prevention and rehabilitation programs, and foster an environment where health, fairness, and respect take precedence over winning at all costs. Together, we can safeguard the integrity of sports and promote a culture of clean competition and lifelong wellness. Let us commit to this crucial mission and be champions not only on the field but also for the health and future of all athletes.")</code></pre>
</div>
</div>
<p>Next, you’ll learn how to implement this pattern using LangGraph.</p>
</section>
<section id="langgraph-3" class="level4">
<h4 class="anchored" data-anchor-id="langgraph-3">LangGraph</h4>
<p>You must define the state of the orchestrator, the workers (who write the sections), and the data models used in the workflow.</p>
<div id="cell-82" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">class</span> Section(BaseModel):</span>
<span id="cb36-2"><a href="#cb36-2"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The name of the section"</span>)</span>
<span id="cb36-3"><a href="#cb36-3"></a>    description: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The description of the section"</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="kw">class</span> CompletedSection(BaseModel):</span>
<span id="cb36-7"><a href="#cb36-7"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The name of the section"</span>)</span>
<span id="cb36-8"><a href="#cb36-8"></a>    content: <span class="bu">str</span> <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The content of the section"</span>)</span>
<span id="cb36-9"><a href="#cb36-9"></a></span>
<span id="cb36-10"><a href="#cb36-10"></a></span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="kw">class</span> Sections(BaseModel):</span>
<span id="cb36-12"><a href="#cb36-12"></a>    sections: <span class="bu">list</span>[Section] <span class="op">=</span> Field(description<span class="op">=</span><span class="st">"The sections of the article"</span>)</span>
<span id="cb36-13"><a href="#cb36-13"></a></span>
<span id="cb36-14"><a href="#cb36-14"></a></span>
<span id="cb36-15"><a href="#cb36-15"></a><span class="kw">class</span> OrchestratorState(TypedDict):</span>
<span id="cb36-16"><a href="#cb36-16"></a>    topic: <span class="bu">str</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>    sections: <span class="bu">list</span>[Section]</span>
<span id="cb36-18"><a href="#cb36-18"></a>    completed_sections: Annotated[<span class="bu">list</span>[CompletedSection], operator.add]</span>
<span id="cb36-19"><a href="#cb36-19"></a>    final_report: <span class="bu">str</span></span>
<span id="cb36-20"><a href="#cb36-20"></a></span>
<span id="cb36-21"><a href="#cb36-21"></a></span>
<span id="cb36-22"><a href="#cb36-22"></a><span class="kw">class</span> WorkerState(TypedDict):</span>
<span id="cb36-23"><a href="#cb36-23"></a>    section: <span class="bu">str</span></span>
<span id="cb36-24"><a href="#cb36-24"></a>    completed_sections: Annotated[<span class="bu">list</span>[Section], operator.add]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The state definition changes slightly, as in this case, you need to define a worker state, which is used when the orchestrator assigns a task to a worker.</p>
<div id="cell-84" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">def</span> orchestrator(state: OrchestratorState) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb37-2"><a href="#cb37-2"></a>    model_planner <span class="op">=</span> model.with_structured_output(Sections)</span>
<span id="cb37-3"><a href="#cb37-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb37-4"><a href="#cb37-4"></a>        SystemMessage(</span>
<span id="cb37-5"><a href="#cb37-5"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic, you will generate the sections for a short article."</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>        ),</span>
<span id="cb37-7"><a href="#cb37-7"></a>        HumanMessage(</span>
<span id="cb37-8"><a href="#cb37-8"></a>            content<span class="op">=</span><span class="ss">f"Generate the sections of an article about </span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb37-9"><a href="#cb37-9"></a>        ),</span>
<span id="cb37-10"><a href="#cb37-10"></a>    ]</span>
<span id="cb37-11"><a href="#cb37-11"></a>    <span class="cf">return</span> {<span class="st">"sections"</span>: model_planner.invoke(messages).sections}</span>
<span id="cb37-12"><a href="#cb37-12"></a></span>
<span id="cb37-13"><a href="#cb37-13"></a></span>
<span id="cb37-14"><a href="#cb37-14"></a><span class="kw">def</span> write_section(state: WorkerState) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb37-15"><a href="#cb37-15"></a>    messages <span class="op">=</span> [</span>
<span id="cb37-16"><a href="#cb37-16"></a>        SystemMessage(</span>
<span id="cb37-17"><a href="#cb37-17"></a>            content<span class="op">=</span><span class="st">"You are an expert writer specialized in SEO. Provided with a topic and a table of contents, you will generate the content of the article."</span></span>
<span id="cb37-18"><a href="#cb37-18"></a>        ),</span>
<span id="cb37-19"><a href="#cb37-19"></a>        HumanMessage(</span>
<span id="cb37-20"><a href="#cb37-20"></a>            content<span class="op">=</span><span class="ss">f"Generate the content of an article about </span><span class="sc">{</span>state[<span class="st">'section'</span>]<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with the following description: </span><span class="sc">{</span>state[<span class="st">'section'</span>]<span class="sc">.</span>description<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb37-21"><a href="#cb37-21"></a>        ),</span>
<span id="cb37-22"><a href="#cb37-22"></a>    ]</span>
<span id="cb37-23"><a href="#cb37-23"></a>    section <span class="op">=</span> CompletedSection(</span>
<span id="cb37-24"><a href="#cb37-24"></a>        name<span class="op">=</span>state[<span class="st">'section'</span>].name, content<span class="op">=</span>model.invoke(messages).content</span>
<span id="cb37-25"><a href="#cb37-25"></a>    )</span>
<span id="cb37-26"><a href="#cb37-26"></a>    <span class="cf">return</span> {<span class="st">"completed_sections"</span>: [section]}</span>
<span id="cb37-27"><a href="#cb37-27"></a></span>
<span id="cb37-28"><a href="#cb37-28"></a></span>
<span id="cb37-29"><a href="#cb37-29"></a><span class="kw">def</span> synthesizer(state: OrchestratorState) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb37-30"><a href="#cb37-30"></a>    ordered_sections <span class="op">=</span> state[<span class="st">"completed_sections"</span>]</span>
<span id="cb37-31"><a href="#cb37-31"></a>    completed_sections_str <span class="op">=</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>.join(</span>
<span id="cb37-32"><a href="#cb37-32"></a>        [section.content <span class="cf">for</span> section <span class="kw">in</span> ordered_sections]</span>
<span id="cb37-33"><a href="#cb37-33"></a>    )</span>
<span id="cb37-34"><a href="#cb37-34"></a>    <span class="cf">return</span> {<span class="st">"final_report"</span>: completed_sections_str}</span>
<span id="cb37-35"><a href="#cb37-35"></a></span>
<span id="cb37-36"><a href="#cb37-36"></a></span>
<span id="cb37-37"><a href="#cb37-37"></a><span class="kw">def</span> assign_workers(state: OrchestratorState) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb37-38"><a href="#cb37-38"></a>    <span class="cf">return</span> [</span>
<span id="cb37-39"><a href="#cb37-39"></a>        Send(<span class="st">"write_section"</span>, {<span class="st">"section"</span>: section}) <span class="cf">for</span> section <span class="kw">in</span> state[<span class="st">"sections"</span>]</span>
<span id="cb37-40"><a href="#cb37-40"></a>    ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you’ll define the graph that will be used to run the workflow.</p>
<div id="cell-86" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>workflow_builder <span class="op">=</span> StateGraph(OrchestratorState)</span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a>workflow_builder.add_node(<span class="st">"orchestrator"</span>, orchestrator)</span>
<span id="cb38-4"><a href="#cb38-4"></a>workflow_builder.add_node(<span class="st">"write_section"</span>, write_section)</span>
<span id="cb38-5"><a href="#cb38-5"></a>workflow_builder.add_node(<span class="st">"synthesizer"</span>, synthesizer)</span>
<span id="cb38-6"><a href="#cb38-6"></a></span>
<span id="cb38-7"><a href="#cb38-7"></a>workflow_builder.add_edge(START, <span class="st">"orchestrator"</span>)</span>
<span id="cb38-8"><a href="#cb38-8"></a>workflow_builder.add_conditional_edges(<span class="st">"orchestrator"</span>, assign_workers, [<span class="st">"write_section"</span>])</span>
<span id="cb38-9"><a href="#cb38-9"></a>workflow_builder.add_edge(<span class="st">"write_section"</span>, <span class="st">"synthesizer"</span>)</span>
<span id="cb38-10"><a href="#cb38-10"></a></span>
<span id="cb38-11"><a href="#cb38-11"></a>workflow <span class="op">=</span> workflow_builder.<span class="bu">compile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You build the workflow by initializing a <code>StateGraph</code> object. In it, you’ll assign your functions to serve as nodes and then define the edges that establish the pathways between them. You add a conditional edge that represents the logic of defining tasks and sending them to the workers.</p>
<p>Once you’ve defined the graph, you can compile.</p>
<p>Finally, you can generate a diagram of the workflow using the <code>get_graph</code> and <code>draw_mermaid_png</code> methods. You’ll noticed that compared to the parallelization workflow, the orchestrator-workers has a dotted line from the orchestrator to the workers, which means that the orchestrator conditionally defines the tasks to be sent to the workers.</p>
<div id="cell-88" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>display(Image(workflow.get_graph().draw_mermaid_png()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="agentic-workflows-langgraph_files/figure-html/cell-35-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="agentic-workflows-langgraph_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Then, you can run the workflow.</p>
<div id="cell-90" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>workflow.invoke({<span class="st">"topic"</span>: <span class="st">"Substance abuse of athletes"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>{'topic': 'Substance abuse of athletes',
 'sections': [Section(name='Introduction to Substance Abuse in Athletes', description='Overview of substance abuse issues commonly faced by athletes, including types of substances and reasons for usage.'),
  Section(name='Common Substances Abused by Athletes', description='Detailed description of substances frequently abused such as steroids, stimulants, painkillers, and recreational drugs.'),
  Section(name='Causes and Risk Factors', description='Exploration of psychological, social, and professional factors that contribute to substance abuse among athletes.'),
  Section(name='Health and Performance Consequences', description="Analysis of the physical and mental impacts of substance abuse on athletes' health and sports performance."),
  Section(name='Detection and Prevention Strategies', description='Information on how substance abuse is detected in athletes and strategies used to prevent it, including testing and education programs.'),
  Section(name='Support and Rehabilitation', description='Description of available support systems and rehabilitation programs designed to help athletes overcome substance abuse.'),
  Section(name='Conclusion and Future Perspectives', description='Summary of key points and discussion of emerging trends and future approaches to addressing substance abuse among athletes.')],
 'completed_sections': [CompletedSection(name='Introduction to Substance Abuse in Athletes', content='# Introduction to Substance Abuse in Athletes\n\nSubstance abuse among athletes is a significant concern that affects not only their health but also their performance, careers, and overall well-being. Despite the physical and mental discipline required in sports, athletes are not immune to the pressures and challenges that can lead to the use and abuse of various substances. Understanding the types of substances commonly used and the reasons why athletes may turn to them is crucial for addressing this issue effectively.\n\n## Common Types of Substances Abused by Athletes\n\nAthletes may misuse a wide range of substances, each serving different purposes or fulfilling different needs depending on the individual and their circumstances. Some of the most common categories include:\n\n### 1. Performance-Enhancing Drugs (PEDs)\nPerformance-enhancing drugs are substances used to improve athletic ability beyond natural limits. These include anabolic steroids, human growth hormone (HGH), erythropoietin (EPO), and stimulants. Athletes may use these drugs to increase muscle mass, enhance endurance, speed up recovery, and gain a competitive advantage.\n\n### 2. Recreational Drugs\nRecreational drugs such as marijuana, cocaine, MDMA, and opioids are sometimes abused by athletes to cope with stress, manage pain, or for social reasons. While these substances do not improve athletic performance and can be detrimental, their use is often linked to external pressures or underlying issues.\n\n### 3. Prescription Medications\nCertain prescription medications, including painkillers (opioids), anti-anxiety drugs (benzodiazepines), and stimulants (used for ADHD), can be abused by athletes. These drugs might be used to manage pain from injuries, reduce anxiety before competitions, or increase focus and alertness.\n\n### 4. Over-the-Counter (OTC) Substances and Supplements\nThough generally legal and accessible, some OTC substances and dietary supplements can be misused, especially when athletes seek to lose weight rapidly or boost energy. Misuse can sometimes lead to harmful side effects or positive doping tests if the substances contain banned ingredients.\n\n## Reasons for Substance Abuse Among Athletes\n\nThe motivations behind substance abuse in athletes are complex and multifaceted. Some of the most common reasons include:\n\n### 1. Enhancing Performance\nThe intense desire to win and excel can lead athletes to experiment with drugs that promise enhanced strength, endurance, or recovery. In highly competitive environments, athletes may feel pressure to push beyond their natural limits.\n\n### 2. Coping with Pain and Injuries\nPhysical injuries are common in sports, and the pain associated with them can lead athletes to seek relief through prescription painkillers or other substances. Unfortunately, this can sometimes escalate into abuse and dependency.\n\n### 3. Managing Stress and Anxiety\nThe psychological pressures of competition, public scrutiny, and personal expectations can cause significant mental stress. Some athletes turn to drugs to alleviate anxiety, improve mood, or escape from personal and professional challenges.\n\n### 4. Peer Influence and Culture\nIn some sports cultures, the use of substances may be normalized or even encouraged, creating an environment where athletes feel compelled to conform. Peer influence and the desire to belong can drive substance use.\n\n### 5. Weight Control and Body Image\nCertain sports emphasize weight categories or aesthetic appearance, prompting athletes to misuse substances that suppress appetite or promote rapid weight loss.\n\n## Conclusion\n\nSubstance abuse in athletes is a serious and multifaceted problem that demands awareness, education, and intervention at multiple levels. Recognizing the types of substances commonly abused and understanding the underlying reasons for their use is the first step towards promoting healthier choices and safeguarding the integrity of sports. Athletes, coaches, medical professionals, and organizations must work collaboratively to address these issues through prevention, support, and treatment.'),
  CompletedSection(name='Common Substances Abused by Athletes', content='# Common Substances Abused by Athletes\n\nAthletes often face immense pressure to perform at their best, maintain stamina, and recover quickly from injuries. Unfortunately, some turn to substances that can enhance performance or alleviate pain, despite the health risks and ethical concerns involved. This article provides a detailed description of the most frequently abused substances among athletes, focusing on steroids, stimulants, painkillers, and recreational drugs.\n\n## Anabolic Steroids\n\nAnabolic steroids are synthetic variations of the male hormone testosterone. Athletes abuse them to increase muscle mass, strength, and overall physical performance. Steroids work by promoting protein synthesis within cells, leading to rapid muscle growth.\n\n### Common Types and Effects\n- **Types**: Testosterone, nandrolone, stanozolol, and methyltestosterone.\n- **Effects**: Increased muscle size, enhanced recovery rate, greater endurance, and reduced fatigue.\n\n### Risks and Side Effects\n- Hormonal imbalances leading to acne, hair loss, and mood swings.\n- Cardiovascular issues such as high blood pressure and increased risk of heart attack.\n- Liver damage and potential infertility.\n- Psychological effects including aggression and depression.\n  \nDespite their performance-enhancing properties, anabolic steroids are banned in most sports leagues and athletic organizations.\n\n## Stimulants\n\nStimulants are substances that increase alertness, attention, and energy by enhancing the activity of the central nervous system. Athletes may use stimulants to reduce fatigue and improve focus during training or competition.\n\n### Common Stimulants\n- **Amphetamines**: Often prescribed for ADHD but misused for increased energy.\n- **Caffeine**: The world’s most widely consumed legal stimulant.\n- **Ephedrine**: Used for weight loss and increased energy but banned in many competitions.\n  \n### Effects\n- Increased heart rate and blood pressure.\n- Heightened concentration and wakefulness.\n- Temporary reduction of appetite and fatigue.\n\n### Risks\n- Dependence and addiction.\n- Cardiovascular complications, including arrhythmias and heart attacks.\n- Nervousness, anxiety, and sleep disturbances.\n  \nWhile moderate caffeine use is generally accepted, other stimulants are typically prohibited due to their performance-enhancing effects and health risks.\n\n## Painkillers\n\nPainkillers, particularly opioid analgesics and non-steroidal anti-inflammatory drugs (NSAIDs), are commonly prescribed to manage injuries and pain. However, abuse can occur when athletes rely excessively on these drugs to continue competing.\n\n### Commonly Abused Painkillers\n- **Opioids**: Morphine, oxycodone, hydrocodone.\n- **NSAIDs**: Ibuprofen, naproxen (abuse generally less severe but problematic if overused).\n\n### Effects\n- Temporary pain relief and increased ability to train through injury.\n- Sedation and euphoria (primarily with opioids).\n\n### Risks\n- Opioid addiction, respiratory depression, and overdose.\n- Gastrointestinal issues and kidney damage with long-term NSAID use.\n- Masking of pain leading to worsened injuries.\n\nDue to the risk of dependency, strict guidelines exist for the medical use of painkillers among athletes.\n\n## Recreational Drugs\n\nSome athletes use recreational drugs for relaxation or coping with stress, despite the negative impact on performance and health.\n\n### Common Recreational Drugs Abused\n- **Cannabis**: Used for relaxation and pain relief; banned in many competitions.\n- **Alcohol**: Consumed socially but can impair recovery and performance.\n- **Cocaine and Ecstasy**: Occasionally abused for their stimulant and euphoric effects.\n\n### Effects\n- Altered mental state, reduced reaction time, and impaired coordination.\n- Short-term mood enhancement or relaxation.\n\n### Risks\n- Detrimental effects on cardiovascular health.\n- Legal issues and sanctions from sports authorities.\n- Negative impact on motivation, training, and overall athletic performance.\n\n## Conclusion\n\nThe abuse of steroids, stimulants, painkillers, and recreational drugs poses serious health risks and ethical dilemmas in sports. While the desire to perform better or manage pain is understandable, these substances can undermine an athlete’s long-term wellbeing and the integrity of athletic competition. Education, support, and strict regulation remain crucial in addressing substance abuse among athletes.'),
  CompletedSection(name='Causes and Risk Factors', content='# Causes and Risk Factors: Exploring Psychological, Social, and Professional Contributors to Substance Abuse Among Athletes\n\nSubstance abuse among athletes is a pressing concern that extends beyond physical performance to affect their mental health, career longevity, and overall well-being. Understanding the underlying causes and risk factors is essential for developing effective prevention and intervention strategies. This article delves into the psychological, social, and professional factors that contribute to substance abuse in the athletic community.\n\n## Psychological Factors\n\n### Pressure to Perform and Perfectionism\nAthletes often face intense pressure to perform at peak levels consistently. This demand can trigger anxiety, stress, and feelings of inadequacy. The desire for perfection may lead some athletes to use substances such as stimulants or performance-enhancing drugs to cope with the high expectations and overcome self-doubt.\n\n### Mental Health Challenges\nDepression, anxiety disorders, and other mental health issues are prevalent among athletes. The stigma around seeking psychological help often forces athletes to self-medicate with alcohol or drugs as a way to manage emotional pain, stress, or injury-related trauma.\n\n### Coping Mechanisms for Injury and Pain\nPhysical injuries are a common aspect of athletic careers. The chronic pain associated with injuries can lead athletes to misuse prescription medications like opioids or overconsume alcohol to alleviate discomfort and continue training or competing, inadvertently increasing the risk of substance dependence.\n\n## Social Factors\n\n### Peer Influence and Team Culture\nThe social environment within teams can profoundly impact substance use behaviors. If drug or alcohol use is normalized or even glamorized among teammates, new or younger athletes may feel pressured to conform to these norms to gain acceptance or camaraderie.\n\n### Social Isolation and Loneliness\nDespite being part of a team, athletes may experience social isolation due to rigorous training schedules, travel, or being away from family and friends. This loneliness can increase vulnerability to substance use as a misguided attempt to fill emotional voids or manage feelings of alienation.\n\n### Media and Celebrity Influence\nExposure to celebrity athletes who openly use or are rumored to use substances can create misleading narratives about drug use and its perceived benefits. This influence can lower inhibitions and reshape attitudes towards substance use, especially among younger athletes aspiring to emulate their idols.\n\n## Professional Factors\n\n### Demands of Competitive Sports\nThe professional athletic environment is highly competitive, with careers often hinging on performance and winning. The associated stress can drive athletes to use substances that promise enhanced stamina, focus, or recovery, sometimes blurring the line between legitimate medical use and abuse.\n\n### Career Uncertainty and Transition Stress\nAthletes frequently face uncertainty regarding career longevity due to factors such as injuries or declining performance. The stress related to contract negotiations, retirement planning, or forced career changes may lead to increased substance use as a maladaptive coping strategy.\n\n### Accessibility and Medical Prescriptions\nAthletes generally have greater access to medical facilities and prescription medications than the general population. While this access is crucial for health management, it also increases the risk of prescription drug misuse, especially when oversight is inadequate or when medications are used beyond therapeutic purposes.\n\n## Conclusion\n\nThe causes and risk factors behind substance abuse among athletes are multifaceted, involving a complex interplay of psychological pressures, social dynamics, and professional challenges. Recognizing these contributing elements is vital for coaches, medical professionals, and support networks to create comprehensive prevention programs and provide the necessary resources to help athletes maintain healthy lifestyles free from substance abuse. Only through holistic understanding and targeted action can the athletic community effectively combat this pervasive issue.'),
  CompletedSection(name='Health and Performance Consequences', content="# Health and Performance Consequences: The Physical and Mental Impacts of Substance Abuse on Athletes\n\nSubstance abuse among athletes is a critical issue that can profoundly affect both their health and sports performance. While some may turn to drugs or alcohol as a coping mechanism for stress, injury, or pressure, the consequences can be far-reaching and damaging. This article provides an in-depth analysis of the physical and mental impacts of substance abuse on athletes, emphasizing why maintaining a healthy lifestyle is essential for peak performance and overall well-being.\n\n## Physical Impacts of Substance Abuse on Athletes\n\n### 1. Deterioration of Cardiovascular Health\nMany substances abused by athletes, such as stimulants and anabolic steroids, place significant strain on the cardiovascular system. Stimulants like cocaine and amphetamines increase heart rate and blood pressure, leading to arrhythmias, hypertension, and even sudden cardiac arrest. Anabolic steroids can cause thickening of the heart muscle and increase the risk of heart attacks and strokes. Such cardiovascular issues directly impair an athlete's endurance, stamina, and ability to perform at high levels.\n\n### 2. Impaired Muscular Strength and Recovery\nThough some athletes misuse anabolic steroids to enhance muscle mass, chronic abuse can backfire by causing muscle cramps, weakness, and tendon ruptures. Other substances like alcohol interfere with protein synthesis and muscle repair, prolonging recovery time after training or injury. Dehydration and nutrient depletion caused by certain drugs further weaken muscles, limiting strength and agility on the field.\n\n### 3. Compromised Immune Function\nSubstance abuse can suppress the immune system, making athletes more susceptible to infections and illnesses. For example, excessive alcohol intake has been shown to reduce white blood cell activity, reducing the body’s ability to fight off viruses and bacteria. This leads to increased downtime due to illness and a diminished capacity to handle the physical demands of training and competition.\n\n### 4. Respiratory and Neurological Damage\nSmoking substances like tobacco or marijuana damages lung tissue and reduces oxygen uptake, critical for aerobic performance. Inhalants and certain drugs can cause long-term neurological damage including impaired coordination, balance, and reflexes—all vital for athletic skills. Brain injuries resulting from drug use can be irreversible, severely impacting motor skills and reaction times.\n\n## Mental and Psychological Consequences\n\n### 1. Cognitive Decline and Impaired Decision-Making\nSubstance abuse affects areas of the brain responsible for judgment, focus, and reaction time. Athletes abusing drugs may experience difficulties with concentration, memory, and decision-making — all essential skills for strategic gameplay and quick reactions in sports. Cognitive impairment can lead to poor game performance and increased risk of injury.\n\n### 2. Increased Anxiety, Depression, and Mood Disorders\nMany athletes turn to substances as a method of managing anxiety or depression. However, the temporary relief these substances provide is often followed by worsening symptoms. Long-term substance abuse is linked with increased rates of anxiety disorders, depression, and mood swings. Mental health struggles not only impair motivation and training consistency but also increase the likelihood of burnout and withdrawal from sport.\n\n### 3. Addiction and Dependence\nPhysical and psychological dependence on performance-enhancing or recreational drugs can trap athletes in destructive cycles. Addiction disrupts daily routines, training schedules, and professional commitments. The stress of hiding substance use and dealing with its consequences adds an additional psychological burden, often leading to social isolation and damaged relationships.\n\n### 4. Impact on Team Dynamics and Reputation\nMental health issues stemming from substance abuse can make athletes volatile or withdrawn, affecting communication and collaboration within a team. Additionally, public knowledge of substance abuse can tarnish an athlete’s reputation, leading to a loss of sponsorships, fan support, and career opportunities.\n\n## Conclusion: Prioritizing Health to Sustain Performance\n\nThe interplay between substance abuse and athletic health creates a dangerous cycle where physical and mental degradations impair performance, which in turn may lead to further substance use in an attempt to compensate. Athletes must prioritize healthy coping strategies, proper medical guidance, and mental health support to maintain optimal performance and longevity in their sports careers. Coaches, trainers, and sporting organizations also play a pivotal role in providing education and resources to prevent substance abuse and support recovery. Ultimately, safeguarding an athlete’s well-being ensures not only superior performance but a fulfilling and sustainable athletic journey."),
  CompletedSection(name='Detection and Prevention Strategies', content='# Detection and Prevention Strategies for Substance Abuse in Athletes\n\nSubstance abuse in athletes not only undermines fair competition but also poses significant health risks. To maintain integrity in sports and protect athletes’ well-being, robust detection and prevention strategies are essential. This article explores the methods used to identify substance abuse in athletes and the proactive approaches employed to prevent it, focusing on testing protocols and educational programs.\n\n## Detection of Substance Abuse in Athletes\n\n### 1. Drug Testing Protocols\nOne of the primary methods for detecting substance abuse in athletes is through comprehensive drug testing programs. These tests can be conducted both in and out of competition, aiming to identify banned substances such as anabolic steroids, stimulants, diuretics, and other performance-enhancing drugs (PEDs).\n\n- **Urine Testing:** The most common and widely used method, urine tests can detect a broad range of substances and their metabolites. Samples are collected under strict supervision to prevent tampering.\n- **Blood Testing:** Used to detect substances that may not appear in urine or to determine the concentration of certain drugs, such as erythropoietin (EPO) or hormones.\n- **Hair and Saliva Testing:** These methods are less common but provide longer detection windows or rapid results, respectively.\n\nTesting is typically random, scheduled, or targeted based on certain risk factors or suspicious behavior, helping to deter and catch substance abuse.\n\n### 2. Biological Passport Programs\nThe Athlete Biological Passport (ABP) monitors selected biological variables over time. Rather than detecting the substance directly, it identifies abnormal changes in an athlete’s biological markers that suggest doping. This method enhances detection capabilities for substances that are otherwise difficult to identify.\n\n### 3. Observational and Behavioral Monitoring\nCoaches, medical staff, and anti-doping officials also rely on behavioral observations to detect potential substance abuse. Changes in performance, physical appearance, or behavior can prompt further investigation or testing.\n\n## Prevention Strategies\n\n### 1. Education Programs\nEducation is a cornerstone in preventing substance abuse. Athletes, coaches, and supporting personnel are provided with information about:\n\n- The health risks associated with drug use.\n- The ethical implications and impact on sporting integrity.\n- The specific substances banned by anti-doping authorities.\n- How testing procedures work and the consequences of violations.\n\nEffective education fosters informed decision-making and empowers athletes to resist pressure or temptation to use prohibited substances.\n\n### 2. Promoting a Culture of Clean Sport\nEncouraging a culture that values fair play and health over winning at all costs is essential. This includes:\n\n- Encouraging open dialogue about doping risks.\n- Highlighting positive role models who compete clean.\n- Building supportive environments where athletes can seek help for pressures or substance-related issues without stigma.\n\n### 3. Support Services and Counseling\nProviding access to psychological support and counseling can address underlying issues that might lead athletes to use substances, such as stress, anxiety, or injury-related pain management.\n\n### 4. Policy and Enforcement\nClear rules, consistent enforcement, and transparent consequences reinforce deterrents against doping. Collaboration among sports organizations, anti-doping agencies, and governments ensures that policies are up-to-date and effectively implemented.\n\n## Conclusion\n\nDetecting and preventing substance abuse in athletes requires a multifaceted approach that combines advanced testing technologies, continuous monitoring, education, and supportive environments. By integrating these strategies, the sports community can better protect athletes’ health, uphold the spirit of fair competition, and maintain public confidence in sport.'),
  CompletedSection(name='Support and Rehabilitation', content='# Support and Rehabilitation: Helping Athletes Overcome Substance Abuse\n\nSubstance abuse is a significant challenge faced by many athletes, often impacting not only their performance but also their overall health and well-being. Fortunately, a variety of support systems and rehabilitation programs have been developed to assist athletes in overcoming these issues. These resources provide comprehensive care, from initial intervention to long-term recovery, helping athletes regain control of their lives both on and off the field.\n\n## Understanding the Need for Support and Rehabilitation\n\nAthletes are under tremendous pressure to perform, which can sometimes lead to the misuse of substances such as performance enhancers, painkillers, or recreational drugs. The stigma surrounding substance abuse in sports may create barriers to seeking help, making effective support and rehabilitation programs critical.\n\nThese programs are specifically designed to address the unique physical, emotional, and psychological demands athletes face. Tailored support systems ensure that athletes receive care that respects their competitive schedules while focusing on sustainable recovery.\n\n## Types of Support Systems Available to Athletes\n\n### 1. Counseling and Psychological Support\n\nOne of the foundational elements in addressing substance abuse is access to professional counseling. Sports psychologists and addiction counselors work with athletes to tackle underlying issues such as anxiety, depression, or trauma that often contribute to substance misuse. Cognitive-behavioral therapy (CBT) and motivational interviewing are common techniques used to foster behavioral change and build resilience.\n\n### 2. Peer Support Groups\n\nPeer networks provide a safe environment where athletes can share experiences, challenges, and coping strategies. Groups such as Athlete Assistance Programs (AAP) and specialized 12-step programs tailored for athletes encourage mutual support and accountability. Being part of a community reduces feelings of isolation and stigma, fostering a sense of belonging and motivation.\n\n### 3. Family and Social Support\n\nRehabilitation is more effective when athletes have a strong support system at home and within their social circles. Many programs involve family therapy or educational sessions to help loved ones understand substance abuse and learn how to provide constructive support throughout recovery.\n\n## Rehabilitation Programs Tailored for Athletes\n\n### 1. Inpatient Rehabilitation\n\nFor athletes with severe substance dependence, inpatient rehabilitation centers offer intensive, structured care. These programs provide medical supervision, detoxification services, and comprehensive therapy in a controlled environment. Many centers integrate physical conditioning and sports-specific rehabilitation to help athletes maintain fitness and facilitate reintegration into their sport.\n\n### 2. Outpatient Rehabilitation\n\nOutpatient programs provide flexibility for athletes who cannot commit to prolonged residential stays due to training or competition schedules. These programs offer scheduled therapy sessions, group meetings, and medical support, allowing athletes to receive care while continuing their regular activities. Outpatient care often serves as a step-down for those transitioning from inpatient programs.\n\n### 3. Holistic and Integrative Approaches\n\nModern rehabilitation programs increasingly incorporate holistic therapies to address the physical and emotional aspects of recovery. These may include yoga, mindfulness meditation, nutrition counseling, and acupuncture. Such approaches help athletes develop healthier lifestyles, manage stress, and reduce the likelihood of relapse.\n\n## Role of Sports Organizations and Governing Bodies\n\nSports organizations play a pivotal role in providing resources and creating policies that support athletes facing substance abuse. Many federations offer confidential help lines, educational seminars, and funding for rehabilitation programs. Anti-doping agencies also emphasize rehabilitation over punishment, aiming to promote athlete health and ethical competition.\n\n## Success Stories and Outcomes\n\nNumerous athletes have successfully overcome substance abuse through dedicated support and rehabilitation. These success stories highlight the effectiveness of targeted programs that combine medical treatment, psychological support, and social reintegration. Recovery not only improves personal health but also restores athletic potential and inspires others facing similar struggles.\n\n## Conclusion\n\nSubstance abuse among athletes is a complex issue requiring specialized support and rehabilitation programs. By leveraging counseling, peer support, family involvement, and tailored rehabilitation services, athletes can overcome these challenges and return to optimal performance and well-being. Ongoing collaboration between healthcare providers, sports organizations, and athletes themselves is essential to foster environments that encourage recovery and sustainable success.'),
  CompletedSection(name='Conclusion and Future Perspectives', content='## Conclusion and Future Perspectives\n\n### Summary of Key Points\n\nAddressing substance abuse among athletes remains a critical challenge that demands comprehensive, evidence-based strategies. Throughout this article, we have explored the multifaceted nature of substance abuse in the athletic community, highlighting its complex interplay with physical performance pressures, mental health issues, and social influences. Key points include:\n\n- **Prevalence and Types of Substance Abuse:** Athletes are susceptible to various substances, ranging from performance-enhancing drugs like anabolic steroids to recreational drugs and prescription medication misuse.\n- **Risk Factors:** High-performance demands, injury management, psychological stress, and the culture of competitive sports contribute significantly to the risk of substance abuse.\n- **Impact on Health and Career:** Substance abuse not only jeopardizes athletes’ physical and mental well-being but also threatens their careers through sanctions, suspensions, and loss of reputation.\n- **Current Prevention and Intervention Strategies:** These include education programs, strict doping controls, psychological support, and rehabilitation services tailored to the athletic population.\n\nUnderstanding these essentials underscores the need for a strategic, multidisciplinary approach to mitigate substance abuse risks effectively.\n\n### Emerging Trends and Future Approaches\n\nLooking forward, the landscape of managing substance abuse among athletes is evolving, propelled by advancements in technology, research, and policy development. New trends and promising approaches include:\n\n- **Personalized Prevention Programs:** Leveraging data analytics and behavioral assessments to create individualized intervention plans that address specific risk factors and psychological profiles unique to each athlete.\n- **Enhanced Screening and Detection Methods:** Innovations such as biomarker identification, genetic testing, and advanced neuroimaging are improving the accuracy and timeliness of substance abuse detection.\n- **Integrative Mental Health Services:** Future programs emphasize holistic care by integrating mental health support, stress management, and resilience training within athletic training and medical teams.\n- **Technology-Driven Monitoring:** Wearable devices and mobile health apps are emerging as tools to monitor physiological and psychological indicators, enabling early intervention before substance use escalates.\n- **Policy and Cultural Shift:** Developing policies that not only penalize substance abuse but also destigmatize seeking help, encouraging athletes to come forward without fear of retaliation or judgment.\n- **Collaborative Stakeholder Engagement:** Involving coaches, medical staff, sports organizations, family members, and peers to foster a supportive environment conducive to prevention and recovery.\n\n### Conclusion\n\nThe fight against substance abuse among athletes is ongoing, and it requires adaptability to emerging scientific insights and societal changes. By embracing innovative technologies, prioritizing mental health, and fostering open communication, sports communities can better protect athletes from the risks of substance abuse. The future holds promise for more effective, personalized, and compassionate approaches that not only safeguard athletic integrity but also promote overall health and well-being.')],
 'final_report': "# Introduction to Substance Abuse in Athletes\n\nSubstance abuse among athletes is a significant concern that affects not only their health but also their performance, careers, and overall well-being. Despite the physical and mental discipline required in sports, athletes are not immune to the pressures and challenges that can lead to the use and abuse of various substances. Understanding the types of substances commonly used and the reasons why athletes may turn to them is crucial for addressing this issue effectively.\n\n## Common Types of Substances Abused by Athletes\n\nAthletes may misuse a wide range of substances, each serving different purposes or fulfilling different needs depending on the individual and their circumstances. Some of the most common categories include:\n\n### 1. Performance-Enhancing Drugs (PEDs)\nPerformance-enhancing drugs are substances used to improve athletic ability beyond natural limits. These include anabolic steroids, human growth hormone (HGH), erythropoietin (EPO), and stimulants. Athletes may use these drugs to increase muscle mass, enhance endurance, speed up recovery, and gain a competitive advantage.\n\n### 2. Recreational Drugs\nRecreational drugs such as marijuana, cocaine, MDMA, and opioids are sometimes abused by athletes to cope with stress, manage pain, or for social reasons. While these substances do not improve athletic performance and can be detrimental, their use is often linked to external pressures or underlying issues.\n\n### 3. Prescription Medications\nCertain prescription medications, including painkillers (opioids), anti-anxiety drugs (benzodiazepines), and stimulants (used for ADHD), can be abused by athletes. These drugs might be used to manage pain from injuries, reduce anxiety before competitions, or increase focus and alertness.\n\n### 4. Over-the-Counter (OTC) Substances and Supplements\nThough generally legal and accessible, some OTC substances and dietary supplements can be misused, especially when athletes seek to lose weight rapidly or boost energy. Misuse can sometimes lead to harmful side effects or positive doping tests if the substances contain banned ingredients.\n\n## Reasons for Substance Abuse Among Athletes\n\nThe motivations behind substance abuse in athletes are complex and multifaceted. Some of the most common reasons include:\n\n### 1. Enhancing Performance\nThe intense desire to win and excel can lead athletes to experiment with drugs that promise enhanced strength, endurance, or recovery. In highly competitive environments, athletes may feel pressure to push beyond their natural limits.\n\n### 2. Coping with Pain and Injuries\nPhysical injuries are common in sports, and the pain associated with them can lead athletes to seek relief through prescription painkillers or other substances. Unfortunately, this can sometimes escalate into abuse and dependency.\n\n### 3. Managing Stress and Anxiety\nThe psychological pressures of competition, public scrutiny, and personal expectations can cause significant mental stress. Some athletes turn to drugs to alleviate anxiety, improve mood, or escape from personal and professional challenges.\n\n### 4. Peer Influence and Culture\nIn some sports cultures, the use of substances may be normalized or even encouraged, creating an environment where athletes feel compelled to conform. Peer influence and the desire to belong can drive substance use.\n\n### 5. Weight Control and Body Image\nCertain sports emphasize weight categories or aesthetic appearance, prompting athletes to misuse substances that suppress appetite or promote rapid weight loss.\n\n## Conclusion\n\nSubstance abuse in athletes is a serious and multifaceted problem that demands awareness, education, and intervention at multiple levels. Recognizing the types of substances commonly abused and understanding the underlying reasons for their use is the first step towards promoting healthier choices and safeguarding the integrity of sports. Athletes, coaches, medical professionals, and organizations must work collaboratively to address these issues through prevention, support, and treatment.\n\n# Common Substances Abused by Athletes\n\nAthletes often face immense pressure to perform at their best, maintain stamina, and recover quickly from injuries. Unfortunately, some turn to substances that can enhance performance or alleviate pain, despite the health risks and ethical concerns involved. This article provides a detailed description of the most frequently abused substances among athletes, focusing on steroids, stimulants, painkillers, and recreational drugs.\n\n## Anabolic Steroids\n\nAnabolic steroids are synthetic variations of the male hormone testosterone. Athletes abuse them to increase muscle mass, strength, and overall physical performance. Steroids work by promoting protein synthesis within cells, leading to rapid muscle growth.\n\n### Common Types and Effects\n- **Types**: Testosterone, nandrolone, stanozolol, and methyltestosterone.\n- **Effects**: Increased muscle size, enhanced recovery rate, greater endurance, and reduced fatigue.\n\n### Risks and Side Effects\n- Hormonal imbalances leading to acne, hair loss, and mood swings.\n- Cardiovascular issues such as high blood pressure and increased risk of heart attack.\n- Liver damage and potential infertility.\n- Psychological effects including aggression and depression.\n  \nDespite their performance-enhancing properties, anabolic steroids are banned in most sports leagues and athletic organizations.\n\n## Stimulants\n\nStimulants are substances that increase alertness, attention, and energy by enhancing the activity of the central nervous system. Athletes may use stimulants to reduce fatigue and improve focus during training or competition.\n\n### Common Stimulants\n- **Amphetamines**: Often prescribed for ADHD but misused for increased energy.\n- **Caffeine**: The world’s most widely consumed legal stimulant.\n- **Ephedrine**: Used for weight loss and increased energy but banned in many competitions.\n  \n### Effects\n- Increased heart rate and blood pressure.\n- Heightened concentration and wakefulness.\n- Temporary reduction of appetite and fatigue.\n\n### Risks\n- Dependence and addiction.\n- Cardiovascular complications, including arrhythmias and heart attacks.\n- Nervousness, anxiety, and sleep disturbances.\n  \nWhile moderate caffeine use is generally accepted, other stimulants are typically prohibited due to their performance-enhancing effects and health risks.\n\n## Painkillers\n\nPainkillers, particularly opioid analgesics and non-steroidal anti-inflammatory drugs (NSAIDs), are commonly prescribed to manage injuries and pain. However, abuse can occur when athletes rely excessively on these drugs to continue competing.\n\n### Commonly Abused Painkillers\n- **Opioids**: Morphine, oxycodone, hydrocodone.\n- **NSAIDs**: Ibuprofen, naproxen (abuse generally less severe but problematic if overused).\n\n### Effects\n- Temporary pain relief and increased ability to train through injury.\n- Sedation and euphoria (primarily with opioids).\n\n### Risks\n- Opioid addiction, respiratory depression, and overdose.\n- Gastrointestinal issues and kidney damage with long-term NSAID use.\n- Masking of pain leading to worsened injuries.\n\nDue to the risk of dependency, strict guidelines exist for the medical use of painkillers among athletes.\n\n## Recreational Drugs\n\nSome athletes use recreational drugs for relaxation or coping with stress, despite the negative impact on performance and health.\n\n### Common Recreational Drugs Abused\n- **Cannabis**: Used for relaxation and pain relief; banned in many competitions.\n- **Alcohol**: Consumed socially but can impair recovery and performance.\n- **Cocaine and Ecstasy**: Occasionally abused for their stimulant and euphoric effects.\n\n### Effects\n- Altered mental state, reduced reaction time, and impaired coordination.\n- Short-term mood enhancement or relaxation.\n\n### Risks\n- Detrimental effects on cardiovascular health.\n- Legal issues and sanctions from sports authorities.\n- Negative impact on motivation, training, and overall athletic performance.\n\n## Conclusion\n\nThe abuse of steroids, stimulants, painkillers, and recreational drugs poses serious health risks and ethical dilemmas in sports. While the desire to perform better or manage pain is understandable, these substances can undermine an athlete’s long-term wellbeing and the integrity of athletic competition. Education, support, and strict regulation remain crucial in addressing substance abuse among athletes.\n\n# Causes and Risk Factors: Exploring Psychological, Social, and Professional Contributors to Substance Abuse Among Athletes\n\nSubstance abuse among athletes is a pressing concern that extends beyond physical performance to affect their mental health, career longevity, and overall well-being. Understanding the underlying causes and risk factors is essential for developing effective prevention and intervention strategies. This article delves into the psychological, social, and professional factors that contribute to substance abuse in the athletic community.\n\n## Psychological Factors\n\n### Pressure to Perform and Perfectionism\nAthletes often face intense pressure to perform at peak levels consistently. This demand can trigger anxiety, stress, and feelings of inadequacy. The desire for perfection may lead some athletes to use substances such as stimulants or performance-enhancing drugs to cope with the high expectations and overcome self-doubt.\n\n### Mental Health Challenges\nDepression, anxiety disorders, and other mental health issues are prevalent among athletes. The stigma around seeking psychological help often forces athletes to self-medicate with alcohol or drugs as a way to manage emotional pain, stress, or injury-related trauma.\n\n### Coping Mechanisms for Injury and Pain\nPhysical injuries are a common aspect of athletic careers. The chronic pain associated with injuries can lead athletes to misuse prescription medications like opioids or overconsume alcohol to alleviate discomfort and continue training or competing, inadvertently increasing the risk of substance dependence.\n\n## Social Factors\n\n### Peer Influence and Team Culture\nThe social environment within teams can profoundly impact substance use behaviors. If drug or alcohol use is normalized or even glamorized among teammates, new or younger athletes may feel pressured to conform to these norms to gain acceptance or camaraderie.\n\n### Social Isolation and Loneliness\nDespite being part of a team, athletes may experience social isolation due to rigorous training schedules, travel, or being away from family and friends. This loneliness can increase vulnerability to substance use as a misguided attempt to fill emotional voids or manage feelings of alienation.\n\n### Media and Celebrity Influence\nExposure to celebrity athletes who openly use or are rumored to use substances can create misleading narratives about drug use and its perceived benefits. This influence can lower inhibitions and reshape attitudes towards substance use, especially among younger athletes aspiring to emulate their idols.\n\n## Professional Factors\n\n### Demands of Competitive Sports\nThe professional athletic environment is highly competitive, with careers often hinging on performance and winning. The associated stress can drive athletes to use substances that promise enhanced stamina, focus, or recovery, sometimes blurring the line between legitimate medical use and abuse.\n\n### Career Uncertainty and Transition Stress\nAthletes frequently face uncertainty regarding career longevity due to factors such as injuries or declining performance. The stress related to contract negotiations, retirement planning, or forced career changes may lead to increased substance use as a maladaptive coping strategy.\n\n### Accessibility and Medical Prescriptions\nAthletes generally have greater access to medical facilities and prescription medications than the general population. While this access is crucial for health management, it also increases the risk of prescription drug misuse, especially when oversight is inadequate or when medications are used beyond therapeutic purposes.\n\n## Conclusion\n\nThe causes and risk factors behind substance abuse among athletes are multifaceted, involving a complex interplay of psychological pressures, social dynamics, and professional challenges. Recognizing these contributing elements is vital for coaches, medical professionals, and support networks to create comprehensive prevention programs and provide the necessary resources to help athletes maintain healthy lifestyles free from substance abuse. Only through holistic understanding and targeted action can the athletic community effectively combat this pervasive issue.\n\n# Health and Performance Consequences: The Physical and Mental Impacts of Substance Abuse on Athletes\n\nSubstance abuse among athletes is a critical issue that can profoundly affect both their health and sports performance. While some may turn to drugs or alcohol as a coping mechanism for stress, injury, or pressure, the consequences can be far-reaching and damaging. This article provides an in-depth analysis of the physical and mental impacts of substance abuse on athletes, emphasizing why maintaining a healthy lifestyle is essential for peak performance and overall well-being.\n\n## Physical Impacts of Substance Abuse on Athletes\n\n### 1. Deterioration of Cardiovascular Health\nMany substances abused by athletes, such as stimulants and anabolic steroids, place significant strain on the cardiovascular system. Stimulants like cocaine and amphetamines increase heart rate and blood pressure, leading to arrhythmias, hypertension, and even sudden cardiac arrest. Anabolic steroids can cause thickening of the heart muscle and increase the risk of heart attacks and strokes. Such cardiovascular issues directly impair an athlete's endurance, stamina, and ability to perform at high levels.\n\n### 2. Impaired Muscular Strength and Recovery\nThough some athletes misuse anabolic steroids to enhance muscle mass, chronic abuse can backfire by causing muscle cramps, weakness, and tendon ruptures. Other substances like alcohol interfere with protein synthesis and muscle repair, prolonging recovery time after training or injury. Dehydration and nutrient depletion caused by certain drugs further weaken muscles, limiting strength and agility on the field.\n\n### 3. Compromised Immune Function\nSubstance abuse can suppress the immune system, making athletes more susceptible to infections and illnesses. For example, excessive alcohol intake has been shown to reduce white blood cell activity, reducing the body’s ability to fight off viruses and bacteria. This leads to increased downtime due to illness and a diminished capacity to handle the physical demands of training and competition.\n\n### 4. Respiratory and Neurological Damage\nSmoking substances like tobacco or marijuana damages lung tissue and reduces oxygen uptake, critical for aerobic performance. Inhalants and certain drugs can cause long-term neurological damage including impaired coordination, balance, and reflexes—all vital for athletic skills. Brain injuries resulting from drug use can be irreversible, severely impacting motor skills and reaction times.\n\n## Mental and Psychological Consequences\n\n### 1. Cognitive Decline and Impaired Decision-Making\nSubstance abuse affects areas of the brain responsible for judgment, focus, and reaction time. Athletes abusing drugs may experience difficulties with concentration, memory, and decision-making — all essential skills for strategic gameplay and quick reactions in sports. Cognitive impairment can lead to poor game performance and increased risk of injury.\n\n### 2. Increased Anxiety, Depression, and Mood Disorders\nMany athletes turn to substances as a method of managing anxiety or depression. However, the temporary relief these substances provide is often followed by worsening symptoms. Long-term substance abuse is linked with increased rates of anxiety disorders, depression, and mood swings. Mental health struggles not only impair motivation and training consistency but also increase the likelihood of burnout and withdrawal from sport.\n\n### 3. Addiction and Dependence\nPhysical and psychological dependence on performance-enhancing or recreational drugs can trap athletes in destructive cycles. Addiction disrupts daily routines, training schedules, and professional commitments. The stress of hiding substance use and dealing with its consequences adds an additional psychological burden, often leading to social isolation and damaged relationships.\n\n### 4. Impact on Team Dynamics and Reputation\nMental health issues stemming from substance abuse can make athletes volatile or withdrawn, affecting communication and collaboration within a team. Additionally, public knowledge of substance abuse can tarnish an athlete’s reputation, leading to a loss of sponsorships, fan support, and career opportunities.\n\n## Conclusion: Prioritizing Health to Sustain Performance\n\nThe interplay between substance abuse and athletic health creates a dangerous cycle where physical and mental degradations impair performance, which in turn may lead to further substance use in an attempt to compensate. Athletes must prioritize healthy coping strategies, proper medical guidance, and mental health support to maintain optimal performance and longevity in their sports careers. Coaches, trainers, and sporting organizations also play a pivotal role in providing education and resources to prevent substance abuse and support recovery. Ultimately, safeguarding an athlete’s well-being ensures not only superior performance but a fulfilling and sustainable athletic journey.\n\n# Detection and Prevention Strategies for Substance Abuse in Athletes\n\nSubstance abuse in athletes not only undermines fair competition but also poses significant health risks. To maintain integrity in sports and protect athletes’ well-being, robust detection and prevention strategies are essential. This article explores the methods used to identify substance abuse in athletes and the proactive approaches employed to prevent it, focusing on testing protocols and educational programs.\n\n## Detection of Substance Abuse in Athletes\n\n### 1. Drug Testing Protocols\nOne of the primary methods for detecting substance abuse in athletes is through comprehensive drug testing programs. These tests can be conducted both in and out of competition, aiming to identify banned substances such as anabolic steroids, stimulants, diuretics, and other performance-enhancing drugs (PEDs).\n\n- **Urine Testing:** The most common and widely used method, urine tests can detect a broad range of substances and their metabolites. Samples are collected under strict supervision to prevent tampering.\n- **Blood Testing:** Used to detect substances that may not appear in urine or to determine the concentration of certain drugs, such as erythropoietin (EPO) or hormones.\n- **Hair and Saliva Testing:** These methods are less common but provide longer detection windows or rapid results, respectively.\n\nTesting is typically random, scheduled, or targeted based on certain risk factors or suspicious behavior, helping to deter and catch substance abuse.\n\n### 2. Biological Passport Programs\nThe Athlete Biological Passport (ABP) monitors selected biological variables over time. Rather than detecting the substance directly, it identifies abnormal changes in an athlete’s biological markers that suggest doping. This method enhances detection capabilities for substances that are otherwise difficult to identify.\n\n### 3. Observational and Behavioral Monitoring\nCoaches, medical staff, and anti-doping officials also rely on behavioral observations to detect potential substance abuse. Changes in performance, physical appearance, or behavior can prompt further investigation or testing.\n\n## Prevention Strategies\n\n### 1. Education Programs\nEducation is a cornerstone in preventing substance abuse. Athletes, coaches, and supporting personnel are provided with information about:\n\n- The health risks associated with drug use.\n- The ethical implications and impact on sporting integrity.\n- The specific substances banned by anti-doping authorities.\n- How testing procedures work and the consequences of violations.\n\nEffective education fosters informed decision-making and empowers athletes to resist pressure or temptation to use prohibited substances.\n\n### 2. Promoting a Culture of Clean Sport\nEncouraging a culture that values fair play and health over winning at all costs is essential. This includes:\n\n- Encouraging open dialogue about doping risks.\n- Highlighting positive role models who compete clean.\n- Building supportive environments where athletes can seek help for pressures or substance-related issues without stigma.\n\n### 3. Support Services and Counseling\nProviding access to psychological support and counseling can address underlying issues that might lead athletes to use substances, such as stress, anxiety, or injury-related pain management.\n\n### 4. Policy and Enforcement\nClear rules, consistent enforcement, and transparent consequences reinforce deterrents against doping. Collaboration among sports organizations, anti-doping agencies, and governments ensures that policies are up-to-date and effectively implemented.\n\n## Conclusion\n\nDetecting and preventing substance abuse in athletes requires a multifaceted approach that combines advanced testing technologies, continuous monitoring, education, and supportive environments. By integrating these strategies, the sports community can better protect athletes’ health, uphold the spirit of fair competition, and maintain public confidence in sport.\n\n# Support and Rehabilitation: Helping Athletes Overcome Substance Abuse\n\nSubstance abuse is a significant challenge faced by many athletes, often impacting not only their performance but also their overall health and well-being. Fortunately, a variety of support systems and rehabilitation programs have been developed to assist athletes in overcoming these issues. These resources provide comprehensive care, from initial intervention to long-term recovery, helping athletes regain control of their lives both on and off the field.\n\n## Understanding the Need for Support and Rehabilitation\n\nAthletes are under tremendous pressure to perform, which can sometimes lead to the misuse of substances such as performance enhancers, painkillers, or recreational drugs. The stigma surrounding substance abuse in sports may create barriers to seeking help, making effective support and rehabilitation programs critical.\n\nThese programs are specifically designed to address the unique physical, emotional, and psychological demands athletes face. Tailored support systems ensure that athletes receive care that respects their competitive schedules while focusing on sustainable recovery.\n\n## Types of Support Systems Available to Athletes\n\n### 1. Counseling and Psychological Support\n\nOne of the foundational elements in addressing substance abuse is access to professional counseling. Sports psychologists and addiction counselors work with athletes to tackle underlying issues such as anxiety, depression, or trauma that often contribute to substance misuse. Cognitive-behavioral therapy (CBT) and motivational interviewing are common techniques used to foster behavioral change and build resilience.\n\n### 2. Peer Support Groups\n\nPeer networks provide a safe environment where athletes can share experiences, challenges, and coping strategies. Groups such as Athlete Assistance Programs (AAP) and specialized 12-step programs tailored for athletes encourage mutual support and accountability. Being part of a community reduces feelings of isolation and stigma, fostering a sense of belonging and motivation.\n\n### 3. Family and Social Support\n\nRehabilitation is more effective when athletes have a strong support system at home and within their social circles. Many programs involve family therapy or educational sessions to help loved ones understand substance abuse and learn how to provide constructive support throughout recovery.\n\n## Rehabilitation Programs Tailored for Athletes\n\n### 1. Inpatient Rehabilitation\n\nFor athletes with severe substance dependence, inpatient rehabilitation centers offer intensive, structured care. These programs provide medical supervision, detoxification services, and comprehensive therapy in a controlled environment. Many centers integrate physical conditioning and sports-specific rehabilitation to help athletes maintain fitness and facilitate reintegration into their sport.\n\n### 2. Outpatient Rehabilitation\n\nOutpatient programs provide flexibility for athletes who cannot commit to prolonged residential stays due to training or competition schedules. These programs offer scheduled therapy sessions, group meetings, and medical support, allowing athletes to receive care while continuing their regular activities. Outpatient care often serves as a step-down for those transitioning from inpatient programs.\n\n### 3. Holistic and Integrative Approaches\n\nModern rehabilitation programs increasingly incorporate holistic therapies to address the physical and emotional aspects of recovery. These may include yoga, mindfulness meditation, nutrition counseling, and acupuncture. Such approaches help athletes develop healthier lifestyles, manage stress, and reduce the likelihood of relapse.\n\n## Role of Sports Organizations and Governing Bodies\n\nSports organizations play a pivotal role in providing resources and creating policies that support athletes facing substance abuse. Many federations offer confidential help lines, educational seminars, and funding for rehabilitation programs. Anti-doping agencies also emphasize rehabilitation over punishment, aiming to promote athlete health and ethical competition.\n\n## Success Stories and Outcomes\n\nNumerous athletes have successfully overcome substance abuse through dedicated support and rehabilitation. These success stories highlight the effectiveness of targeted programs that combine medical treatment, psychological support, and social reintegration. Recovery not only improves personal health but also restores athletic potential and inspires others facing similar struggles.\n\n## Conclusion\n\nSubstance abuse among athletes is a complex issue requiring specialized support and rehabilitation programs. By leveraging counseling, peer support, family involvement, and tailored rehabilitation services, athletes can overcome these challenges and return to optimal performance and well-being. Ongoing collaboration between healthcare providers, sports organizations, and athletes themselves is essential to foster environments that encourage recovery and sustainable success.\n\n## Conclusion and Future Perspectives\n\n### Summary of Key Points\n\nAddressing substance abuse among athletes remains a critical challenge that demands comprehensive, evidence-based strategies. Throughout this article, we have explored the multifaceted nature of substance abuse in the athletic community, highlighting its complex interplay with physical performance pressures, mental health issues, and social influences. Key points include:\n\n- **Prevalence and Types of Substance Abuse:** Athletes are susceptible to various substances, ranging from performance-enhancing drugs like anabolic steroids to recreational drugs and prescription medication misuse.\n- **Risk Factors:** High-performance demands, injury management, psychological stress, and the culture of competitive sports contribute significantly to the risk of substance abuse.\n- **Impact on Health and Career:** Substance abuse not only jeopardizes athletes’ physical and mental well-being but also threatens their careers through sanctions, suspensions, and loss of reputation.\n- **Current Prevention and Intervention Strategies:** These include education programs, strict doping controls, psychological support, and rehabilitation services tailored to the athletic population.\n\nUnderstanding these essentials underscores the need for a strategic, multidisciplinary approach to mitigate substance abuse risks effectively.\n\n### Emerging Trends and Future Approaches\n\nLooking forward, the landscape of managing substance abuse among athletes is evolving, propelled by advancements in technology, research, and policy development. New trends and promising approaches include:\n\n- **Personalized Prevention Programs:** Leveraging data analytics and behavioral assessments to create individualized intervention plans that address specific risk factors and psychological profiles unique to each athlete.\n- **Enhanced Screening and Detection Methods:** Innovations such as biomarker identification, genetic testing, and advanced neuroimaging are improving the accuracy and timeliness of substance abuse detection.\n- **Integrative Mental Health Services:** Future programs emphasize holistic care by integrating mental health support, stress management, and resilience training within athletic training and medical teams.\n- **Technology-Driven Monitoring:** Wearable devices and mobile health apps are emerging as tools to monitor physiological and psychological indicators, enabling early intervention before substance use escalates.\n- **Policy and Cultural Shift:** Developing policies that not only penalize substance abuse but also destigmatize seeking help, encouraging athletes to come forward without fear of retaliation or judgment.\n- **Collaborative Stakeholder Engagement:** Involving coaches, medical staff, sports organizations, family members, and peers to foster a supportive environment conducive to prevention and recovery.\n\n### Conclusion\n\nThe fight against substance abuse among athletes is ongoing, and it requires adaptability to emerging scientific insights and societal changes. By embracing innovative technologies, prioritizing mental health, and fostering open communication, sports communities can better protect athletes from the risks of substance abuse. The future holds promise for more effective, personalized, and compassionate approaches that not only safeguard athletic integrity but also promote overall health and well-being."}</code></pre>
</div>
</div>
<p>Finally, I’ll show you how to implement a evaluator-optimizer workflow.</p>
</section>
</section>
<section id="evaluator-optimizer" class="level3">
<h3 class="anchored" data-anchor-id="evaluator-optimizer">Evaluator-optimizer</h3>
<p>This workflow is useful when we have clear evaluation criteria that an LLM evaluator can use to provide feedback to the LLM generator to iteratively improve its output.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Content generation that must match certain guidelines such as writing with a particular style.</li>
<li>Improving search results iteratively</li>
</ul>
<p>I’ll walk you through an example of an evaluator-optimizer workflow where you’ll generate a text, evaluate if it matches certain criteria, and then iteratively improve it.</p>
<p>Let’s start with the vanilla implementation.</p>
<section id="vanilla-langchain-4" class="level4">
<h4 class="anchored" data-anchor-id="vanilla-langchain-4">Vanilla (+LangChain)</h4>
<p>As usual, you start by defining the state and required data models.</p>
<div id="cell-95" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">class</span> Evaluation(BaseModel):</span>
<span id="cb42-2"><a href="#cb42-2"></a>    explanation: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb42-3"><a href="#cb42-3"></a>        description<span class="op">=</span><span class="st">"Explain why the text evaluated matches or not the evaluation criteria"</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>    )</span>
<span id="cb42-5"><a href="#cb42-5"></a>    feedback: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb42-6"><a href="#cb42-6"></a>        description<span class="op">=</span><span class="st">"Provide feedback to the writer to improve the text"</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>    )</span>
<span id="cb42-8"><a href="#cb42-8"></a>    is_correct: <span class="bu">bool</span> <span class="op">=</span> Field(</span>
<span id="cb42-9"><a href="#cb42-9"></a>        description<span class="op">=</span><span class="st">"Whether the text evaluated matches or not the evaluation criteria"</span></span>
<span id="cb42-10"><a href="#cb42-10"></a>    )</span>
<span id="cb42-11"><a href="#cb42-11"></a></span>
<span id="cb42-12"><a href="#cb42-12"></a></span>
<span id="cb42-13"><a href="#cb42-13"></a><span class="kw">class</span> State(BaseModel):</span>
<span id="cb42-14"><a href="#cb42-14"></a>    topic: <span class="bu">str</span></span>
<span id="cb42-15"><a href="#cb42-15"></a>    article: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>    evaluation: Optional[Evaluation] <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, you define the functions for each step in the workflow.</p>
<div id="cell-97" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">def</span> evaluate_text(state: State) <span class="op">-&gt;</span> Evaluation:</span>
<span id="cb43-2"><a href="#cb43-2"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(Evaluation)</span>
<span id="cb43-3"><a href="#cb43-3"></a>    messages <span class="op">=</span> [</span>
<span id="cb43-4"><a href="#cb43-4"></a>        SystemMessage(</span>
<span id="cb43-5"><a href="#cb43-5"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a text, you will evaluate if it's written in British English and if it's appropriate for a young audience. The text must always use British spelling and grammar. Make sure the text doesn't include any em dashes."</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>        ),</span>
<span id="cb43-7"><a href="#cb43-7"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Evaluate the following text:</span><span class="ch">\n\n</span><span class="sc">{</span>state<span class="sc">.</span>article<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb43-8"><a href="#cb43-8"></a>    ]</span>
<span id="cb43-9"><a href="#cb43-9"></a>    response <span class="op">=</span> model_with_str_output.invoke(messages)</span>
<span id="cb43-10"><a href="#cb43-10"></a>    <span class="cf">return</span> response</span>
<span id="cb43-11"><a href="#cb43-11"></a></span>
<span id="cb43-12"><a href="#cb43-12"></a></span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="kw">def</span> fix_text(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb43-14"><a href="#cb43-14"></a>    messages <span class="op">=</span> [</span>
<span id="cb43-15"><a href="#cb43-15"></a>        SystemMessage(</span>
<span id="cb43-16"><a href="#cb43-16"></a>            content<span class="op">=</span><span class="st">"You are an expert writer. Provided with a text and feedback, you wil improve the text."</span></span>
<span id="cb43-17"><a href="#cb43-17"></a>        ),</span>
<span id="cb43-18"><a href="#cb43-18"></a>        HumanMessage(</span>
<span id="cb43-19"><a href="#cb43-19"></a>            content<span class="op">=</span><span class="ss">f"You were tasked with writing an article about </span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss">. You wrote the following text:</span><span class="ch">\n\n</span><span class="sc">{</span>state<span class="sc">.</span>article<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">You've got the following feedback:</span><span class="ch">\n\n</span><span class="sc">{</span>state<span class="sc">.</span>evaluation<span class="sc">.</span>feedback<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">Fix the text to improve it."</span></span>
<span id="cb43-20"><a href="#cb43-20"></a>        ),</span>
<span id="cb43-21"><a href="#cb43-21"></a>    ]</span>
<span id="cb43-22"><a href="#cb43-22"></a>    response <span class="op">=</span> model.invoke(messages)</span>
<span id="cb43-23"><a href="#cb43-23"></a>    <span class="cf">return</span> response.content</span>
<span id="cb43-24"><a href="#cb43-24"></a></span>
<span id="cb43-25"><a href="#cb43-25"></a></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="kw">def</span> generate_text(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb43-27"><a href="#cb43-27"></a>    messages <span class="op">=</span> [</span>
<span id="cb43-28"><a href="#cb43-28"></a>        SystemMessage(</span>
<span id="cb43-29"><a href="#cb43-29"></a>            content<span class="op">=</span><span class="st">"You are an expert writer. Provided with a topic, you will generate an engaging article with less than 500 words."</span></span>
<span id="cb43-30"><a href="#cb43-30"></a>        ),</span>
<span id="cb43-31"><a href="#cb43-31"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Generate a text about this topic:</span><span class="ch">\n\n</span><span class="sc">{</span>state<span class="sc">.</span>topic<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb43-32"><a href="#cb43-32"></a>    ]</span>
<span id="cb43-33"><a href="#cb43-33"></a>    response <span class="op">=</span> model.invoke(messages)</span>
<span id="cb43-34"><a href="#cb43-34"></a>    <span class="cf">return</span> response.content</span>
<span id="cb43-35"><a href="#cb43-35"></a></span>
<span id="cb43-36"><a href="#cb43-36"></a></span>
<span id="cb43-37"><a href="#cb43-37"></a><span class="kw">def</span> generate_text_dispatch(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb43-38"><a href="#cb43-38"></a>    <span class="cf">if</span> state.evaluation:</span>
<span id="cb43-39"><a href="#cb43-39"></a>        <span class="cf">return</span> fix_text(state)</span>
<span id="cb43-40"><a href="#cb43-40"></a>    <span class="cf">return</span> generate_text(state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, you create <code>run_workflow</code> function that orchestrates the workflow. In this case, it takes a topic, generates a text, evaluates it, and tries to iteratively improve it. If it fails more than 3 times, it stops.</p>
<div id="cell-99" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">def</span> run_workflow(topic: <span class="bu">str</span>) <span class="op">-&gt;</span> State:</span>
<span id="cb44-2"><a href="#cb44-2"></a>    state <span class="op">=</span> State(topic<span class="op">=</span>topic)</span>
<span id="cb44-3"><a href="#cb44-3"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb44-4"><a href="#cb44-4"></a>        state.article <span class="op">=</span> generate_text_dispatch(state)</span>
<span id="cb44-5"><a href="#cb44-5"></a>        state.evaluation <span class="op">=</span> evaluate_text(state)</span>
<span id="cb44-6"><a href="#cb44-6"></a>        <span class="cf">if</span> state.evaluation.is_correct:</span>
<span id="cb44-7"><a href="#cb44-7"></a>            <span class="cf">return</span> state</span>
<span id="cb44-8"><a href="#cb44-8"></a>    <span class="cf">return</span> state</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a></span>
<span id="cb44-11"><a href="#cb44-11"></a>output <span class="op">=</span> run_workflow(<span class="st">"Substance abuse of athletes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, let’s see the LangGraph implementation.</p>
</section>
<section id="langgraph-4" class="level4">
<h4 class="anchored" data-anchor-id="langgraph-4">LangGraph</h4>
<p>You’ll start by defining the state of the workflow and data model required for the workflow.</p>
<div id="cell-103" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">class</span> Evaluation(BaseModel):</span>
<span id="cb45-2"><a href="#cb45-2"></a>    explanation: <span class="bu">str</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>    feedback: <span class="bu">str</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>    is_correct: <span class="bu">bool</span></span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a></span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="kw">class</span> State(TypedDict):</span>
<span id="cb45-8"><a href="#cb45-8"></a>    topic: <span class="bu">str</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>    article: <span class="bu">str</span></span>
<span id="cb45-10"><a href="#cb45-10"></a>    evaluation: Evaluation</span>
<span id="cb45-11"><a href="#cb45-11"></a>    num_reviews: <span class="bu">int</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, you keep the number of reviews in the state. That’s how you’ll be able to stop the workflow when the number of reviews is reached.</p>
<p>Next, you must define the functions for each node in the workflow.</p>
<div id="cell-105" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">def</span> generate_article(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb46-2"><a href="#cb46-2"></a>    messages <span class="op">=</span> [</span>
<span id="cb46-3"><a href="#cb46-3"></a>        SystemMessage(</span>
<span id="cb46-4"><a href="#cb46-4"></a>            content<span class="op">=</span><span class="st">"You are an expert writer. Provided with a topic, you will generate an engaging article with less than 500 words."</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>        ),</span>
<span id="cb46-6"><a href="#cb46-6"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Generate a text about this topic:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb46-7"><a href="#cb46-7"></a>    ]</span>
<span id="cb46-8"><a href="#cb46-8"></a>    response <span class="op">=</span> model.invoke(messages)</span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="cf">return</span> {<span class="st">"article"</span>: response.content}</span>
<span id="cb46-10"><a href="#cb46-10"></a></span>
<span id="cb46-11"><a href="#cb46-11"></a></span>
<span id="cb46-12"><a href="#cb46-12"></a><span class="kw">def</span> fix_article(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb46-13"><a href="#cb46-13"></a>    messages <span class="op">=</span> [</span>
<span id="cb46-14"><a href="#cb46-14"></a>        SystemMessage(</span>
<span id="cb46-15"><a href="#cb46-15"></a>            content<span class="op">=</span><span class="st">"You are an expert writer. Provided with a text, you will fix the text to improve it. The text must always use British spelling and grammar."</span></span>
<span id="cb46-16"><a href="#cb46-16"></a>        ),</span>
<span id="cb46-17"><a href="#cb46-17"></a>        HumanMessage(</span>
<span id="cb46-18"><a href="#cb46-18"></a>            content<span class="op">=</span><span class="ss">f"You were tasked with writing an article about </span><span class="sc">{</span>state[<span class="st">'topic'</span>]<span class="sc">}</span><span class="ss">. You wrote the following text:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'article'</span>]<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">You've got the following feedback:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'evaluation'</span>]<span class="sc">.</span>feedback<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">Fix the text to improve it."</span></span>
<span id="cb46-19"><a href="#cb46-19"></a>        ),</span>
<span id="cb46-20"><a href="#cb46-20"></a>    ]</span>
<span id="cb46-21"><a href="#cb46-21"></a>    response <span class="op">=</span> model.invoke(messages)</span>
<span id="cb46-22"><a href="#cb46-22"></a>    <span class="cf">return</span> {<span class="st">"article"</span>: response.content}</span>
<span id="cb46-23"><a href="#cb46-23"></a></span>
<span id="cb46-24"><a href="#cb46-24"></a></span>
<span id="cb46-25"><a href="#cb46-25"></a><span class="kw">def</span> evaluate_article(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb46-26"><a href="#cb46-26"></a>    model_with_str_output <span class="op">=</span> model.with_structured_output(Evaluation)</span>
<span id="cb46-27"><a href="#cb46-27"></a>    messages <span class="op">=</span> [</span>
<span id="cb46-28"><a href="#cb46-28"></a>        SystemMessage(</span>
<span id="cb46-29"><a href="#cb46-29"></a>            content<span class="op">=</span><span class="st">"You are an expert evaluator. Provided with a text, you will evaluate if it's written in British English and if it's appropriate for a young audience. The text must always use British spelling and grammar. Make sure the text doesn't include any em dash. Be very strict with the evaluation. In case of doubt, return a negative evaluation."</span></span>
<span id="cb46-30"><a href="#cb46-30"></a>        ),</span>
<span id="cb46-31"><a href="#cb46-31"></a>        HumanMessage(content<span class="op">=</span><span class="ss">f"Evaluate the following text:</span><span class="ch">\n\n</span><span class="sc">{</span>state[<span class="st">'article'</span>]<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb46-32"><a href="#cb46-32"></a>    ]</span>
<span id="cb46-33"><a href="#cb46-33"></a>    response <span class="op">=</span> model_with_str_output.invoke(messages)</span>
<span id="cb46-34"><a href="#cb46-34"></a>    <span class="cf">return</span> {<span class="st">"evaluation"</span>: response, <span class="st">"num_reviews"</span>: state.get(<span class="st">"num_reviews"</span>, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span>}</span>
<span id="cb46-35"><a href="#cb46-35"></a></span>
<span id="cb46-36"><a href="#cb46-36"></a></span>
<span id="cb46-37"><a href="#cb46-37"></a><span class="kw">def</span> route_text(state: State) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-38"><a href="#cb46-38"></a>    evaluation <span class="op">=</span> state.get(<span class="st">"evaluation"</span>, <span class="va">None</span>)</span>
<span id="cb46-39"><a href="#cb46-39"></a>    num_reviews <span class="op">=</span> state.get(<span class="st">"num_reviews"</span>, <span class="dv">0</span>)</span>
<span id="cb46-40"><a href="#cb46-40"></a>    <span class="cf">if</span> evaluation <span class="kw">and</span> <span class="kw">not</span> evaluation.is_correct <span class="kw">and</span> num_reviews <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb46-41"><a href="#cb46-41"></a>        <span class="cf">return</span> <span class="st">"Fail"</span></span>
<span id="cb46-42"><a href="#cb46-42"></a>    <span class="cf">return</span> <span class="st">"Pass"</span></span>
<span id="cb46-43"><a href="#cb46-43"></a></span>
<span id="cb46-44"><a href="#cb46-44"></a></span>
<span id="cb46-45"><a href="#cb46-45"></a><span class="kw">def</span> generate_article_dispatch(state: State) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb46-46"><a href="#cb46-46"></a>    <span class="cf">if</span> <span class="st">"evaluation"</span> <span class="kw">in</span> state <span class="kw">and</span> state[<span class="st">"evaluation"</span>]:</span>
<span id="cb46-47"><a href="#cb46-47"></a>        <span class="cf">return</span> fix_article(state)</span>
<span id="cb46-48"><a href="#cb46-48"></a>    <span class="cf">else</span>:</span>
<span id="cb46-49"><a href="#cb46-49"></a>        <span class="cf">return</span> generate_article(state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You define:</p>
<ol type="1">
<li><code>generate_text</code>: This function generates a text based on the topic.</li>
<li><code>evaluate_text</code>: This function evaluates the text based on the topic.</li>
<li><code>fix_text</code>: This function fixes the text based on the feedback.</li>
<li><code>generate_article_dispatch</code>: This function dispatches the text generation task to either the <code>generate_text</code> or <code>fix_text</code> function based on the evaluation.</li>
</ol>
<p>Next, you need to define the graph that will be used to run the workflow.</p>
<div id="cell-107" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>workflow_builder <span class="op">=</span> StateGraph(State)</span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>workflow_builder.add_node(<span class="st">"generate_article"</span>, generate_article_dispatch)</span>
<span id="cb47-4"><a href="#cb47-4"></a>workflow_builder.add_node(<span class="st">"evaluate_article"</span>, evaluate_article)</span>
<span id="cb47-5"><a href="#cb47-5"></a></span>
<span id="cb47-6"><a href="#cb47-6"></a>workflow_builder.add_edge(START, <span class="st">"generate_article"</span>)</span>
<span id="cb47-7"><a href="#cb47-7"></a>workflow_builder.add_edge(<span class="st">"generate_article"</span>, <span class="st">"evaluate_article"</span>)</span>
<span id="cb47-8"><a href="#cb47-8"></a>workflow_builder.add_conditional_edges(</span>
<span id="cb47-9"><a href="#cb47-9"></a>    <span class="st">"evaluate_article"</span>, route_text, {<span class="st">"Pass"</span>: END, <span class="st">"Fail"</span>: <span class="st">"generate_article"</span>}</span>
<span id="cb47-10"><a href="#cb47-10"></a>)</span>
<span id="cb47-11"><a href="#cb47-11"></a></span>
<span id="cb47-12"><a href="#cb47-12"></a>workflow <span class="op">=</span> workflow_builder.<span class="bu">compile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You start by defining the workflow’s architecture with a StateGraph object. Your functions are then brought in as the nodes, and the operational sequence between them is set by defining the edges. Similar to the <em>Prompt chaining</em> pattern, you can use a conditional edge to dynamically route the workflow’s logic based on its current state. But instead of routing to a node, you route back to the text generation node, and iterate until the text is good enough.</p>
<p>Next, you call the <code>compile</code> method to convert your graph into a runnable workflow. You can also generate a visual diagram of the workflow using the <code>get_graph</code> and <code>draw_mermaid_png</code> functions.</p>
<div id="cell-109" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>display(Image(workflow.get_graph().draw_mermaid_png()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="agentic-workflows-langgraph_files/figure-html/cell-43-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="agentic-workflows-langgraph_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Finally, you can run the workflow with the <code>invoke</code> method.</p>
<div id="cell-111" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>workflow.invoke({<span class="st">"topic"</span>: <span class="st">"Suggest the use enhancing drugs to athletes"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>{'topic': 'Suggest the use enhancing drugs to athletes',
 'article': 'The use of performance-enhancing drugs (PEDs) in sports is a complicated and sensitive topic. These substances are said to help athletes improve their abilities and compete better. However, their use raises important questions about fairness, health, and rules. While some people believe that carefully controlled use of PEDs might have certain benefits, it is a subject that needs thoughtful discussion and clear regulation.\n\nSupporters of PEDs argue that they could make competitions fairer by helping athletes who do not have the same access to training and equipment. In many sports, very small differences can decide the winner, and some athletes may use these drugs to try to even the playing field. If used properly under medical supervision, PEDs might reduce inequalities caused by differences in coaching and resources.\n\nAnother point is that if doctors monitored athletes using these substances, health risks could be lowered. Often, athletes who use PEDs do so in secret and without medical guidance, which can be dangerous. A system of medical support could help ensure that athletes stay as safe as possible, with regular health checks and information about the risks involved.\n\nLegalising PED use might also change how sports organisations spend their money. Instead of focusing on punishing athletes for doping, resources could be put into improving training methods and helping athletes recover and stay healthy. This might encourage research into safer ways to enhance performance.\n\nMoreover, being open about PED use could make sports more honest. Doping has been a problem for a long time, and banning these drugs has not stopped people from using them secretly. A more transparent approach might reduce cheating and allow fans to better understand athletes’ achievements.\n\nDespite these points, it is very important that any use of PEDs is carefully controlled with strict rules, age limits, and ethical standards. Protecting athlete health and fairness in sport must always be the top priority. More research and discussion are needed before any changes are made.\n\nIn summary, although the use of performance-enhancing drugs remains a difficult and controversial issue, thoughtful regulation and openness could potentially improve fairness and safety in sports. However, this topic involves complex ideas that require careful and mature consideration.',
 'evaluation': Evaluation(explanation="The text is written using British English spelling conventions, such as 'legalising' with an 's' instead of 'legalizing'. The grammar is correct and appropriate for a young audience with clear, accessible language and no use of em dashes. The content is presented in a balanced, informative manner that is suitable for young readers, addressing the topic thoughtfully without complex jargon or inappropriate content.", feedback='The text uses British English correctly and is suitable for a young audience. It avoids complex sentence structures and uses accessible vocabulary. There are no em dashes present, maintaining adherence to the criteria. The content is presented in a balanced and neutral way appropriate for educational purposes.', is_correct=True),
 'num_reviews': 2}</code></pre>
</div>
</div>
<p>That’s it! You’ve now seen how to implement the most common agentic workflow patterns with a vanilla approach and with LangGraph.</p>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Throughout this tutorial, you’ve seen how different agentic workflow patterns solve specific types of problems:</p>
<ul>
<li><strong>Prompt Chaining</strong>: Break complex tasks into sequential steps with clear handoffs</li>
<li><strong>Router</strong>: Classify inputs and route them to specialized handlers</li>
<li><strong>Parallelization</strong>: Run multiple evaluations or processes simultaneously for speed and diversity</li>
<li><strong>Orchestrator-Workers</strong>: Dynamically decompose tasks and distribute work</li>
<li><strong>Evaluator-Optimizer</strong>: Create feedback loops for iterative quality improvement</li>
</ul>
<p>You’ve learned how to implement these patterns with and without LangGraph. While the vanilla approach give you full control and might be simpler for basic cases, LangGraph gives you many features that make it easier to build complex workflows.</p>
<p>Hope you find this tutorial useful. If you have any questions, let me know in the comments below.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{castillo2025,
  author = {Castillo, Dylan},
  title = {Agentic Workflows with {LangGraph}},
  date = {2025-07-03},
  url = {https://dylancastillo.co/posts/agentic-workflows-langgraph.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-castillo2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Castillo, Dylan. 2025. <span>“Agentic Workflows with LangGraph.”</span>
July 3, 2025. <a href="https://dylancastillo.co/posts/agentic-workflows-langgraph.html">https://dylancastillo.co/posts/agentic-workflows-langgraph.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dylancastillo\.co");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="dylanjcastillo/blog_comments" issue-term="pathname" theme="dark-blue" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Dylan Castillo</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>